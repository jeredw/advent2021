
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advent of Code 2021 - APL &#8212; My Jupyter Book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-2 bd-sidebar site-navigation show single-page" id="site-navigation">
    
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Advent of Code 2021.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Advent of Code 2021.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-1">
   Day 1
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-1">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-2">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-2">
   Day 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-3">
   Day 3
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-4">
   Day 4
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-5">
   Day 5
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-6">
   Day 6
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-7">
   Day 7
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-8">
   Day 8
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-9">
   Day 9
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-10">
   Day 10
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-11">
   Day 11
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-12">
   Day 12
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-13">
   Day 13
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-14">
   Day 14
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id25">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id26">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-15">
   Day 15
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id27">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id28">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-16">
   Day 16
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id29">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id30">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-17">
   Day 17
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id31">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id32">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-18">
   Day 18
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id34">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-19">
   Day 19
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id35">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-20">
   Day 20
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id37">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id38">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-21">
   Day 21
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id40">
     Part 2
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="advent-of-code-2021-apl">
<h1>Advent of Code 2021 - APL<a class="headerlink" href="#advent-of-code-2021-apl" title="Permalink to this headline">Â¶</a></h1>
<p><a class="reference external" href="https://adventofcode.com/">Advent of Code</a> is a daily programming puzzle
challenge published each December. The puzzles are pretty easy for experienced
programmers, so theyâ€™re a great way to play around with new programming
languages and tools. This year Iâ€™m trying out
<a class="reference external" href="https://en.wikipedia.org/wiki/APL_(programming_language)">APL</a>, a famously
terse array language from the 60s. You may have seen its memeable program for
<a class="reference external" href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conwayâ€™s game of life</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">gol</span> <span class="kd">â†</span> <span class="kt">{</span><span class="o">â‰¢â¸</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âˆŠ</span><span class="na">Â¨</span><span class="m">3</span><span class="o">+</span><span class="m">0</span><span class="o">,</span><span class="na">Â¨</span><span class="o">âŠ¢</span> <span class="c1">â Generate the next generation ğŸ¤¯</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Rebuilding user command cache... done
</span></div></div>
</div>
<p>A few people expressed interest, so about halfway through December I decided
to try publishing a Jupyter notebook with my solutions in literate programming
fashion. Caveat that Iâ€™m a complete APL newb so some of my answers may be
really bad/ugly! But Iâ€™m having fun. After a few weeks, the funny symbols are
starting to make some sense, and Iâ€™m contemplating buying a special keyboardâ€¦</p>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://www.dyalog.com/">Dyalog</a> seems to be the APL that most people use.
Some good online resources are <a class="reference external" href="https://aplcart.info/">APLcart</a>,
<a class="reference external" href="https://xpqz.github.io/learnapl/">Learning APL</a>, and
<a class="reference external" href="https://mastering.dyalog.com/README.html">Mastering Dyalog APL</a>.</p>
<p>A few days in, YouTubeâ€™s algorithm told me about another crazy person solving
AoC in APL! <a class="reference external" href="https://www.youtube.com/c/codereport">code_report</a> seems to be much
better at it and for the first few days, I compared notes with their videos
and learned a ton.</p>
</div>
<div class="section" id="day-1">
<h2>Day 1<a class="headerlink" href="#day-1" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/1">Puzzle link</a></p>
<div class="section" id="part-1">
<h3>Part 1<a class="headerlink" href="#part-1" title="Permalink to this headline">Â¶</a></h3>
<p>Today weâ€™re just supposed to count increasing numbers in a list, which takes
all of 5 characters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test1</span><span class="kd">â†</span><span class="m">199</span> <span class="m">200</span> <span class="m">208</span> <span class="m">210</span> <span class="m">200</span> <span class="m">207</span> <span class="m">240</span> <span class="m">269</span> <span class="m">260</span> <span class="m">263</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="nv">test1</span> <span class="c1">â reduce test1 pairwise on &lt; then sum the resulting boolean array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<p>Note that APL is read right to left. The parser is really, really basic, and
I keep shooting myself in the foot by forgetting parentheses.</p>
<p>The pinacle of APL style is â€œtacitâ€ programming involving just â€œtrainsâ€ of
functions and operators smushed together with no explicit arguments. We can
store and reuse the solution for day 1, part 1, thusly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="o">âŠ¢</span> <span class="c1">â the âŠ¢ means &quot;I&#39;m with stupid&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span> <span class="nv">test1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<p>Reading stuff from a file took embarrasingly long to figure out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data1</span><span class="kd">â†</span><span class="o">â</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day1-input.txt&#39;</span> <span class="m">1</span> <span class="c1">â read lines and eval each one turning strings to numbers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span> <span class="nv">data1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1390
</span></div></div>
</div>
</div>
<div class="section" id="part-2">
<h3>Part 2<a class="headerlink" href="#part-2" title="Permalink to this headline">Â¶</a></h3>
<p>Instead we need to sum every three adjacent elements and then count increases,
which takes a whole 8 characters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="nv">test1</span> <span class="c1">â reduce test1 on 3-wise sums, pairwise compare, and sum increases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_2</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="o">âŠ¢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_2</span> <span class="nv">data1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1457
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-2">
<h2>Day 2<a class="headerlink" href="#day-2" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/2">Puzzle link</a></p>
<p>Today we have to deal with words to drive a submarine around. APL strings are
(predictably) just arrays, and there donâ€™t seem to be special string libraries.
So letâ€™s turn this all into numbers to simplify life.</p>
<p>Weâ€™ll use a â€œdfnâ€ i.e. a function to parse lines. The dfn grammar is powerful
enough that once you understand it, you can basically use APL as a terrible
functional language.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_sub_command</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â converts a command like &#39;forward 5&#39; into two numbers</span>
  <span class="nv">dir</span> <span class="nv">delta</span><span class="kd">â†</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span>      <span class="c1">â split on space (i.e. partition on not-equal &#39; &#39;)</span>
  <span class="nv">dir</span><span class="o">â‰¡</span><span class="s1">&#39;forward&#39;</span><span class="bp">:</span><span class="p">(</span><span class="o">â</span><span class="nv">delta</span><span class="p">)</span><span class="m">0</span>  <span class="c1">â &#39;forward x&#39;: x 0</span>
  <span class="nv">dir</span><span class="o">â‰¡</span><span class="s1">&#39;down&#39;</span><span class="bp">:</span><span class="m">0</span><span class="p">(</span><span class="o">â</span><span class="nv">delta</span><span class="p">)</span>     <span class="c1">â &#39;down x&#39;: 0 x</span>
  <span class="m">0</span><span class="p">(</span><span class="o">-â</span><span class="nv">delta</span><span class="p">)</span>               <span class="c1">â &#39;up x&#39;: 0 -x</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test2</span><span class="kd">â†</span><span class="nv">parse_sub_command</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day2-test.txt&#39;</span> <span class="m">1</span> <span class="c1">â map parser over lines</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚5 0â”‚0 5â”‚8 0â”‚0 Â¯3â”‚0 8â”‚2 0â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data2</span><span class="kd">â†</span><span class="nv">parse_sub_command</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day2-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Part 1<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>First weâ€™re supposed to move the sub, then return its position times its
depth to prove we parsed the commands ok. We can just add up our tuples
then multiply the components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span><span class="kd">â†</span><span class="o">Ã—</span><span class="na">/âˆ˜</span><span class="o">â†‘</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">âŠ¢</span><span class="p">)</span> <span class="c1">â sum reduce, unbox, then multiply</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">150
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span> <span class="nv">data2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1938402
</span></div></div>
</div>
</div>
<div class="section" id="id2">
<h3>Part 2<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>jk actually thereâ€™s another state variable aim. We can make this variable
explicit using a scan which is a reduce that gives you partial answers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="m">2</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="nv">test2</span> <span class="c1">â + scan over seconds of test2 (i.e. up/down amounts)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 5 5 2 10 10
</span></div></div>
</div>
<p>So to get depth we multiply aim by the X for forward commands, then sum.
Horizontal pos is just the sum of the firsts as before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">Ã—+</span><span class="na">/</span><span class="p">(</span><span class="o">+</span><span class="na">\</span><span class="m">2</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span> <span class="c1">â sum aimÃ—X, then multiply horizontal pos</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">900
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">data2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1947878632
</span></div></div>
</div>
<p>If you wanted you could probably trim some characters and write this tacitly
but itâ€™s already needlessly obtuse imo, and reads better with some names for
things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day2_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">forward</span> <span class="nv">up_down</span><span class="kd">â†</span><span class="o">â†“â‰â†‘</span><span class="bp">âµ</span> <span class="c1">â forward is firsts, up_down is seconds </span>
  <span class="nv">aim</span><span class="kd">â†</span><span class="o">+</span><span class="na">\</span><span class="nv">up_down</span>        <span class="c1">â aim is sum of ups and downs</span>
  <span class="nv">depth</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="nv">aim</span><span class="o">Ã—</span><span class="nv">forward</span>  <span class="c1">â depths are sum of aim times forward</span>
  <span class="nv">pos</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="nv">forward</span>        <span class="c1">â pos is sum of forward</span>
  <span class="nv">depth</span><span class="o">Ã—</span><span class="nv">pos</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">900
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-3">
<h2>Day 3<a class="headerlink" href="#day-3" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/3">Puzzle link</a></p>
<p>Today our data is a list of binary numbers we need to look at bitwise,
so weâ€™ll want that as a bit matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test3</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day3-test.txt&#39;</span> <span class="m">1</span> <span class="c1">â mix (unbox as rows) eval&#39;d digits from lines</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 1 0 0
1 1 1 1 0
1 0 1 1 0
1 0 1 1 1
1 0 1 0 1
0 1 1 1 1
0 0 1 1 1
1 1 1 0 0
1 0 0 0 0
1 1 0 0 1
0 0 0 1 0
0 1 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data3</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day3-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Part 1<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>Weâ€™re supposed to form two binary numbers by taking the most and least
commmon bits each in each position. We can sum bits in each column to
find the most common bit, e.g.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="o">â‰¢</span><span class="nv">test3</span><span class="p">)</span><span class="o">&lt;+</span><span class="na">âŒ¿</span><span class="nv">test3</span> <span class="c1">â bit mask where 6 &lt; column sums of test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 0
</span></div></div>
</div>
<p>APL has fancy operators for base conversion too so this can be smushed
into another ridiculous one liner. It could even probably be <em>more</em> condensed,
in case itâ€™s already too readable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŠ¥</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">&lt;+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="o">Ã—</span><span class="m">2</span><span class="o">âŠ¥</span><span class="p">(</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">&gt;+</span><span class="na">âŒ¿</span>  <span class="c1">â sorry</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span> <span class="nv">test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">198
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span> <span class="nv">data3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3429254
</span></div></div>
</div>
</div>
<div class="section" id="id4">
<h3>Part 2<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>Now we gotta find a row in our bit matrix, by taking only rows with the majority
bit in the first position, then from those only rows with the majority bit in
the second position, and so on until we only have one row left. This requires
iteratively filtering a set of things which, unsurprisingly, we can do in one
line of terrible code. (Sorry.)</p>
<p>Finding the majority bit in the leftmost position is easy. Using â‰¤ means that
when there are an equal number of 0s and 1s we prefer 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="nv">test3</span>  <span class="c1">â take first from bit mask where 6 â‰¤ column sums</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Here is one way to get the first (leftmost) bit of each row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">âŠ£</span><span class="na">/</span><span class="nv">test3</span>  <span class="c1">â i.e. first column</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1 1 1 0 0 1 1 1 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="nv">test3</span>  <span class="c1">â bit mask of rows matching majority bit...</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1 1 1 0 0 1 1 1 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="nv">test3</span><span class="p">)</span><span class="na">âŒ¿</span><span class="nv">test3</span>  <span class="c1">â select just the matching rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0
1 0 1 1 0
1 0 1 1 1
1 0 1 0 1
1 1 1 0 0
1 0 0 0 0
1 1 0 0 1
</span></div></div>
</div>
<p>Now we just need to rotate the masks and then iterate this n times
where n is the number of bits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">âŒ½</span><span class="p">((</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="nv">test3</span><span class="p">)</span><span class="na">âŒ¿</span><span class="nv">test3</span>  <span class="c1">â rotate left</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 1
0 1 1 0 1
0 1 1 1 1
0 1 0 1 1
1 1 0 0 1
0 0 0 0 1
1 0 0 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">âŒ½</span><span class="p">((</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âŒ¿</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">â£</span><span class="m">5</span><span class="p">)</span><span class="nv">test3</span>  <span class="c1">â star dot means do 5 times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 1
</span></div></div>
</div>
<p>This idea almost works, except we have to deal with the case where there is
just one match left. Then we need to keep it for the next iteration whether or
not its current bit is 1 (the tiebreaker). Also, our result will actually be a
2d matrix with one row; the , operator converts it back down to a vector.</p>
<p>Now we can do this again for the minority bits and then convert to decimal
and multiply to get the answer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">o2_rating</span><span class="kd">â†</span><span class="o">,</span><span class="kt">{</span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">âŒ½</span><span class="p">(((</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">â‰¤+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âˆ¨</span><span class="p">((</span><span class="o">â‰¢</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="na">âŒ¿</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">â£</span><span class="p">(</span><span class="m">2</span><span class="o">âŠƒâ´</span><span class="bp">âµ</span><span class="p">))</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">co2_rating</span><span class="kd">â†</span><span class="o">,</span><span class="kt">{</span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">âŒ½</span><span class="p">(((</span><span class="o">âŠƒ</span><span class="p">((</span><span class="m">2</span><span class="o">Ã·</span><span class="na">â¨</span><span class="p">(</span><span class="o">â‰¢âŠ¢</span><span class="p">))</span><span class="o">&gt;+</span><span class="na">âŒ¿</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=âŠ£</span><span class="na">/</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âˆ¨</span><span class="p">((</span><span class="o">â‰¢</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="na">âŒ¿</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">â£</span><span class="p">(</span><span class="m">2</span><span class="o">âŠƒâ´</span><span class="bp">âµ</span><span class="p">))</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">o2_rating</span><span class="o">Ã—</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">co2_rating</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span> <span class="nv">test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">230
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span> <span class="nv">data3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5410338
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-4">
<h2>Day 4<a class="headerlink" href="#day-4" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/4">Puzzle link</a></p>
<p>Weâ€™re playing bingo today. Calls are on the first input line, and
cards follow separated by blank lines. Rather than try to parse this
into one array and unbox it again later, weâ€™ll just split it out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test4_calls</span><span class="kd">â†</span><span class="o">â</span><span class="na">Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day4-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 4 9 5 11 17 23 2 0 14 21 24 10 16 13 6 15 25 12 22 18 20 8 19 3 26 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test4_cards</span><span class="kd">â†</span><span class="o">â†‘â†‘â</span><span class="na">Â¨Â¨</span><span class="kt">{</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="o">â‰¢âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŠ†</span><span class="bp">âµ</span><span class="kt">}</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day4-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22 13 17 11  0
 8  2 23  4 24
21  9 14 16  7
 6 10  3 18  5
 1 12 20 15 19

 3 15  0  2 22
 9 18 13 17  5
19  8  7 25 23
20 11 10 24  4
14 21 16 12  6

14 21 17 24  4
10 16 15  9 19
18  8 23 26 20
22 11 13  6  5
 2  0 12  3  7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data4_calls</span><span class="kd">â†</span><span class="o">â</span><span class="na">Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day4-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data4_cards</span><span class="kd">â†</span><span class="o">â†‘â†‘â</span><span class="na">Â¨Â¨</span><span class="kt">{</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="o">â‰¢âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŠ†</span><span class="bp">âµ</span><span class="kt">}</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day4-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Weâ€™ll be using 5x5 bit matrices to match called positions.
In this variant of bingo, diagonals donâ€™t count, so we just need
to sum up 1s in each row and column to detect bingos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">bingo</span><span class="kd">â†</span><span class="o">âˆ¨</span><span class="na">/</span><span class="m">5</span><span class="o">=</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="o">âŠ¢</span><span class="p">)</span><span class="o">,+</span><span class="na">âŒ¿</span><span class="p">)</span>  <span class="c1">â or over boolean 5 = row sums cat col sums</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Part 1<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<p>We compute bit matrices of marked numbers for each prefix of calls.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="o">â†‘,</span><span class="na">\</span><span class="nv">test4_calls</span>  <span class="c1">â e.g. scan cat to get prefixes of calls (5 shown for example)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚7â”‚7 4â”‚7 4 9â”‚7 4 9 5â”‚7 4 9 5 11â”‚
â””â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">âŒ¿</span><span class="m">7</span> <span class="m">4</span> <span class="m">9</span><span class="na">âˆ˜.</span><span class="o">â·</span><span class="nv">test4_cards</span>  <span class="c1">â e.g. sum â· to mark positions of 7 4 9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0
0 0 0 1 0
0 1 0 0 1
0 0 0 0 0
0 0 0 0 0

0 0 0 0 0
1 0 0 0 0
0 0 1 0 0
0 0 0 0 1
0 0 0 0 0

0 0 0 0 1
0 0 0 1 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test4_game</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">âŒ¿</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜.</span><span class="o">â·</span><span class="nv">test4_cards</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">,</span><span class="na">\</span><span class="nv">test4_calls</span>  <span class="c1">â mark cards for each call prefix</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can find the first bingo round and board.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">âŠƒ</span><span class="m">1</span><span class="p">(</span><span class="o">â¸â·</span><span class="p">)</span><span class="o">â†‘</span><span class="p">((</span><span class="nv">bingo</span><span class="na">â¤</span><span class="m">2</span><span class="p">)</span><span class="na">Â¨</span><span class="nv">test4_game</span><span class="p">)</span>  <span class="c1">â bingo over 2nd axis submatrices, find first one</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12 3
</span></div></div>
</div>
<p>Probably this could all go in some kind of horrible one liner but instead
I will put it into a dfn with names and things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day4_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">cards</span> <span class="nv">calls</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">game</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">âŒ¿</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜.</span><span class="o">â·</span><span class="nv">cards</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">,</span><span class="na">\</span><span class="nv">calls</span>   <span class="c1">â bit matrices for each prefix of calls </span>
  <span class="nv">round</span> <span class="nv">card</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="m">1</span><span class="p">(</span><span class="o">â¸â·</span><span class="p">)</span><span class="o">â†‘</span><span class="p">((</span><span class="nv">bingo</span><span class="na">â¤</span><span class="m">2</span><span class="p">)</span><span class="na">Â¨</span><span class="nv">game</span><span class="p">)</span>  <span class="c1">â round and card of first bingo</span>
  <span class="c1">â score is winning call times sum of uncalled numbers on winning card</span>
  <span class="p">(</span><span class="nv">round</span><span class="o">âŒ·</span><span class="nv">calls</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">~</span><span class="nv">card</span><span class="o">âŒ·â†‘</span><span class="nv">round</span><span class="o">âŒ·</span><span class="nv">game</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">card</span><span class="o">âŒ·</span><span class="nv">cards</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_1</span> <span class="nv">test4_cards</span> <span class="nv">test4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4512
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_1</span> <span class="nv">data4_cards</span> <span class="nv">data4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">63424
</span></div></div>
</div>
</div>
<div class="section" id="id6">
<h3>Part 2<a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h3>
<p>Now we need to cheat instead and find the last winning card.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day4_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">cards</span> <span class="nv">calls</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">game</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">âŒ¿</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜.</span><span class="o">â·</span><span class="nv">cards</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">,</span><span class="na">\</span><span class="nv">calls</span>
  <span class="c1">â last card to win and round in which it wins</span>
  <span class="c1">â (sum 1s for each non-winning row of col per card)</span>
  <span class="nv">round</span> <span class="nv">card</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŒˆ</span><span class="na">/</span><span class="o">,âŠ¢â³âŒˆ</span><span class="na">/</span><span class="p">)</span><span class="m">1</span><span class="o">++</span><span class="na">âŒ¿</span><span class="o">~â†‘</span><span class="p">((</span><span class="nv">bingo</span><span class="na">â¤</span><span class="m">2</span><span class="p">)</span><span class="na">Â¨</span><span class="nv">game</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">round</span><span class="o">âŒ·</span><span class="nv">calls</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">~</span><span class="nv">card</span><span class="o">âŒ·â†‘</span><span class="nv">round</span><span class="o">âŒ·</span><span class="nv">game</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">card</span><span class="o">âŒ·</span><span class="nv">cards</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_2</span> <span class="nv">test4_cards</span> <span class="nv">test4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1924
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_2</span> <span class="nv">data4_cards</span> <span class="nv">data4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23541
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-5">
<h2>Day 5<a class="headerlink" href="#day-5" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/5">Puzzle link</a></p>
<p>Today we get to plot lines. Splitting on â€˜,â€™ and â€˜ -&gt; â€˜ is a little
different since usually we split on one character; âˆŠ gives an
array with 1s for delimiter chars ~ flips it for partition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test5</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="kt">{</span><span class="s1">&#39;, -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">â¤</span><span class="o">âˆŠ</span><span class="na">â¨</span><span class="o">âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day5-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 9 5 9
8 0 0 8
9 4 3 4
2 2 2 1
7 0 7 4
6 4 2 0
0 9 2 9
3 4 1 4
0 0 8 8
5 5 8 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data5</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="kt">{</span><span class="s1">&#39;, -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">â¤</span><span class="o">âˆŠ</span><span class="na">â¨</span><span class="o">âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day5-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>Part 1<a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>We are supposed to consider just horizontal or vertical lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">h_or_v</span><span class="kd">â†</span><span class="kt">{</span><span class="p">((</span><span class="m">1</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="m">3</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">))</span><span class="o">âˆ¨</span><span class="p">((</span><span class="m">2</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="m">4</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">))</span><span class="kt">}</span>  <span class="c1">â same x or y</span>
</pre></div>
</div>
</div>
</div>
<p>To find all the intersections weâ€™ll just plot them all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day5_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â counts overlapping points for horizontal and vertical lines only </span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="m">1000</span> <span class="m">1000</span><span class="o">â´</span><span class="m">0</span>
  <span class="nv">plot_hv</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â plots a horizontal or vertical line in grid</span>
    <span class="nv">line</span><span class="kd">â†</span><span class="bp">âµ</span>                  <span class="c1">â x1 y1 x2 y2</span>
    <span class="nv">p1</span><span class="kd">â†</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span><span class="o">âŒŠ</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>  <span class="c1">â p1 is lower leftmost</span>
    <span class="nv">p2</span><span class="kd">â†</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span><span class="o">âŒˆ</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>  <span class="c1">â p2 is upper rightmost</span>
    <span class="nv">pts</span><span class="kd">â†</span><span class="p">(</span><span class="o">,â³</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">))</span><span class="o">+</span><span class="na">Â¨</span><span class="o">âŠ‚</span><span class="nv">p1</span>  <span class="c1">â indices from p1 to p2 inclusive</span>
    <span class="nv">grid</span><span class="sr">[</span><span class="nv">pts</span><span class="sr">]</span><span class="o">+</span><span class="kd">â†</span><span class="m">1</span>            <span class="c1">â plot the points</span>
    <span class="no">â¬</span>
  <span class="kt">}</span>
  <span class="nv">hv</span><span class="kd">â†</span><span class="p">((</span><span class="nv">h_or_v</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âŒ¿</span><span class="bp">âµ</span>  <span class="c1">â reduce lines over h_or_v on each row</span>
  <span class="nv">_</span><span class="kd">â†</span><span class="nv">plot_hv</span><span class="na">Â¨</span><span class="o">â†“</span><span class="nv">hv</span>       <span class="c1">â plot the lines</span>
  <span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">)</span><span class="nv">grid</span><span class="o">â‰¥</span><span class="m">2</span>         <span class="c1">â sum where grid â‰¥ 2</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_1</span> <span class="nv">test5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_1</span> <span class="nv">data5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4655
</span></div></div>
</div>
</div>
<div class="section" id="id8">
<h3>Part 2<a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h3>
<p>Now we are supposed to consider all the lines. This is actually a
little easier. The trickiest bit is just generating the plot indices.
The key idea is that Ã—p2-p1 is a unit vector from p1 to p2 (scalar Ã—
is the sign function).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day5_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â counts overlapping points for horizontal, vertical, and diagonal lines</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="m">1000</span> <span class="m">1000</span><span class="o">â´</span><span class="m">0</span>
  <span class="nv">plot</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â plots a line in the grid</span>
    <span class="nv">line</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">p1</span><span class="kd">â†</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span>
    <span class="nv">p2</span><span class="kd">â†</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>
    <span class="c1">â iota length times unit vector</span>
    <span class="nv">ds</span><span class="kd">â†</span><span class="p">((</span><span class="o">â³</span><span class="p">(</span><span class="m">1</span><span class="o">+âŒˆ</span><span class="na">/</span><span class="o">|</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">))</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="na">âˆ˜.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">Ã—</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">)</span>
    <span class="nv">pts</span><span class="kd">â†</span><span class="nv">ds</span><span class="o">+</span><span class="p">((</span><span class="o">â´</span><span class="nv">ds</span><span class="p">)</span><span class="o">â´</span><span class="p">(</span><span class="m">1</span> <span class="m">1</span><span class="o">+</span><span class="nv">p1</span><span class="p">))</span>  <span class="c1">â add back p1</span>
    <span class="nv">grid</span><span class="sr">[</span><span class="o">â†“</span><span class="nv">pts</span><span class="sr">]</span><span class="o">+</span><span class="kd">â†</span><span class="m">1</span>
    <span class="no">â¬</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">â†</span><span class="nv">plot</span><span class="na">Â¨</span><span class="o">â†“</span><span class="bp">âµ</span>   <span class="c1">â plot the lines</span>
  <span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">)</span><span class="nv">grid</span><span class="o">â‰¥</span><span class="m">2</span> <span class="c1">â sum where grid â‰¥ 2</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_2</span> <span class="nv">test5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_2</span> <span class="nv">data5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20500
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-6">
<h2>Day 6<a class="headerlink" href="#day-6" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/6">Puzzle link</a></p>
<p>Today we have to simulate fish reproduction. Great.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test6</span><span class="kd">â†</span><span class="m">3</span> <span class="m">4</span> <span class="m">3</span> <span class="m">1</span> <span class="m">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data6</span><span class="kd">â†</span><span class="o">âŠƒâ</span><span class="na">Â¨Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day6-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Part 1<a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>For small numbers of fish this is just a one liner. We concatenate
new 8s for each 0, replace 0s with 7s, and decrement everything so
really 0s become 6s. The starfish operator iterates (appropriately).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span><span class="kd">â†</span><span class="o">â‰¢</span><span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="m">7</span><span class="o">Ã—</span><span class="p">(</span><span class="m">0</span><span class="o">=</span><span class="bp">âµ</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="bp">âµ</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="o">,</span><span class="kt">{</span><span class="m">8</span><span class="o">+</span><span class="bp">âµ</span><span class="na">/â¨</span><span class="p">(</span><span class="m">0</span><span class="na">âˆ˜</span><span class="o">=</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span><span class="p">)</span><span class="na">â£</span><span class="m">80</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span> <span class="nv">test6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5934
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span> <span class="nv">data6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">377263
</span></div></div>
</div>
</div>
<div class="section" id="id10">
<h3>Part 2<a class="headerlink" href="#id10" title="Permalink to this headline">Â¶</a></h3>
<p>All right, 256 days is too many to cheese this. We will keep a census
of fish in the population instead of storing one number per fish.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day6_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â (n day6_2 fish) returns population size after n generations</span>
  <span class="nv">n</span><span class="kd">â†</span><span class="bp">âº</span>
  <span class="nv">census</span><span class="kd">â†</span><span class="m">9</span><span class="o">â´</span><span class="m">0</span>     <span class="c1">â init to zero of each age</span>
  <span class="nv">census</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="bp">âµ</span><span class="sr">]</span><span class="o">+</span><span class="kd">â†</span><span class="m">1</span> <span class="c1">â add 1 to count of age for each fish</span>
  <span class="c1">â 1âŠ– rotates the current ages down 1</span>
  <span class="nv">generation</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">âŠ–</span><span class="bp">âµ</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="o">,</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span>
  <span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">generation</span><span class="na">â£</span><span class="nv">n</span><span class="p">)</span><span class="nv">census</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">â•PP</span><span class="kd">â†</span><span class="m">16</span>  <span class="c1">â we need more precision, apparently</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">256</span> <span class="nv">day6_2</span> <span class="nv">test6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26984457539
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">256</span> <span class="nv">day6_2</span> <span class="nv">data6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1695929023803
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-7">
<h2>Day 7<a class="headerlink" href="#day-7" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/7">Puzzle link</a></p>
<p>Something with crabs. I canâ€™t even with this today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test7</span><span class="kd">â†</span><span class="o">â</span><span class="na">Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day7-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16 1 2 0 4 2 7 1 2 14
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data7</span><span class="kd">â†</span><span class="o">â</span><span class="na">Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day7-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h3>Part 1<a class="headerlink" href="#id11" title="Permalink to this headline">Â¶</a></h3>
<p>Find the minimum fuel cost for all crabs to align. It makes no sense
to move away from all the other crabs so this will clearly occur at a
point inside the convex hull of the crabs.</p>
<p>For part 1 this should occur at some crabâ€™s current position. Consider
a non-crab position with M crabs to the left and N crabs to the right,
where the nearest crab in either direction is m or n units away.
Choosing the nearest left crabâ€™s position instead would reduce cost by
Î´=(M-N)m; right would reduce by Î´=(N-M)n. m&gt;0, n&gt;0, and either M-Nâ‰¥0 or
N-Mâ‰¥0 or both so this is the same or better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">v</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="o">âŒŠ</span><span class="na">/</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">|</span><span class="bp">âµ</span><span class="o">-</span><span class="na">â¨</span><span class="nv">v</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">v</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span> <span class="nv">test7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span> <span class="nv">data7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">357353
</span></div></div>
</div>
</div>
<div class="section" id="id12">
<h3>Part 2<a class="headerlink" href="#id12" title="Permalink to this headline">Â¶</a></h3>
<p>The new cost function uses triangular numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tri</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="bp">âµ</span><span class="o">Ã—</span><span class="p">(</span><span class="bp">âµ</span><span class="o">+</span><span class="m">1</span><span class="p">))</span><span class="o">Ã·</span><span class="m">2</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>The minimum fuel cost isnâ€™t at some crabâ€™s current position anymore.
For example, now it costs 1+1 for x=0 and x=2 to meet at x=1, but it
would cost 1+2 for them to meet at x=0 or x=2. But the minimum is
still in the convex hull, so just search over the whole range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">v</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="o">âŒŠ</span><span class="na">/</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="nv">tri</span><span class="p">(</span><span class="o">|</span><span class="bp">âµ</span><span class="o">-</span><span class="nv">v</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">â³âŒˆ</span><span class="na">/</span><span class="nv">v</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span> <span class="nv">test7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">168
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span> <span class="nv">data7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">104822130
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-8">
<h2>Day 8<a class="headerlink" href="#day-8" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/8">Puzzle link</a></p>
<p>Weâ€™re sorting out really specifically mangled wiring today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test8</span><span class="kd">â†</span><span class="o">â†‘</span><span class="s1">&#39;|&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day8-test.txt&#39;</span> <span class="m">1</span>  <span class="c1">â extra spaces are ok</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚be cfbegad cbdgef fgaecd cgeb fdcge agebfd fecdb fabcd edb â”‚ fdgacbe cefdb cef
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚edbfga begcd cbg gc gcadebf fbgde acbgfd abcde gfcbed gfec â”‚ fcgedb cgb dgebac
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚fgaebd cg bdaec gdafb agbcfd gdcbef bgcad gfac gcb cdgabef â”‚ cg cg fdcagb cbg 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚fbegcd cbd adcefb dageb afcb bc aefdc ecdab fgdeca fcdbega â”‚ efabcd cedba gadf
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚aecbfdg fbg gf bafeg dbefa fcge gcbea fcaegb dgceab fcbdga â”‚ gecf egdcabf bgf 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚fgeab ca afcebg bdacfeg cfaedg gcfdb baec bfadeg bafgc acf â”‚ gebdcfa ecba ca f
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚dbcfg fgd bdegcaf fgec aegbdf ecdfab fbedc dacgb gdcebf gf â”‚ cefg dcbef fcge g
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚bdfegc cbegaf gecbf dfcage bdacg ed bedf ced adcbefg gebcd â”‚ ed bcgafe cdgba c
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚egadfb cdbfeg cegd fecab cgb gbdefca cg fgcdab egfdb bfceg â”‚ gbdfcae bgc cg cg
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚gcafb gcf dcaebfg ecagb gf abcdeg gaef cafbge fdbac fegbdc â”‚ fgae cfgab fg bag
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      â”€â”€â”€â”€â”€â”€â”€â”€â”
      bgd gcbeâ”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      f gc    â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      ec cb   â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      bfgea   â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      adegcb  â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      bcadfe  â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      bgef    â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      b       â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      ce      â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data8</span><span class="kd">â†</span><span class="o">â†‘</span><span class="s1">&#39;|&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day8-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>In theory one could probably do this with boolean algebra and logic.  But
we are absolutely going to cheese this instead, so will be needing a way to
generate permutations. I got this from APLcart. Instead of thinking about
fancy lightbulbs, letâ€™s think about how it works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">â³</span><span class="bp">âµ</span><span class="p">)(</span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="na">â£</span><span class="bp">âµ</span><span class="o">â‰âª</span><span class="no">â¬</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>It is iterating something âµ times on â³âµ and â‰âªâ¬. That something is ,[â³2](âŠ¢,â¤1 0~).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  â”Œâ”€â”€â”´â”€â”€â”  
  [1Â·2] â¤  
â”Œâ”€â”˜   â”Œâ”€â”´â”€â”
,   â”Œâ”€â”¼â”€â” 1
    âŠ¢ â¤ ~  
     â”Œâ”´â”   
     , 1 0 
</span></div></div>
</div>
<p>,â¤1 0 pairs the left vector with each element from the right; (âŠ¢(,â¤1 0)~) instead pairs the right vector with each element from the left less those from the right.  ,[â³2] is catenate with an axis specification [1 2] presumably to put things into rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">d8p1</span><span class="kd">â†</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="o">â‰âª</span><span class="no">â¬</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
2
3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">d8p2</span><span class="kd">â†</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="nv">d8p1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
1 3
2 1
2 3
3 1
3 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="nv">d8p2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
1 3 2
2 1 3
2 3 1
3 1 2
3 2 1
</span></div></div>
</div>
<p>So this is iteratively catenating new rows with each element of â³3 not in the left. Kinda mind blowing.</p>
<div class="section" id="id13">
<h3>Part 1<a class="headerlink" href="#id13" title="Permalink to this headline">Â¶</a></h3>
<p>For part 1 we are just supposed to count up strings of certain lengthsâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">7</span><span class="p">)</span><span class="o">âˆŠ</span><span class="na">â¨</span><span class="o">â‰¢</span><span class="na">Â¨</span><span class="o">,â†‘</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="p">(</span><span class="m">1</span><span class="na">âˆ˜</span><span class="o">â†“</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span> <span class="nv">test8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span> <span class="nv">data8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">470
</span></div></div>
</div>
</div>
<div class="section" id="id14">
<h3>Part 2<a class="headerlink" href="#id14" title="Permalink to this headline">Â¶</a></h3>
<p>Now we have to figure out whatâ€™s up with the wiring. We first define the
canonical set of segments for each digit from 0 to 9.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">digits</span><span class="kd">â†</span><span class="s1">&#39;abcefg&#39;</span> <span class="s1">&#39;cf&#39;</span> <span class="s1">&#39;acdeg&#39;</span> <span class="s1">&#39;acdfg&#39;</span> <span class="s1">&#39;bcdf&#39;</span> <span class="s1">&#39;abdfg&#39;</span> <span class="s1">&#39;abdefg&#39;</span> <span class="s1">&#39;acf&#39;</span> <span class="s1">&#39;abcdefg&#39;</span> <span class="s1">&#39;abcdfg&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We will also need a helper which translates corresponding values from one array to another, also from APLcart.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">translate</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âºâº</span><span class="p">(</span><span class="bp">âµâµ</span><span class="o">âŒ·</span><span class="na">â¨âˆ˜</span><span class="o">âŠ‚â³</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="o">âˆŠ</span><span class="na">âˆ˜</span><span class="bp">âºâº</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;12345&#39;</span><span class="nv">translate</span><span class="s1">&#39;abcde&#39;</span><span class="p">)</span><span class="s1">&#39;52341&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ebcda
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations_of_length_7</span><span class="kd">â†</span><span class="nv">permutations</span> <span class="m">7</span>
</pre></div>
</div>
</div>
</div>
<p>To decode the scrambled up displays, we will just try all 5040 permutations
on the scrambled digit set until we get the canonical digit set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">decode_display</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">patterns</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span><span class="sr">[</span><span class="o">â‹</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒ</span><span class="p">(</span><span class="m">1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="p">)</span>  <span class="c1">â scrambled segment sets for each digit</span>
  <span class="nv">readout</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span><span class="sr">[</span><span class="o">â‹</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="o">âŠƒ</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span>   <span class="c1">â segment sets we are supposed to decode</span>
  <span class="nv">trial</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">assignment</span><span class="kd">â†</span><span class="s1">&#39;abcdefg&#39;</span><span class="sr">[</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="sr">]</span>  <span class="c1">â segment permutation to assume</span>
    <span class="c1">â find index of each remapped pattern in canonical digits</span>
    <span class="nv">code</span><span class="kd">â†</span><span class="nv">digits</span><span class="o">â³</span><span class="p">(</span><span class="kt">{</span><span class="bp">âµ</span><span class="sr">[</span><span class="o">â‹</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="p">(</span><span class="nv">assignment</span> <span class="nv">translate</span><span class="s1">&#39;abcdefg&#39;</span><span class="p">)</span><span class="na">Â¨</span><span class="nv">patterns</span><span class="p">)</span>
    <span class="c1">â if all digits found, decode the readout </span>
    <span class="p">(</span><span class="o">âˆ§</span><span class="na">/</span><span class="nv">code</span><span class="o">â‰¤</span><span class="m">10</span><span class="p">)</span><span class="bp">:</span><span class="m">10</span><span class="o">âŠ¥</span><span class="nv">code</span><span class="sr">[</span><span class="nv">patterns</span><span class="o">â³</span><span class="nv">readout</span><span class="sr">]</span><span class="o">-</span><span class="m">1</span>
    <span class="p">((</span><span class="o">â‰¢</span><span class="bp">âµ</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="s1">&#39;error&#39;</span>
    <span class="bp">âˆ‡</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="nv">trial</span><span class="p">(</span><span class="o">â†“</span><span class="nv">permutations_of_length_7</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="nv">decode_display</span><span class="na">Â¨</span><span class="o">â†“</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span> <span class="nv">test8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">61229
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span> <span class="nv">data8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">989396
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-9">
<h2>Day 9<a class="headerlink" href="#day-9" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/9">Puzzle link</a></p>
<p>Woo hoo, today looks really array-ish.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test9</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day9-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 1 9 9 9 4 3 2 1 0
3 9 8 7 8 9 4 9 2 1
9 8 5 6 7 8 9 8 9 2
8 7 6 7 8 9 6 7 8 9
9 8 9 9 9 6 5 6 7 8
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data9</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day9-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h3>Part 1<a class="headerlink" href="#id15" title="Permalink to this headline">Â¶</a></h3>
<p>APLâ€™s âŒº operator lets us count in neighborhoods really easily.
Technically this problem doesnâ€™t include diagonal neighbors but it
works anyways because of what weâ€™re doing and I reaaallly wanna use
it, ok?</p>
<p>We find a bit matrix of all the 3x3s where the center element is
â‰¤ all its neighbors, dropping those that are padding. Then get the
values at those indices and add 1 and sum reduce. Wheeâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">+</span><span class="bp">âµ</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âˆ§</span><span class="na">/Â¨</span><span class="o">,</span><span class="na">Â¨</span><span class="p">(</span><span class="kt">{</span><span class="o">âŠ‚</span><span class="bp">âº</span><span class="o">â†“</span><span class="p">((</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¤</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âŠ¢</span><span class="bp">âµ</span><span class="p">))</span><span class="sr">]</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span> <span class="nv">test9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span> <span class="nv">data9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">545
</span></div></div>
</div>
</div>
<div class="section" id="id16">
<h3>Part 2<a class="headerlink" href="#id16" title="Permalink to this headline">Â¶</a></h3>
<p>We have to count the sizes of connected regions in an array. Originally I just
solved this with a chesy flood fill, but I was hoping there would be a clever
morphological image processing way to do this.</p>
<p>The idea would be to build a bit matrix and have the 1s â€œflowâ€ to
adjacent cells. But thereâ€™s ambiguity about which way they should flow. For
example, the test has an 8 surrounded by two 7s. The flow could â€œsplitâ€,
but then thatâ€™s nonlocal. So I guess Iâ€™ll stick with the flood fill.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">flood_fill</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">to_visit</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="m">1</span><span class="o">âŒ·</span><span class="bp">âµ</span>
  <span class="nv">visited</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="m">2</span><span class="o">âŒ·</span><span class="bp">âµ</span>
  <span class="nv">regions</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="m">3</span><span class="o">âŒ·</span><span class="bp">âµ</span>
  <span class="p">((</span><span class="o">â‰¢</span><span class="nv">to_visit</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">visited</span>
  <span class="nv">next</span><span class="kd">â†</span><span class="m">1</span><span class="o">â†‘</span><span class="nv">to_visit</span>
  <span class="nv">already_visited</span><span class="kd">â†</span><span class="o">âˆ¨</span><span class="na">/</span><span class="o">âˆ¨</span><span class="na">/</span><span class="nv">next</span><span class="o">â·</span><span class="nv">visited</span>
  <span class="nv">outside</span><span class="kd">â†</span><span class="nv">next</span><span class="kt">{</span><span class="m">3</span><span class="bp">::</span><span class="m">1</span> <span class="p">â‹„</span> <span class="m">0</span><span class="o">=</span><span class="p">((</span><span class="o">âŠƒ</span><span class="bp">âº</span><span class="p">)</span><span class="o">âŒ·â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="nv">regions</span>
  <span class="p">(</span><span class="nv">already_visited</span><span class="o">âˆ¨</span><span class="nv">outside</span><span class="p">)</span><span class="bp">:âˆ‡</span><span class="p">((</span><span class="m">1</span><span class="o">â†“</span><span class="nv">to_visit</span><span class="p">)</span><span class="nv">visited</span> <span class="nv">regions</span><span class="p">)</span>
  <span class="nv">nextp</span><span class="kd">â†</span><span class="p">(</span><span class="nv">next</span><span class="o">+</span><span class="p">((</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">Â¯1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">Â¯1</span><span class="p">)))</span><span class="o">,</span><span class="m">1</span><span class="o">â†“</span><span class="nv">to_visit</span>
  <span class="nv">visitedp</span><span class="kd">â†</span><span class="nv">visited</span><span class="o">,</span><span class="nv">next</span>
  <span class="bp">âˆ‡</span><span class="p">(</span><span class="nv">nextp</span> <span class="nv">visitedp</span> <span class="nv">regions</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day9_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">sinks</span><span class="kd">â†</span><span class="kt">{</span><span class="o">â¸</span><span class="p">(</span><span class="o">âˆ§</span><span class="na">/Â¨</span><span class="o">,</span><span class="na">Â¨</span><span class="p">(</span><span class="kt">{</span><span class="o">âŠ‚</span><span class="bp">âº</span><span class="o">â†“</span><span class="p">((</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¤</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âŠ¢</span><span class="bp">âµ</span><span class="p">))</span><span class="kt">}</span><span class="bp">âµ</span>  <span class="c1">â sink positions</span>
  <span class="nv">basins</span><span class="kd">â†</span><span class="o">~</span><span class="m">9</span><span class="o">=</span><span class="bp">âµ</span>  <span class="c1">â bitmask of basins</span>
  <span class="nv">region_size</span><span class="kd">â†</span><span class="o">â‰¢</span><span class="m">1</span><span class="o">â†“</span><span class="kt">{</span><span class="nv">flood_fill</span><span class="p">(</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="p">)(</span><span class="o">âŠ‚</span><span class="no">â¬</span><span class="p">)(</span><span class="o">âŠ‚</span><span class="nv">basins</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">sizes</span><span class="kd">â†</span><span class="nv">region_size</span><span class="na">Â¨</span><span class="nv">sinks</span>
  <span class="o">Ã—</span><span class="na">/</span><span class="nv">sizes</span><span class="sr">[</span><span class="m">3</span><span class="o">â†‘â’</span><span class="nv">sizes</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_2</span> <span class="nv">test9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1134
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_2</span> <span class="nv">data9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">950600
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-10">
<h2>Day 10<a class="headerlink" href="#day-10" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/10">Puzzle link</a></p>
<p>Parsing stuff today. Not really APLâ€™s strong suit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test10</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day10-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€
â”‚[({(&lt;(())[]&gt;[[{[]{&lt;()&lt;&gt;&gt;â”‚[(()[&lt;&gt;])]({[&lt;{&lt;&lt;[]&gt;&gt;(â”‚{([(&lt;{}[&lt;&gt;[]}&gt;{[]{[(&lt;()&gt;â”‚(((({
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€

      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€
      &lt;&gt;}&lt;{&lt;{&lt;&gt;}{[]{[]{}â”‚[[&lt;[([]))&lt;([[{}[[()]]]â”‚[{[{({}]{}}([{[{{{}}([]â”‚{&lt;[[]]&gt;
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€

      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      }&lt;{[{[{[]{()[[[]â”‚[&lt;(&lt;(&lt;(&lt;{}))&gt;&lt;([]([]()â”‚&lt;{([([[(&lt;&gt;()){}]&gt;(&lt;&lt;{{â”‚&lt;{([{{}}[&lt;
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      [[[&lt;&gt;{}]]]&gt;[]]â”‚
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data10</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day10-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Thereâ€™s nothing particularly hard here but Dyalog really liked to crash with
a mysterious error 139 a lot. So some of the code is a little awkward because
I kept modifying it not to break the interpreter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_chunks</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">expr</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">stack</span><span class="kd">â†</span><span class="no">â¬</span>
  <span class="nv">next_char</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">i</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">i</span><span class="o">&gt;â‰¢</span><span class="nv">expr</span><span class="bp">:</span><span class="m">0</span>
    <span class="nv">c</span><span class="kd">â†</span><span class="nv">expr</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="c1">â for opening chars, push the expected closing char</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;]&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;}&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;)&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;&gt;&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">c</span><span class="o">âˆŠ</span><span class="s1">&#39;[{(&lt;&#39;</span><span class="bp">:âˆ‡</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
    <span class="c1">â for closing chars, check if they match</span>
    <span class="nv">match</span><span class="kd">â†</span><span class="kt">{</span>
      <span class="nv">top</span><span class="kd">â†</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="nv">stack</span>
      <span class="nv">stack</span><span class="o">âŠ¢</span><span class="kd">â†</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="nv">stack</span>
      <span class="nv">c</span><span class="o">=</span><span class="nv">top</span>
    <span class="kt">}</span><span class="m">0</span>
    <span class="nv">match</span><span class="bp">:âˆ‡</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">â char matches keep going</span>
    <span class="c1">â wrong closing char score it</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;)&#39;</span><span class="bp">:</span><span class="m">3</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="bp">:</span><span class="m">57</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;}&#39;</span><span class="bp">:</span><span class="m">1197</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="bp">:</span><span class="m">25137</span>
  <span class="kt">}</span>
  <span class="nv">next_char</span> <span class="m">1</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id17">
<h3>Part 1<a class="headerlink" href="#id17" title="Permalink to this headline">Â¶</a></h3>
<p>Score the mismatched closing chars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">parse_chunks</span><span class="na">Â¨</span><span class="o">âŠ¢</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span> <span class="nv">test10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26397
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span> <span class="nv">data10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">343863
</span></div></div>
</div>
</div>
<div class="section" id="id18">
<h3>Part 2<a class="headerlink" href="#id18" title="Permalink to this headline">Â¶</a></h3>
<p>Now we need to add up the stack contents instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_chunks2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">expr</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">stack</span><span class="kd">â†</span><span class="no">â¬</span>
  <span class="nv">next_char</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">i</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">i</span><span class="o">&gt;â‰¢</span><span class="nv">expr</span><span class="bp">:</span><span class="m">0</span>
    <span class="nv">c</span><span class="kd">â†</span><span class="nv">expr</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="c1">â for opening chars, push the expected closing char</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;]&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;}&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;)&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">â†</span><span class="s1">&#39;&gt;&#39;</span> <span class="p">â‹„</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">c</span><span class="o">âˆŠ</span><span class="s1">&#39;[{(&lt;&#39;</span><span class="bp">:âˆ‡</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
    <span class="c1">â for closing chars, check if they match</span>
    <span class="nv">match</span><span class="kd">â†</span><span class="kt">{</span>
      <span class="nv">top</span><span class="kd">â†</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="nv">stack</span>
      <span class="nv">stack</span><span class="o">âŠ¢</span><span class="kd">â†</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="nv">stack</span>
      <span class="nv">c</span><span class="o">=</span><span class="nv">top</span>
    <span class="kt">}</span><span class="m">0</span>
    <span class="nv">match</span><span class="bp">:âˆ‡</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">â char matches keep going</span>
    <span class="m">1</span>  <span class="c1">â this is a corrupted line skip it</span>
  <span class="kt">}</span>
  <span class="nv">corrupt</span><span class="kd">â†</span><span class="nv">next_char</span> <span class="m">1</span>
  <span class="nv">corrupt</span><span class="bp">:</span><span class="m">0</span>
  <span class="c1">â score the expected completion if not corrupt</span>
  <span class="m">5</span><span class="o">âŠ¥</span><span class="kt">{</span><span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;)&#39;</span><span class="bp">:</span><span class="m">1</span> <span class="p">â‹„</span> <span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="bp">:</span><span class="m">2</span> <span class="p">â‹„</span> <span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;}&#39;</span><span class="bp">:</span><span class="m">3</span> <span class="p">â‹„</span> <span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="bp">:</span><span class="m">4</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">âŒ½</span><span class="nv">stack</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day10_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">scores</span><span class="kd">â†</span><span class="p">(</span><span class="m">0</span><span class="na">âˆ˜</span><span class="o">â‰ </span><span class="p">)</span><span class="kt">{</span><span class="bp">âµ</span><span class="na">/â¨</span><span class="bp">âºâº</span> <span class="bp">âµ</span><span class="kt">}</span><span class="nv">parse_chunks2</span><span class="na">Â¨</span><span class="bp">âµ</span>  <span class="c1">â nonzero scores</span>
  <span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠ‚â‹</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="kt">}</span><span class="nv">scores</span><span class="p">)</span><span class="sr">[</span><span class="o">âŒˆ</span><span class="p">(</span><span class="o">â‰¢</span><span class="nv">scores</span><span class="p">)</span><span class="o">Ã·</span><span class="m">2</span><span class="sr">]</span>       <span class="c1">â middle of sorted scores</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_2</span> <span class="nv">test10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">288957
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_2</span> <span class="nv">data10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2924734236
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-11">
<h2>Day 11<a class="headerlink" href="#day-11" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/11">Puzzle link</a></p>
<p>Cool trippy looking octopus simulation today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test11</span><span class="kd">â†</span><span class="o">â†‘â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day11-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 4 8 3 1 4 3 2 2 3
2 7 4 5 8 5 4 7 1 1
5 2 6 4 5 5 6 1 7 3
6 1 4 1 3 3 6 1 4 6
6 3 5 7 3 8 5 4 7 8
4 1 6 7 5 2 4 6 4 5
2 1 7 6 8 4 1 7 2 1
6 8 8 2 8 8 1 1 3 4
4 8 4 6 8 4 8 5 5 4
5 2 8 3 7 5 1 5 2 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data11</span><span class="kd">â†</span><span class="o">â†‘â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day11-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We need a little dfn to simulate the octopi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">step_octopi</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="m">1</span><span class="o">+</span><span class="bp">âµ</span>
  <span class="nv">already_flashed</span><span class="kd">â†</span><span class="p">(</span><span class="o">â´</span><span class="nv">grid</span><span class="p">)</span><span class="o">â´</span><span class="m">0</span>
  <span class="nv">do_flashes</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">flash</span><span class="kd">â†</span><span class="p">(</span><span class="nv">grid</span><span class="o">&gt;</span><span class="m">9</span><span class="p">)</span><span class="o">âˆ§~</span><span class="nv">already_flashed</span>
    <span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="nv">flash</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">grid</span>
    <span class="nv">grid</span><span class="o">+</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">â†“</span><span class="m">Â¯5</span><span class="o">âŒ½,</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âŠ¢</span><span class="nv">flash</span>
    <span class="nv">already_flashed</span><span class="o">âˆ¨</span><span class="kd">â†</span><span class="nv">flash</span>
    <span class="bp">âˆ‡</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="nv">do_flashes</span> <span class="m">0</span>
  <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nv">grid</span><span class="o">&gt;</span><span class="m">9</span><span class="p">))</span><span class="o">Ã—</span><span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h3>Part 1<a class="headerlink" href="#id19" title="Permalink to this headline">Â¶</a></h3>
<p>Count flashes after 100 steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day11_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">flashes</span><span class="kd">â†</span><span class="m">0</span>
  <span class="nv">n</span><span class="kd">â†</span><span class="bp">âº</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="p">(</span><span class="nv">n</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">flashes</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="nv">step_octopi</span> <span class="nv">grid</span>
  <span class="nv">flashes</span><span class="o">+</span><span class="kd">â†</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="nv">grid</span>
  <span class="nv">flashes</span><span class="o">+</span><span class="p">(</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="bp">âˆ‡</span> <span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">100</span> <span class="nv">day11_1</span> <span class="nv">test11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1656
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">100</span> <span class="nv">day11_1</span> <span class="nv">data11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1591
</span></div></div>
</div>
</div>
<div class="section" id="id20">
<h3>Part 2<a class="headerlink" href="#id20" title="Permalink to this headline">Â¶</a></h3>
<p>Find the step when all octopi flash.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day11_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="bp">âº</span><span class="kd">â†</span><span class="m">1</span>
  <span class="nv">n</span><span class="kd">â†</span><span class="bp">âº</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="nv">step_octopi</span> <span class="nv">grid</span>
  <span class="p">((</span><span class="o">Ã—</span><span class="na">/</span><span class="o">â´</span><span class="nv">grid</span><span class="p">)</span><span class="o">=+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="nv">grid</span><span class="p">)</span><span class="bp">:</span><span class="nv">n</span>
  <span class="p">(</span><span class="nv">n</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="bp">âˆ‡</span> <span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day11_2</span> <span class="nv">test11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">195
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day11_2</span> <span class="nv">data11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">314
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-12">
<h2>Day 12<a class="headerlink" href="#day-12" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/12">Puzzle link</a></p>
<p>Bleh graph search today. APL really isnâ€™t especially great at this.</p>
<p>Iâ€™ll write out test12_1 longhand so that you can notice that â€˜xâ€™ is
a scalar and not a vector. But â€˜xxâ€™ is an array. So strings may be
arrays or not arrays depending on their length. This is somewhat
error-prone when trying things in the REPL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test12_1</span><span class="kd">â†</span><span class="p">(</span><span class="s1">&#39;start&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">))(</span><span class="s1">&#39;start&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;d&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="s1">&#39;end&#39;</span><span class="p">)((</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”Œâ”€â”€â”€â”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”¬â”€â”â”‚â”Œâ”€â”¬â”€â”â”‚â”Œâ”€â”¬â”€â”â”‚â”Œâ”€â”¬â”€â”â”‚â”Œâ”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”¬â”€â”€â”€â”â”‚
â”‚â”‚startâ”‚Aâ”‚â”‚â”‚startâ”‚bâ”‚â”‚â”‚Aâ”‚câ”‚â”‚â”‚Aâ”‚bâ”‚â”‚â”‚bâ”‚dâ”‚â”‚â”‚Aâ”‚endâ”‚â”‚â”‚bâ”‚endâ”‚â”‚
â”‚â””â”€â”€â”€â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”´â”€â”˜â”‚â””â”€â”´â”€â”˜â”‚â””â”€â”´â”€â”˜â”‚â””â”€â”´â”€â”˜â”‚â””â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”´â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test12_2</span><span class="kd">â†</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day12-test2.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€
â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€
â”‚â”‚dcâ”‚endâ”‚â”‚â”‚HNâ”‚startâ”‚â”‚â”‚startâ”‚kjâ”‚â”‚â”‚dcâ”‚startâ”‚â”‚â”‚dcâ”‚HNâ”‚â”‚â”‚LNâ”‚dcâ”‚â”‚â”‚HNâ”‚endâ”‚â”‚â”‚kjâ”‚saâ”‚â”‚â”‚kj
â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€

      â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
      â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚
      â”‚HNâ”‚â”‚â”‚kjâ”‚dcâ”‚â”‚
      â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚
      â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test12_3</span><span class="kd">â†</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day12-test3.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€
â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œ
â”‚â”‚fsâ”‚endâ”‚â”‚â”‚heâ”‚DXâ”‚â”‚â”‚fsâ”‚heâ”‚â”‚â”‚startâ”‚DXâ”‚â”‚â”‚pjâ”‚DXâ”‚â”‚â”‚endâ”‚zgâ”‚â”‚â”‚zgâ”‚slâ”‚â”‚â”‚zgâ”‚pjâ”‚â”‚â”‚pjâ”‚heâ”‚â”‚â”‚
â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€

      â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€
      â”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”¬
      RWâ”‚heâ”‚â”‚â”‚fsâ”‚DXâ”‚â”‚â”‚pjâ”‚RWâ”‚â”‚â”‚zgâ”‚RWâ”‚â”‚â”‚startâ”‚pjâ”‚â”‚â”‚heâ”‚WIâ”‚â”‚â”‚zgâ”‚heâ”‚â”‚â”‚pjâ”‚fsâ”‚â”‚â”‚startâ”‚
      â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”´
      â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€

      â”€â”€â”€â”
      â”€â”€â”â”‚
      RWâ”‚â”‚
      â”€â”€â”˜â”‚
      â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data12</span><span class="kd">â†</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day12-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id21">
<h3>Part 1<a class="headerlink" href="#id21" title="Permalink to this headline">Â¶</a></h3>
<p>Count all paths visiting small letter caves at most once. Weâ€™ll just use
a recursive dfn to enumerate them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">paths</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">graph</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">xs</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="nv">graph</span>
  <span class="nv">ys</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="nv">graph</span>
  <span class="nv">is_lower</span><span class="kd">â†</span><span class="o">âˆ§</span><span class="na">/</span><span class="p">(</span><span class="m">1</span><span class="na">âˆ˜</span><span class="nf">â•C</span><span class="o">â‰ âŠ¢</span><span class="p">)</span>  <span class="c1">â 1 if c is lowercase</span>
  <span class="nv">visit</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">cur</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span>  <span class="c1">â current node</span>
    <span class="nv">pps</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>  <span class="c1">â open partial paths</span>
    <span class="p">(</span><span class="nv">cur</span><span class="o">â‰¡</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="bp">:</span><span class="p">(</span><span class="o">âŠ‚</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">,</span><span class="na">Â¨</span><span class="nv">pps</span>  <span class="c1">â open paths stop at end</span>
    <span class="c1">â collect adjacent vertices</span>
    <span class="nv">nexts</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">xs</span><span class="na">/â¨</span><span class="p">(</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">ys</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">ys</span><span class="na">/â¨</span><span class="p">(</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">xs</span><span class="p">)</span><span class="kt">}</span><span class="nv">cur</span>
    <span class="c1">â prune paths that have gone through cur before if small </span>
    <span class="nv">small</span><span class="kd">â†</span><span class="nv">is_lower</span> <span class="nv">cur</span>
    <span class="nv">open_pps</span><span class="kd">â†</span><span class="nv">pps</span><span class="na">/â¨</span><span class="p">((</span><span class="o">~</span><span class="nv">small</span><span class="p">)</span><span class="o">âˆ¨</span><span class="p">(</span><span class="o">âˆ§</span><span class="na">/Â¨</span><span class="p">(</span><span class="o">,</span><span class="nv">cur</span><span class="na">âˆ˜</span><span class="o">â‰¢</span><span class="na">Â¨Â¨</span><span class="nv">pps</span><span class="p">)))</span>
    <span class="p">((</span><span class="o">â‰¢</span><span class="nv">open_pps</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="m">0</span>  <span class="c1">â dead end</span>
    <span class="c1">â return all the paths here</span>
    <span class="nv">next_pps</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŠ‚</span><span class="nv">cur</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">,</span><span class="na">Â¨</span><span class="nv">open_pps</span>
    <span class="nv">here</span><span class="kd">â†</span><span class="o">,â†‘</span><span class="kt">{</span><span class="nv">visit</span><span class="p">(</span><span class="bp">âµ</span> <span class="nv">next_pps</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">nexts</span>
    <span class="p">((</span><span class="m">1</span><span class="na">âˆ˜</span><span class="o">â‰ </span><span class="p">)</span><span class="o">â‰¢</span><span class="na">Â¨</span><span class="nv">here</span><span class="p">)</span><span class="na">/</span><span class="nv">here</span>
  <span class="kt">}</span>
  <span class="c1">â this filters out annoying empty paths</span>
  <span class="nv">paths_with_ghosts</span><span class="kd">â†</span><span class="nv">visit</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">(</span><span class="o">,</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
  <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">âˆŠ</span><span class="na">Â¨</span><span class="nv">paths_with_ghosts</span><span class="p">)</span><span class="na">/</span><span class="nv">paths_with_ghosts</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span><span class="kd">â†</span><span class="p">(</span><span class="o">â‰¢</span><span class="nv">paths</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">19
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">226
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">data12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3761
</span></div></div>
</div>
</div>
<div class="section" id="id22">
<h3>Part 2<a class="headerlink" href="#id22" title="Permalink to this headline">Â¶</a></h3>
<p>How many paths are there if we can revisit one small letter cave twice?</p>
<p>Originally, I modified my recursive dfn from part 1 to solve this part,
and it blew Dyalogâ€™s stack limit. So I rewrote the search to be iterative
instead. That worked but took so long that I wrote a naive Python solution
instead of waiting for it to finish (the runtime was 5 seconds).</p>
<p>I eventually figured out that â€œdropâ€ is slow linear time and so it is really
easy to make things n^2 by mistake.</p>
<p>This uses â€œtradfnsâ€ and Dyalogâ€™s procedural programming keywords, which
feels super gross.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">result</span><span class="kd">â†</span><span class="nv">paths2_non_recursive</span> <span class="nv">graph</span><span class="sr">;</span><span class="nv">xs</span><span class="sr">;</span><span class="nv">ys</span><span class="sr">;</span><span class="nv">is_lower</span><span class="sr">;</span><span class="nv">q</span><span class="sr">;</span><span class="nv">n</span><span class="sr">;</span><span class="nv">i</span><span class="sr">;</span><span class="nv">cur</span><span class="sr">;</span><span class="nv">pps</span><span class="sr">;</span><span class="nv">open_pps</span><span class="sr">;</span><span class="nv">nexts</span><span class="sr">;</span><span class="nv">next_pps</span>
 <span class="nv">xs</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="nv">graph</span>
 <span class="nv">ys</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŠƒ</span><span class="na">Â¨</span><span class="nv">graph</span>
 <span class="nv">is_lower</span><span class="kd">â†</span><span class="o">âˆ§</span><span class="na">/</span><span class="p">(</span><span class="m">1</span><span class="na">âˆ˜</span><span class="nf">â•C</span><span class="o">â‰ âŠ¢</span><span class="p">)</span>

 <span class="nv">paths_with_ghosts</span><span class="kd">â†</span><span class="no">â¬</span>
 <span class="c1">â trying to pop a queue is absurdly slow, so instead</span>
 <span class="c1">â keep our own running start index and length</span>
 <span class="c1">âqâ†âŠ‚(&#39;start&#39;(,&#39;-&#39;))</span>
 <span class="c1">â:While (â‰¢q)&gt;0</span>
     <span class="c1">âcurâ†âŠƒâŠƒq</span>
     <span class="c1">âppsâ†2âŠƒâŠƒq</span>
     <span class="c1">âqâ†(1â†“q)</span>
 <span class="nv">q</span><span class="kd">â†</span><span class="p">(</span><span class="o">,â†“</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">(</span><span class="o">,</span><span class="s1">&#39;-&#39;</span><span class="p">)))</span>
 <span class="nv">n</span><span class="kd">â†</span><span class="m">1</span>
 <span class="nv">i</span><span class="kd">â†</span><span class="m">1</span>
 <span class="bp">:</span><span class="nv">While</span> <span class="nv">n</span><span class="o">&gt;</span><span class="m">0</span>
     <span class="nv">cur</span><span class="kd">â†</span><span class="o">âŠƒâŠƒ</span><span class="nv">q</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
     <span class="nv">pps</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŠƒâŠƒ</span><span class="nv">q</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
     <span class="nv">n</span><span class="o">-</span><span class="kd">â†</span><span class="m">1</span>
     <span class="nv">i</span><span class="o">+</span><span class="kd">â†</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">cur</span><span class="o">â‰¡</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
         <span class="nv">paths_with_ghosts</span><span class="o">,</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŠ‚</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">,</span><span class="na">Â¨</span><span class="nv">pps</span>
         <span class="bp">:</span><span class="nv">Continue</span>
     <span class="bp">:</span><span class="nv">EndIf</span>
     <span class="nv">open_pps</span><span class="kd">â†</span><span class="p">(</span><span class="kt">{</span><span class="nv">cur</span> <span class="nv">is_open</span> <span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">pps</span><span class="p">)</span><span class="na">/</span><span class="nv">pps</span>
     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">â‰¢</span><span class="nv">open_pps</span><span class="p">)</span><span class="o">=</span><span class="m">0</span>
         <span class="bp">:</span><span class="nv">Continue</span>
     <span class="bp">:</span><span class="nv">EndIf</span>
     <span class="nv">nexts</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">xs</span><span class="na">/â¨</span><span class="p">(</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">ys</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">ys</span><span class="na">/â¨</span><span class="p">(</span><span class="o">,</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">xs</span><span class="p">)</span><span class="kt">}</span><span class="nv">cur</span>
     <span class="nv">next_pps</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŠ‚</span><span class="nv">cur</span><span class="p">)</span><span class="na">âˆ˜</span><span class="o">,</span><span class="na">Â¨</span><span class="nv">open_pps</span>
     <span class="nv">q</span><span class="o">,</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="bp">âµ</span> <span class="nv">next_pps</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">nexts</span>
     <span class="nv">n</span><span class="o">+</span><span class="kd">â†</span><span class="o">â‰¢</span><span class="nv">nexts</span>
 <span class="bp">:</span><span class="nv">EndWhile</span>
 <span class="nv">result</span><span class="kd">â†</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">âˆŠ</span><span class="na">Â¨</span><span class="nv">paths_with_ghosts</span><span class="p">)</span><span class="na">/</span><span class="nv">paths_with_ghosts</span>
</pre></div>
</div>
</div>
</div>
<p>I extracted a separate procedure for is_open in an effort to see
if it would speed up the search. It did not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">result</span><span class="kd">â†</span><span class="nv">cur</span> <span class="nv">is_open</span> <span class="nv">pp</span><span class="sr">;</span><span class="nv">ppt</span><span class="sr">;</span><span class="nv">count</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nv">is_lower</span> <span class="nv">cur</span><span class="p">))</span>
     <span class="nv">result</span><span class="kd">â†</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">((</span><span class="nv">cur</span><span class="o">â‰¡</span><span class="s1">&#39;start&#39;</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">((</span><span class="o">â‰¢</span><span class="nv">pp</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">))</span>
     <span class="nv">result</span><span class="kd">â†</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="nv">ppt</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŠ‚</span><span class="nv">cur</span><span class="p">)</span><span class="o">,</span><span class="nv">pp</span>
 <span class="nv">count</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">â‰¢</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">âŒ¸</span><span class="p">((</span><span class="nv">is_lower</span><span class="na">Â¨</span><span class="nv">ppt</span><span class="p">)</span><span class="na">/</span><span class="nv">ppt</span><span class="p">)</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">âˆ¨</span><span class="na">/</span><span class="p">(</span><span class="o">&gt;</span><span class="na">âˆ˜</span><span class="m">2</span><span class="p">)</span><span class="nv">count</span><span class="p">)</span>
     <span class="nv">result</span><span class="kd">â†</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">=</span><span class="na">âˆ˜</span><span class="m">2</span><span class="p">)</span><span class="nv">count</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">)</span>
     <span class="nv">result</span><span class="kd">â†</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="nv">result</span><span class="kd">â†</span><span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span><span class="kd">â†</span><span class="p">(</span><span class="o">â‰¢</span><span class="nv">paths2_non_recursive</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">36
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">103
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3509
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">âday12_2 data12  â still really slow</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-13">
<h2>Day 13<a class="headerlink" href="#day-13" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/13">Puzzle link</a></p>
<p>Ooh, origami today, that sounds cool.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test13</span> <span class="kd">â†</span> <span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day13-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data13</span> <span class="kd">â†</span> <span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day13-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Letâ€™s start by parsing out the points and the folding instructions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_folds</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â given lines like (&#39;0,0&#39;)(&#39;3,2&#39;)(&#39;fold along x=5&#39;)(&#39;fold along y=4&#39;)</span>
  <span class="c1">â returns (points folds) where points are (x y)s and folds are (x 0)</span>
  <span class="c1">â for vertical folds and (0 y) for horizontal folds </span>
  <span class="nv">parse_line</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â note that we add 1 to x ys because APL arrays are 1-indexed</span>
    <span class="s1">&#39;,&#39;</span><span class="o">âˆŠ</span><span class="bp">âµ:</span><span class="m">1</span><span class="o">,</span><span class="p">(</span><span class="o">âŒ½</span><span class="m">1</span><span class="o">+â</span><span class="na">Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span> <span class="c1">â &#39;,&#39; lines: 1 x+1 y+1 </span>
    <span class="s1">&#39;x&#39;</span><span class="o">âˆŠ</span><span class="bp">âµ:</span><span class="m">2</span><span class="p">(</span><span class="o">â</span><span class="m">2</span><span class="o">âŠƒ</span><span class="s1">&#39;=&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="m">0</span>   <span class="c1">â &#39;x&#39; lines: 2 x 0</span>
    <span class="s1">&#39;y&#39;</span><span class="o">âˆŠ</span><span class="bp">âµ:</span><span class="m">2</span> <span class="m">0</span><span class="p">(</span><span class="o">â</span><span class="m">2</span><span class="o">âŠƒ</span><span class="s1">&#39;=&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span>  <span class="c1">â &#39;y&#39; lines: 2 0 y</span>
    <span class="m">0</span>                        <span class="c1">â ignore extra newlines</span>
  <span class="kt">}</span>
  <span class="c1">â selects rows with first element =âº, dropping that element</span>
  <span class="nv">select</span><span class="kd">â†</span><span class="kt">{</span><span class="m">1</span><span class="o">â†“</span><span class="na">Â¨</span><span class="p">(</span><span class="bp">âº</span><span class="o">=âŠƒ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="na">/</span><span class="bp">âµ</span><span class="kt">}</span>
  <span class="c1">â collect 1 lines (i.e. points) and then 2 lines (i.e. folds)</span>
  <span class="p">(</span><span class="o">âŠ‚</span><span class="na">âˆ˜</span><span class="p">(</span><span class="m">1</span><span class="na">âˆ˜</span><span class="nv">select</span><span class="p">)</span><span class="o">,âŠ‚</span><span class="na">âˆ˜</span><span class="p">(</span><span class="m">2</span><span class="na">âˆ˜</span><span class="nv">select</span><span class="p">))</span><span class="nv">parse_line</span><span class="na">Â¨</span><span class="bp">âµ</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>We can sanity check this with a little plotting helper.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">plot</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">points</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">paper</span><span class="kd">â†</span><span class="p">(</span><span class="o">â†‘âŒˆ</span><span class="na">/</span><span class="nv">points</span><span class="p">)</span><span class="o">â´</span><span class="m">0</span>  <span class="c1">â 0s as wide and tall as max x and max y</span>
  <span class="nv">paper</span><span class="sr">[</span><span class="nv">points</span><span class="sr">]</span><span class="kd">â†</span><span class="m">1</span>      <span class="c1">â plot 1s at each point</span>
  <span class="nv">paper</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">x</span><span class="kd">â†</span><span class="nv">plot</span> <span class="o">âŠƒ</span><span class="nv">parse_folds</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 1 0 0 1 0 0 1 0
0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
1 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 1 0 1
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 1 0 0 0 0 1 0 1 1 0
0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 1
1 0 0 0 0 0 0 0 0 0 0
1 0 1 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<p>To fold, we can just reflect the matrix horizontally or vertically
and or it with itself, and then take only the upper or left part.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">x</span><span class="kd">â†</span><span class="m">7</span><span class="o">â†‘</span><span class="nv">x</span><span class="o">âˆ¨âŠ–</span><span class="nv">x</span>   <span class="c1">â e.g. fold up and keep 7 rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 0 0 1 0 0 1 0
1 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 1
1 0 0 0 1 0 0 0 0 0 0
0 1 0 1 0 0 1 0 1 1 1
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">x</span><span class="kd">â†</span><span class="m">5</span><span class="o">â†‘</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">x</span><span class="o">âˆ¨âŒ½</span><span class="nv">x</span> <span class="c1">â now fold left and keep 5 cols</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1
1 0 0 0 1
1 0 0 0 1
1 0 0 0 1
1 1 1 1 1
0 0 0 0 0
0 0 0 0 0
</span></div></div>
</div>
<p>Letâ€™s just write a general program for any number of folds and then
have it only do the first to solve part 1. It isnâ€™t really that much
different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">fold</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">points</span> <span class="nv">folds</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">paper</span><span class="kd">â†</span><span class="nv">plot</span> <span class="nv">points</span> <span class="c1">â make bitmap of points</span>
  <span class="nv">fold_left</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â modify paper, or&#39;ing right-to-left and keeping left âµ cols</span>
    <span class="nv">paper</span><span class="o">âŠ¢</span><span class="kd">â†</span><span class="bp">âµ</span><span class="o">â†‘</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">paper</span><span class="o">âˆ¨âŒ½</span><span class="nv">paper</span> <span class="p">â‹„</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">fold_up</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â modify paper, or&#39;ing top-to-bottom and keeping top âµ rows</span>
    <span class="nv">paper</span><span class="o">âŠ¢</span><span class="kd">â†</span><span class="bp">âµ</span><span class="o">â†‘</span><span class="nv">paper</span><span class="o">âˆ¨âŠ–</span><span class="nv">paper</span> <span class="p">â‹„</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">left</span> <span class="nv">up</span><span class="kd">â†</span><span class="bp">âµ</span>   <span class="c1">â each element has x/y fold amount  </span>
    <span class="p">(</span><span class="nv">left</span><span class="o">â‰ </span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">fold_left</span> <span class="nv">left</span>
    <span class="nv">fold_up</span> <span class="nv">up</span>
  <span class="kt">}</span><span class="na">Â¨</span><span class="nv">folds</span>
  <span class="nv">paper</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">fold</span> <span class="nv">parse_folds</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1
1 0 0 0 1
1 0 0 0 1
1 0 0 0 1
1 1 1 1 1
0 0 0 0 0
0 0 0 0 0
</span></div></div>
</div>
<div class="section" id="id23">
<h3>Part 1<a class="headerlink" href="#id23" title="Permalink to this headline">Â¶</a></h3>
<p>To prove this works, count up points after doing just the first fold.
The inline dfn here keeps all the points and only the first fold from
instructions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="nv">fold</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="p">)(</span><span class="o">âŠ‚</span><span class="p">(</span><span class="o">âŠƒ</span><span class="m">2</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="p">))</span><span class="kt">}</span><span class="nv">parse_folds</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span> <span class="nv">data13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">842
</span></div></div>
</div>
</div>
<div class="section" id="id24">
<h3>Part 2<a class="headerlink" href="#id24" title="Permalink to this headline">Â¶</a></h3>
<p>Then we do the whole thing and get a bitmap to answer with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_2</span> <span class="kd">â†</span> <span class="nv">fold</span> <span class="nv">parse_folds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_2</span> <span class="nv">data13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 0 1 1 1 1 0 1 0 0 1 0 1 1 1 0 0 0 1 1 0 0 0 0 1 1 0 1 1 1 1 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 1 0 0 0 0 1 0 0 0 0 1 0 1 0 0 1 0
1 1 1 0 0 1 1 1 0 0 1 1 0 0 0 1 0 0 1 0 1 0 0 0 0 0 0 0 1 0 0 0 1 0 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 1 1 0 0 1 0 0 0 0 0 0 0 1 0 0 1 0 0 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 1 0 1 0 0 0 0 1 0 0 1 0
1 1 1 0 0 1 0 0 0 0 1 0 0 1 0 1 0 0 1 0 0 1 1 0 0 0 1 1 0 0 1 1 1 1 0 0 1 1 0 0
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-14">
<h2>Day 14<a class="headerlink" href="#day-14" title="Permalink to this headline">Â¶</a></h2>
<p>Today we get to do string shenanigans, substituting pairs for letters.
APL doesnâ€™t really seem to have dictionaries so I guess Iâ€™ll roll my ownâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">polymers</span><span class="kd">â†</span><span class="o">â†‘</span><span class="p">(</span><span class="s1">&#39;NN&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;C&#39;</span><span class="p">))(</span><span class="s1">&#39;NC&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;B&#39;</span><span class="p">))(</span><span class="s1">&#39;CB&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;H&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”¬â”€â”
â”‚NNâ”‚Câ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚NCâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚CBâ”‚Hâ”‚
â””â”€â”€â”´â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">â†‘</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âŒ½</span><span class="s1">&#39;NC&#39;</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span>  <span class="c1">â lookup letter where adjacent column is &#39;NC&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">B
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">â get pairs from string</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”
â”‚NNâ”‚NCâ”‚CBâ”‚
â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">âŠƒâŠƒ</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âŒ½</span><span class="bp">âµ</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">â lookup letter for each pair</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">CBH
</span></div></div>
</div>
<p>Weâ€™re supposed to squidge the letters between the pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ,</span><span class="na">/</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,âŠƒâŠƒ</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âŒ½</span><span class="bp">âµ</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="kt">}</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">â put pair letters around lookups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NCNBCHB
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">polymerize</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">pairs</span><span class="kd">â†</span><span class="bp">âº</span>
  <span class="nv">template</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">lookup</span><span class="kd">â†</span><span class="kt">{</span><span class="o">âŠƒâŠƒ</span><span class="nv">pairs</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âŒ½</span><span class="bp">âµ</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">pairs</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span>
  <span class="p">(</span><span class="o">âŠƒ,</span><span class="na">/</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,</span><span class="nv">lookup</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="nv">template</span><span class="p">)</span><span class="o">,</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="nv">template</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">polymers</span> <span class="nv">polymerize</span> <span class="s1">&#39;NNCB&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NCNBCHB
</span></div></div>
</div>
<p>Ok, time to read inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test14_template</span><span class="kd">â†</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day14-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NNCB
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test14_pairs</span><span class="kd">â†</span><span class="o">â†‘</span><span class="kt">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">â¤</span><span class="o">âˆŠ</span><span class="na">â¨</span><span class="o">âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day14-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”¬â”€â”
â”‚CHâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚HHâ”‚Nâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚CBâ”‚Hâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚NHâ”‚Câ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚HBâ”‚Câ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚HCâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚HNâ”‚Câ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚NNâ”‚Câ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚BHâ”‚Hâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚NCâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚NBâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚BNâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚BBâ”‚Nâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚BCâ”‚Bâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚CCâ”‚Nâ”‚
â”œâ”€â”€â”¼â”€â”¤
â”‚CNâ”‚Câ”‚
â””â”€â”€â”´â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_template</span><span class="kd">â†</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day14-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span><span class="kd">â†</span><span class="o">â†‘</span><span class="kt">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">â¤</span><span class="o">âˆŠ</span><span class="na">â¨</span><span class="o">âŠ†âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day14-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id25">
<h3>Part 1<a class="headerlink" href="#id25" title="Permalink to this headline">Â¶</a></h3>
<p>Polymerize repeatedlyâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="nv">test14_pairs</span><span class="na">âˆ˜</span><span class="nv">polymerize</span><span class="p">)</span><span class="na">â£</span><span class="m">4</span><span class="p">)</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NBBNBNBBCCNBCNCCNBBNBBNBBBNBBNBBCBHCBHHNHCBBCBHCB
</span></div></div>
</div>
<p>and find the most common minus the least common character.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">most_minus_least</span><span class="kd">â†</span><span class="p">(</span><span class="o">âŒˆ</span><span class="na">/</span><span class="o">-âŒŠ</span><span class="na">/</span><span class="p">)</span><span class="kt">{</span><span class="o">â‰¢</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">âŒ¸âˆ˜</span><span class="o">âŠ¢</span>  <span class="c1">â tally keys, then take max-min </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">most_minus_least</span> <span class="s1">&#39;ABBBCCCCC&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day14_1</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">most_minus_least</span> <span class="p">((</span><span class="bp">âº</span><span class="na">âˆ˜</span><span class="nv">polymerize</span><span class="p">)</span><span class="na">â£</span><span class="m">10</span><span class="p">)</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_1</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1588
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span> <span class="nv">day14_1</span> <span class="nv">data14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2587
</span></div></div>
</div>
</div>
<div class="section" id="id26">
<h3>Part 2<a class="headerlink" href="#id26" title="Permalink to this headline">Â¶</a></h3>
<p>Now we have to do this 40 times in a row. Naive string substitution
wonâ€™t work anymore; Dyalog bogs down at around 16 or 17 iterations.</p>
<p>Notice that in each generation, each pair yields 2 new pairs: xy -&gt; z
gives xz and zy. The order isnâ€™t important, so we can just count them.
First we have to count pairs in the template.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">count_pairs</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span> <span class="m">1</span><span class="kt">}</span><span class="na">Â¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="o">âŠ¢</span>  <span class="c1">â (pair 1) for each pair in template</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_census</span><span class="kd">â†</span><span class="nv">count_pairs</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">data14_census</span><span class="kd">â†</span><span class="nv">count_pairs</span> <span class="nv">data14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€
â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œ
â”‚â”‚VHâ”‚1â”‚â”‚â”‚HCâ”‚1â”‚â”‚â”‚CKâ”‚1â”‚â”‚â”‚KBâ”‚1â”‚â”‚â”‚BFâ”‚1â”‚â”‚â”‚FOâ”‚1â”‚â”‚â”‚OVâ”‚1â”‚â”‚â”‚VCâ”‚1â”‚â”‚â”‚CHâ”‚1â”‚â”‚â”‚HHâ”‚1â”‚â”‚â”‚HKâ”‚1â”‚â”‚â”‚
â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€

      â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
      â”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚
      KOâ”‚1â”‚â”‚â”‚OHâ”‚1â”‚â”‚â”‚HBâ”‚1â”‚â”‚â”‚BPâ”‚1â”‚â”‚â”‚PNâ”‚1â”‚â”‚â”‚NCâ”‚1â”‚â”‚â”‚CKâ”‚1â”‚â”‚â”‚KOâ”‚1â”‚â”‚
      â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚
      â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<p>Note that CK and KO are duplicated, so we need to collect counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="o">â†“</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âº</span><span class="p">)(</span><span class="o">+</span><span class="na">/</span><span class="o">âŠ¢</span><span class="na">/</span><span class="o">â†‘</span><span class="nv">c</span><span class="sr">[</span><span class="bp">âµ</span><span class="sr">]</span><span class="p">)</span><span class="kt">}</span><span class="na">âŒ¸</span><span class="o">âŠ£</span><span class="na">/</span><span class="o">â†‘</span><span class="nv">c</span><span class="kt">}</span>  <span class="c1">â sum counts for duplicate keys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€
â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œ
â”‚â”‚VHâ”‚1â”‚â”‚â”‚HCâ”‚1â”‚â”‚â”‚CKâ”‚2â”‚â”‚â”‚KBâ”‚1â”‚â”‚â”‚BFâ”‚1â”‚â”‚â”‚FOâ”‚1â”‚â”‚â”‚OVâ”‚1â”‚â”‚â”‚VCâ”‚1â”‚â”‚â”‚CHâ”‚1â”‚â”‚â”‚HHâ”‚1â”‚â”‚â”‚HKâ”‚1â”‚â”‚â”‚
â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€

      â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
      â”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚
      KOâ”‚2â”‚â”‚â”‚OHâ”‚1â”‚â”‚â”‚HBâ”‚1â”‚â”‚â”‚BPâ”‚1â”‚â”‚â”‚PNâ”‚1â”‚â”‚â”‚NCâ”‚1â”‚â”‚
      â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚
      â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<p>We can now polymerize pair counts rather than strings, which ought to be
much more efficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">polymerize2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â update association list of (pair count) by inserting two new pairs</span>
  <span class="c1">â for each existing pair according to substitution instructions</span>
  <span class="nv">pairs</span><span class="kd">â†</span><span class="bp">âº</span>   <span class="c1">â (pair letter) substitution instructions</span>
  <span class="nv">census</span><span class="kd">â†</span><span class="bp">âµ</span>  <span class="c1">â (pair count) current counts</span>
  <span class="nv">lookup</span><span class="kd">â†</span><span class="kt">{</span><span class="o">âŠƒâŠƒ</span><span class="nv">pairs</span><span class="sr">[</span><span class="o">â¸</span><span class="p">(</span><span class="o">âŒ½</span><span class="bp">âµ</span><span class="na">âˆ˜</span><span class="o">â‰¡</span><span class="na">Â¨</span><span class="nv">pairs</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span>
  <span class="nv">merge_counts</span><span class="o">,â†‘</span><span class="kt">{</span>
    <span class="nv">pair</span> <span class="nv">count</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">letter</span><span class="kd">â†</span><span class="nv">lookup</span> <span class="nv">pair</span>
    <span class="nv">left</span><span class="kd">â†</span><span class="p">(</span><span class="m">1</span><span class="o">â†‘</span><span class="nv">pair</span><span class="p">)</span><span class="o">,</span><span class="nv">letter</span>
    <span class="nv">right</span><span class="kd">â†</span><span class="nv">letter</span><span class="o">,</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="nv">pair</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">left</span> <span class="nv">count</span><span class="p">)(</span><span class="nv">right</span> <span class="nv">count</span><span class="p">)</span>
  <span class="kt">}</span><span class="na">Â¨</span><span class="nv">census</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">polymerize2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚
â”‚â”‚NCâ”‚1â”‚â”‚â”‚CNâ”‚1â”‚â”‚â”‚NBâ”‚1â”‚â”‚â”‚BCâ”‚1â”‚â”‚â”‚CHâ”‚1â”‚â”‚â”‚HBâ”‚1â”‚â”‚
â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<p>But in the final analysis, we need to count letters, not pairs. Each
pair contributes one distinct letter except the last pair which
contributes two. We can refine merge to leave out the last pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">c</span><span class="kd">â†</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="o">â†“</span><span class="kt">{</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âº</span><span class="p">)(</span><span class="o">+</span><span class="na">/</span><span class="o">âŠ¢</span><span class="na">/</span><span class="o">â†‘</span><span class="nv">c</span><span class="sr">[</span><span class="bp">âµ</span><span class="sr">]</span><span class="p">)</span><span class="kt">}</span><span class="na">âŒ¸</span><span class="o">âŠ£</span><span class="na">/</span><span class="o">â†‘</span><span class="nv">c</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span>  <span class="c1">â merge all but last pair counts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">data14_census</span><span class="kd">â†</span><span class="nv">merge_counts</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€
â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œ
â”‚â”‚VHâ”‚1â”‚â”‚â”‚HCâ”‚1â”‚â”‚â”‚CKâ”‚2â”‚â”‚â”‚KBâ”‚1â”‚â”‚â”‚BFâ”‚1â”‚â”‚â”‚FOâ”‚1â”‚â”‚â”‚OVâ”‚1â”‚â”‚â”‚VCâ”‚1â”‚â”‚â”‚CHâ”‚1â”‚â”‚â”‚HHâ”‚1â”‚â”‚â”‚HKâ”‚1â”‚â”‚â”‚
â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€

      â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
      â”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚
      KOâ”‚1â”‚â”‚â”‚OHâ”‚1â”‚â”‚â”‚HBâ”‚1â”‚â”‚â”‚BPâ”‚1â”‚â”‚â”‚PNâ”‚1â”‚â”‚â”‚NCâ”‚1â”‚â”‚â”‚KOâ”‚1â”‚â”‚
      â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚
      â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<p>This way the last pair in the census will always be the literal last pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="nv">test14_pairs</span><span class="na">âˆ˜</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">â£</span><span class="m">10</span><span class="p">)</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬
â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚
â”‚â”‚NBâ”‚796â”‚â”‚â”‚BBâ”‚812â”‚â”‚â”‚BNâ”‚735â”‚â”‚â”‚BCâ”‚120â”‚â”‚â”‚CCâ”‚60â”‚â”‚â”‚CNâ”‚102â”‚â”‚â”‚NCâ”‚42â”‚â”‚â”‚CBâ”‚114â”‚â”‚â”‚BHâ”‚81â”‚â”‚
â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´

      â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”€â”â”‚â”Œâ”€â”€â”¬â”€â”â”‚
      â”‚HCâ”‚76â”‚â”‚â”‚HHâ”‚32â”‚â”‚â”‚HNâ”‚27â”‚â”‚â”‚NHâ”‚27â”‚â”‚â”‚CHâ”‚21â”‚â”‚â”‚HBâ”‚26â”‚â”‚â”‚CBâ”‚1â”‚â”‚
      â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”€â”˜â”‚â””â”€â”€â”´â”€â”˜â”‚
      â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<p>Finally we just have to write a horrible function to sum up letter counts given
pair counts. It merges the counts of the first letters of each pair, plus the
last letter of the last pair, then takes the max count minus the min count.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">âŒˆ</span><span class="na">/</span><span class="o">-âŒŠ</span><span class="na">/</span><span class="p">)</span><span class="o">âŠ¢</span><span class="na">âŒ¿</span><span class="o">â‰â†‘</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="p">(</span><span class="nv">merge_counts</span> <span class="p">(</span><span class="kt">{</span><span class="p">((</span><span class="o">âŠƒâŠƒ</span><span class="p">(</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">))(</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">))</span><span class="kt">}</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">âŠ‚</span><span class="p">((</span><span class="m">2</span><span class="o">âŠƒâŠƒâŠƒ</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="p">))</span> <span class="m">1</span><span class="p">))</span><span class="o">,</span><span class="m">0</span><span class="p">)</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="nv">test14_pairs</span><span class="na">âˆ˜</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">â£</span><span class="m">10</span><span class="p">)</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1588
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="nv">data14_pairs</span><span class="na">âˆ˜</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">â£</span><span class="m">10</span><span class="p">)</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2587
</span></div></div>
</div>
<p>Since it seems to work we can try it out on the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day14_2</span> <span class="kd">â†</span> <span class="kt">{</span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="bp">âº</span><span class="na">âˆ˜</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">â£</span><span class="m">40</span><span class="p">)</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2188189693529
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">â•PP</span><span class="kd">â†</span><span class="m">16</span>  <span class="c1">â we need more precision, apparently</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2188189693529
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span> <span class="nv">day14_2</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3318837563123
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-15">
<h2>Day 15<a class="headerlink" href="#day-15" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/15">Puzzle link</a></p>
<p>Find a shortest path from top left to bottom right in a grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test15</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day15-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 6 3 7 5 1 7 4 2
1 3 8 1 3 7 3 6 7 2
2 1 3 6 5 1 1 3 2 8
3 6 9 4 9 3 1 5 6 9
7 4 6 3 4 1 7 1 1 1
1 3 1 9 1 2 8 1 3 7
1 3 5 9 9 1 2 4 2 1
3 1 2 5 4 2 1 6 3 9
1 2 9 3 1 3 8 5 2 1
2 3 1 1 9 4 4 5 8 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data15</span><span class="kd">â†</span><span class="o">â†‘â</span><span class="na">Â¨Â¨</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day15-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Weâ€™ll use <a class="reference external" href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstraâ€™s algorithm</a>.
Here is straightforward code for it, not really particularly APLy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">dijkstra</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">grid</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">in_bounds</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">âˆ§</span><span class="na">/</span><span class="bp">âµ</span><span class="o">â‰¤</span><span class="p">(</span><span class="o">âŠƒâ´</span><span class="nv">grid</span><span class="p">))</span><span class="o">âˆ§</span><span class="p">(</span><span class="o">âˆ§</span><span class="na">/</span><span class="bp">âµ</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">start</span><span class="kd">â†</span><span class="m">1</span> <span class="m">1</span>           <span class="c1">â start at upper left</span>
  <span class="nv">visited</span><span class="kd">â†</span><span class="p">(</span><span class="o">â´</span><span class="nv">grid</span><span class="p">)</span><span class="o">â´</span><span class="m">0</span>   <span class="c1">â init all nodes to unvisited</span>
  <span class="nv">M</span><span class="kd">â†</span><span class="m">10000000</span>          <span class="c1">â this distance means &quot;infinity&quot;</span>
  <span class="nv">distance</span><span class="kd">â†</span><span class="p">(</span><span class="o">â´</span><span class="nv">grid</span><span class="p">)</span><span class="o">â´</span><span class="nv">M</span>  <span class="c1">â init nodes at &quot;infinity&quot;</span>
  <span class="nv">distance</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="nv">start</span><span class="sr">]</span><span class="kd">â†</span><span class="m">0</span>  <span class="c1">â start at distance 0</span>
  <span class="nv">step</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">m</span><span class="kd">â†</span><span class="nv">distance</span><span class="o">+</span><span class="nv">M</span><span class="o">Ã—</span><span class="nv">visited</span>
    <span class="nv">min</span><span class="kd">â†</span><span class="o">âŒŠ</span><span class="na">/</span><span class="o">,</span><span class="nv">m</span>     <span class="c1">â select min distance or M if all visited</span>
    <span class="nv">min</span><span class="o">â‰¥</span><span class="nv">M</span><span class="bp">:</span><span class="m">0</span>      <span class="c1">â stop if all visited</span>
    <span class="nv">v</span><span class="kd">â†</span><span class="o">âŠƒâ¸</span><span class="p">(</span><span class="nv">m</span><span class="o">=</span><span class="nv">min</span><span class="p">)</span>  <span class="c1">â find first index of min</span>
    <span class="nv">visited</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="nv">v</span><span class="sr">]</span><span class="kd">â†</span><span class="m">1</span> <span class="c1">â mark visited</span>
    <span class="c1">â collect in bounds, unvisited orthogonal neighbors</span>
    <span class="nv">neighbors</span><span class="kd">â†</span><span class="o">â†“</span><span class="nv">v</span><span class="p">(</span><span class="o">+</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="o">â†‘</span><span class="p">(</span><span class="m">Â¯1</span> <span class="m">0</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">Â¯1</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">neighbors</span><span class="kd">â†</span><span class="p">(</span><span class="kt">{</span><span class="o">~</span><span class="nv">in_bounds</span> <span class="bp">âµ:</span><span class="m">0</span> <span class="p">â‹„</span> <span class="o">~</span><span class="nv">visited</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">neighbors</span><span class="p">)</span><span class="na">/</span><span class="nv">neighbors</span>
    <span class="m">0</span><span class="o">=â‰¢</span><span class="nv">neighbors</span><span class="bp">:âˆ‡</span> <span class="no">â¬</span>  <span class="c1">â skip if no unvisited neighbors</span>
    <span class="c1">â update min distance to neighbors</span>
    <span class="nv">_</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">distance</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="sr">]</span><span class="o">âŒŠ</span><span class="kd">â†</span><span class="nv">grid</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="sr">]</span><span class="o">+</span><span class="nv">distance</span><span class="sr">[</span><span class="o">âŠ‚</span><span class="nv">v</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">neighbors</span>
    <span class="bp">âˆ‡</span> <span class="no">â¬</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">â†</span><span class="nv">step</span> <span class="no">â¬</span>
  <span class="nv">distance</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h3>Part 1<a class="headerlink" href="#id27" title="Permalink to this headline">Â¶</a></h3>
<p>Just call our Dijkstra helper to get the shortest path length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span><span class="kd">â†</span><span class="p">(</span><span class="o">â´âŠ¢</span><span class="p">)</span><span class="o">âŒ·</span><span class="na">âˆ˜</span><span class="nv">dijkstra</span><span class="o">âŠ¢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span> <span class="nv">test15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">40
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span> <span class="nv">data15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">458
</span></div></div>
</div>
</div>
<div class="section" id="id28">
<h3>Part 2<a class="headerlink" href="#id28" title="Permalink to this headline">Â¶</a></h3>
<p>The graph is secretly bigger and we need to tile it five times in each
direction and adjust the values slightly. We can do this easily with an
outer product over an index matrix â³5 5 and the tile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">â³</span><span class="m">5</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚1 1â”‚1 2â”‚1 3â”‚1 4â”‚1 5â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚2 1â”‚2 2â”‚2 3â”‚2 4â”‚2 5â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚3 1â”‚3 2â”‚3 3â”‚3 4â”‚3 5â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚4 1â”‚4 2â”‚4 3â”‚4 4â”‚4 5â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚5 1â”‚5 2â”‚5 3â”‚5 4â”‚5 5â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span><span class="kt">{</span><span class="m">1</span><span class="o">+</span><span class="m">9</span><span class="o">|</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="bp">âº</span><span class="p">)</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="bp">âµ</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="nv">test15</span>  <span class="c1">â offset tile values by index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 2 7 4 8 6 2 8 5 3
2 4 9 2 4 8 4 7 8 3
3 2 4 7 6 2 2 4 3 9
4 7 1 5 1 4 2 6 7 1
8 5 7 4 5 2 8 2 2 2
2 4 2 1 2 3 9 2 4 8
2 4 6 1 1 2 3 5 3 2
4 2 3 6 5 3 2 7 4 1
2 3 1 4 2 4 9 6 3 2
3 4 2 2 1 5 5 6 9 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tile</span><span class="kd">â†</span><span class="kt">{</span><span class="o">âŠƒâª</span><span class="na">âŒ¿</span><span class="o">,</span><span class="na">/</span><span class="p">(</span><span class="o">â³</span><span class="m">5</span> <span class="m">5</span><span class="p">)</span><span class="na">âˆ˜.</span><span class="kt">{</span><span class="m">1</span><span class="o">+</span><span class="m">9</span><span class="o">|</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="bp">âº</span><span class="p">)</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="bp">âµ</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="kt">}</span>  <span class="c1">â flattened product of indicesÃ—adjusted tiles</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_2</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">t</span><span class="kd">â†</span><span class="nv">tile</span> <span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="o">â´</span><span class="nv">t</span><span class="p">)</span><span class="o">âŒ·</span><span class="nv">dijkstra</span> <span class="nv">t</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_2</span> <span class="nv">test15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">315
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">âday15_2 data15  â takes a while...</span>
</pre></div>
</div>
</div>
</div>
<p>The search on the full 500x500 matrix takes a while, but not enough to
think harder about this.</p>
</div>
</div>
<div class="section" id="day-16">
<h2>Day 16<a class="headerlink" href="#day-16" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/16">Puzzle link</a></p>
<p>Today we get to parse a nested binary serialization format from hex numbers.
The easiest representation is to use nested arrays so this isnâ€™t going to
be super APLy or anything.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hex_to_binary</span><span class="kd">â†</span><span class="kt">{</span><span class="o">âŠƒ,</span><span class="na">/</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span><span class="o">âŠ¤âŠ¢</span><span class="p">)</span><span class="na">Â¨</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">+</span><span class="p">(</span><span class="nf">â•D</span><span class="o">,</span><span class="nf">â•A</span><span class="p">)</span><span class="o">â³âŠ¢</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">data16</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day16-input.txt&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">805311100469800804A3E488ACC0B10055D8009548874F65665AD42F60073E7338E7E5C538D8201


      14AEA1A19927797976F8F43CD7354D66747B3005B401397C6CBA2FCEEE7AACDECC017938B


      3F802E000854488F70FC401F8BD09E199005B3600BCBFEEE12FFBB84FC8466B515E92B79B


      1003C797AEBAF53917E99FF2E953D0D284359CA0CB80193D12B3005B4017968D77EB224B4


      6BBF591E7BEBD2FA00100622B4ED64773D0CF7816600B68020000874718E715C0010D8AF1


      E61CC946FB99FC2C20098275EBC0109FA14CAEDC20EB8033389531AAB14C72162492DE33A


      E0118012C05EEB801C0054F880102007A01192C040E100ED20035DA8018402BE20099A002


      0CB801AE0049801E800DD10021E4002DC7D30046C0160004323E42C8EA200DC5A87D06250


      C50015097FB2CFC93A101006F532EB600849634912799EF7BF609270D0802B59876F00424


      6941091A5040402C9BD4DF654967BFDE4A6432769CED4EC3C4F04C000A895B8E98013246A


      6016CB3CCC94C9144A03CFAB9002033E7B24A24016DD802933AFAE48EAA3335A632013BC4


      01D8850863A8803D1C61447A00042E3647B83F313674009E6533E158C3351F94C9902803D


      35C869865D564690103004E74CB001F39BEFFAAD37DFF558C012D005A5A9E851D25F76DD8


      8A5F4BC600ACB6E1322B004E5FE1F2FF0E3005EC017969EB7AE4D1A53D07B918C0B1802F0


      88B2C810326215CCBB6BC140C0149EE87780233E0D298C33B008C52763C9C94BF8DC88650


      4E1ECD4E75C7E4EA00284180371362C44320043E2EC258F24008747785D10C001039F8064


      4F201217401500043A2244B8D200085C3F8690BA78F08018394079A7A996D200806647A49


      E249C675C0802609D66B004658BA7F1562500366279CCBEB2600ACCA6D802C00085C658BD


      1DC401A8EB136100

</span></div></div>
</div>
<p>Now we have to write a bunch of packet parsers operating on bit arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_packet</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â split off 3 bit version, 3 bit type, and remaining bits</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">bits</span><span class="kd">â†</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="o">âŠ‚</span><span class="bp">âµ</span>
  <span class="c1">â dispatch to parsers for types given in part 1</span>
  <span class="nv">type</span><span class="o">â‰¡</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="bp">:</span><span class="nv">parse_literal</span> <span class="nv">version</span> <span class="nv">bits</span>
  <span class="nv">length_type</span><span class="kd">â†</span><span class="m">1</span><span class="o">â†‘</span><span class="nv">bits</span>
  <span class="c1">â operator length_type 0: 15-bit subpacket length in bits</span>
  <span class="nv">length_type</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span><span class="nv">parse_operator_length</span> <span class="nv">version</span> <span class="nv">type</span><span class="p">(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="p">(</span><span class="m">15</span><span class="o">â†‘</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="nv">bits</span><span class="p">)))(</span><span class="m">16</span><span class="o">â†“</span><span class="nv">bits</span><span class="p">)</span>
  <span class="c1">â operator length_type 1: 11-bit subpacket count</span>
  <span class="nv">parse_operator_count</span> <span class="nv">version</span> <span class="nv">type</span><span class="p">(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="p">(</span><span class="m">11</span><span class="o">â†‘</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="nv">bits</span><span class="p">)))(</span><span class="m">12</span><span class="o">â†“</span><span class="nv">bits</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Literals donâ€™t nest and use a simple group encoding. We return the total length
because they go inside other packets that need to skip over them after parsing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_literal</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â returns (#bits (&#39;literal&#39; version value))</span>
  <span class="nv">version</span> <span class="nv">bits</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="c1">â 5-bit groups up to one starting with 0</span>
  <span class="nv">length</span><span class="kd">â†</span><span class="m">5</span><span class="o">Ã—</span><span class="p">(((</span><span class="o">â´</span><span class="nv">bits</span><span class="p">)</span><span class="o">â´</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="na">/</span><span class="nv">bits</span><span class="p">)</span><span class="o">â³</span><span class="m">0</span>
  <span class="nv">value</span><span class="kd">â†</span><span class="p">(</span><span class="nv">length</span><span class="o">â´</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span><span class="na">/</span><span class="nv">length</span><span class="o">â†‘</span><span class="nv">bits</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;literal&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">value</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Length operators slurp up to length bits of nested subpackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_operator_length</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â returns (#bits (&#39;operator&#39; version type subpackets))</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">length</span> <span class="nv">bits</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">subpackets</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="bp">âµ</span><span class="o">=</span><span class="nv">length</span><span class="bp">:</span><span class="no">â¬</span>
    <span class="nv">sublength</span> <span class="nv">packet</span><span class="kd">â†</span><span class="nv">parse_packet</span> <span class="bp">âµ</span><span class="o">â†“</span><span class="nv">bits</span>
    <span class="p">(</span><span class="o">âŠ‚</span><span class="nv">packet</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="bp">âˆ‡</span><span class="p">(</span><span class="nv">sublength</span><span class="o">+</span><span class="bp">âµ</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="m">1</span><span class="o">+</span><span class="m">15</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;operator&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">type</span><span class="p">)(</span><span class="nv">subpackets</span> <span class="m">0</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>And count operators slurp up to count nested subpackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_operator_count</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â returns (#bits (&#39;operator&#39; version type subpackets))</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">count</span> <span class="nv">bits</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">length</span><span class="kd">â†</span><span class="m">0</span>
  <span class="nv">subpackets</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="m">0</span><span class="o">=</span><span class="bp">âµ:</span><span class="no">â¬</span>
    <span class="nv">sublength</span> <span class="nv">packet</span><span class="kd">â†</span><span class="nv">parse_packet</span> <span class="nv">length</span><span class="o">â†“</span><span class="nv">bits</span>
    <span class="nv">length</span><span class="o">+</span><span class="kd">â†</span><span class="nv">sublength</span>
    <span class="p">(</span><span class="o">âŠ‚</span><span class="nv">packet</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="bp">âˆ‡</span><span class="p">(</span><span class="bp">âµ</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="m">1</span><span class="o">+</span><span class="m">11</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;operator&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">âŠ¥</span><span class="nv">type</span><span class="p">)(</span><span class="nv">subpackets</span> <span class="nv">count</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id29">
<h3>Part 1<a class="headerlink" href="#id29" title="Permalink to this headline">Â¶</a></h3>
<p>Weâ€™re supposed to add up â€œversionâ€ fields in each nested packet to prove
that we are parsing correctly I guess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">version_sum</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">version</span><span class="kd">â†</span><span class="m">2</span><span class="o">âŒ·</span><span class="bp">âµ</span>  <span class="c1">â version is always at index 2</span>
  <span class="p">(</span><span class="m">1</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¡âŠ‚</span><span class="s1">&#39;operator&#39;</span><span class="bp">:</span><span class="nv">version</span><span class="o">++</span><span class="na">/</span><span class="bp">âˆ‡</span><span class="na">Â¨</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">4</span><span class="sr">]</span><span class="p">)</span>
  <span class="nv">version</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;C0015000016115A2E0802F182340&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;A0016C880162017C3686B18A3D4780&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">31
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;620080001611562C8802118E34&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;8A004A801A8002F478&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_1</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_1</span> <span class="nv">data16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">971
</span></div></div>
</div>
</div>
<div class="section" id="id30">
<h3>Part 2<a class="headerlink" href="#id30" title="Permalink to this headline">Â¶</a></h3>
<p>Now we get to write an expression evaluator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">evaluate</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="c1">â literals evaluate to fixed value</span>
  <span class="p">(</span><span class="m">1</span><span class="o">âŒ·</span><span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¡âŠ‚</span><span class="s1">&#39;literal&#39;</span><span class="bp">:</span><span class="m">3</span><span class="o">âŒ·</span><span class="bp">âµ</span>
  <span class="c1">â everything else is an operator</span>
  <span class="nv">values</span><span class="kd">â†</span><span class="nv">evaluate</span><span class="na">Â¨</span><span class="p">(</span><span class="o">âŠƒ</span><span class="bp">âµ</span><span class="sr">[</span><span class="m">4</span><span class="sr">]</span><span class="p">)</span>
  <span class="nv">type</span><span class="kd">â†</span><span class="m">3</span><span class="o">âŒ·</span><span class="bp">âµ</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span><span class="o">+</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">1</span><span class="bp">:</span><span class="o">Ã—</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">2</span><span class="bp">:</span><span class="o">âŒŠ</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">3</span><span class="bp">:</span><span class="o">âŒˆ</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">5</span><span class="bp">:</span><span class="o">&gt;</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">6</span><span class="bp">:</span><span class="o">&lt;</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">7</span><span class="bp">:</span><span class="o">=</span><span class="na">/</span><span class="nv">values</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">evaluate</span> <span class="m">2</span><span class="o">âŠƒ</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span><span class="na">Â¨</span><span class="s1">&#39;C200B40A82&#39;</span> <span class="s1">&#39;04005AC33890&#39;</span> <span class="s1">&#39;880086C3E88112&#39;</span> <span class="s1">&#39;CE00C43D881120&#39;</span> <span class="s1">&#39;D8005AC2A8F0&#39;</span> <span class="s1">&#39;F600BC2D8F&#39;</span> <span class="s1">&#39;9C005AC2F8F0&#39;</span> <span class="s1">&#39;9C0141080250320F1802104A08&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 54 7 9 1 0 0 1
</span></div></div>
</div>
<p>The examples seem to work ok. This is pretty convenient and we
could probably represent the tree as an APL expression instead, and
use â. Not for the first time Iâ€™m wondering if they had APL on the
brain this yearâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span> <span class="nv">data16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">831996589851
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-17">
<h2>Day 17<a class="headerlink" href="#day-17" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/17">Puzzle link</a></p>
<p>Today the input is just 4 numbers so Iâ€™m going to type it in manually, being careful to use the unary Â¯ instead of -.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test17</span><span class="kd">â†</span><span class="m">20</span> <span class="m">30</span> <span class="m">Â¯10</span> <span class="m">Â¯5</span>  <span class="c1">â xmin..xmax ymin..ymax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data17</span><span class="kd">â†</span><span class="m">240</span> <span class="m">292</span> <span class="m">Â¯90</span> <span class="m">Â¯57</span>
</pre></div>
</div>
</div>
</div>
<p>We are doing something with trajectories, which we will represent as
2d arrays with one row per step. The current state is a 4-tuple x y vx vy
in the last row that updates like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">step_projectile</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">â†</span><span class="o">,</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="bp">âµ</span> <span class="o">âª</span> <span class="p">((</span><span class="nv">x</span><span class="o">+</span><span class="nv">vx</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span><span class="o">+</span><span class="nv">vy</span><span class="p">)</span> <span class="p">(</span><span class="nv">vx</span><span class="o">-Ã—</span><span class="nv">vx</span><span class="p">)</span> <span class="p">(</span><span class="nv">vy</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Weâ€™ll iterate this until weâ€™ve flown past the target. Since vy decreases
monotonically and the target is below the x-axis, weâ€™ll just say that
happens when y &lt; ymin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">trajectory</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">â†</span><span class="bp">âº</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">past_target</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">_</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">â†</span><span class="o">,</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="nv">y</span><span class="o">&lt;</span><span class="nv">ymin</span><span class="p">)</span><span class="kt">}</span>
  <span class="p">(</span><span class="nv">step_projectile</span><span class="na">â£</span><span class="nv">past_target</span><span class="p">)</span><span class="m">1</span> <span class="m">4</span><span class="o">â´</span><span class="m">0</span> <span class="m">0</span> <span class="nv">vx</span> <span class="nv">vy</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span> <span class="m">2</span> <span class="nv">trajectory</span> <span class="m">20</span> <span class="m">30</span> <span class="m">Â¯10</span> <span class="m">Â¯5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0   0 7  2
 7   2 6  1
13   3 5  0
18   3 4 Â¯1
22   2 3 Â¯2
25   0 2 Â¯3
27  Â¯3 1 Â¯4
28  Â¯7 0 Â¯5
28 Â¯12 0 Â¯6
28 Â¯18 0 Â¯7
</span></div></div>
</div>
<div class="section" id="id31">
<h3>Part 1<a class="headerlink" href="#id31" title="Permalink to this headline">Â¶</a></h3>
<p>Weâ€™ll just search velocities to find the best one. The target is to the
right so we want 0 &lt; vx â‰¤ xmax. Also ymin â‰¤ vy since any lower would go
past immediately, and vy â‰¤ xmax since we get at most xmax x steps and vy
only decreases by 1 each step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day17_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="c1">â returns 1 if point is in target, else 0</span>
  <span class="nv">in_target</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">x</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="nv">x</span><span class="o">â‰¥</span><span class="nv">xmin</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">x</span><span class="o">â‰¤</span><span class="nv">xmax</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">y</span><span class="o">â‰¥</span><span class="nv">ymin</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">y</span><span class="o">â‰¤</span><span class="nv">ymax</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">â tries trajectory vx vy, returns max height if hits target else 0</span>
  <span class="nv">trial</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">points</span><span class="kd">â†</span><span class="nv">vx</span> <span class="nv">vy</span> <span class="nv">trajectory</span> <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span>
    <span class="nv">hit</span><span class="kd">â†</span><span class="o">âˆ¨</span><span class="na">/</span><span class="p">(</span><span class="nv">in_target</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="nv">points</span>
    <span class="nv">hit</span><span class="bp">:</span><span class="m">2</span><span class="o">âŒ·âŒˆ</span><span class="na">âŒ¿</span><span class="nv">points</span>
    <span class="m">0</span>
  <span class="kt">}</span>
  <span class="o">âŒˆ</span><span class="na">/</span><span class="o">,</span><span class="nv">trial</span><span class="na">Â¨</span><span class="o">â³</span><span class="nv">xmax</span> <span class="nv">xmax</span>  <span class="c1">â not quite enough range but works for part 1</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_1</span> <span class="nv">test17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">â day17_1 data17  â embarrassingly slow</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id32">
<h3>Part 2<a class="headerlink" href="#id32" title="Permalink to this headline">Â¶</a></h3>
<p>Now we want all the velocities. This is sorta simpler actuallyâ€¦</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day17_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="c1">â returns 1 if point is in target, else 0</span>
  <span class="nv">in_target</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">x</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="nv">x</span><span class="o">â‰¥</span><span class="nv">xmin</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">x</span><span class="o">â‰¤</span><span class="nv">xmax</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">y</span><span class="o">â‰¥</span><span class="nv">ymin</span><span class="p">)</span><span class="o">âˆ§</span><span class="p">(</span><span class="nv">y</span><span class="o">â‰¤</span><span class="nv">ymax</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">â returns 1 if trajectory with initial velocity vx vy hits target else 0</span>
  <span class="nv">trial</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">â†</span><span class="bp">âµ</span>
    <span class="nv">points</span><span class="kd">â†</span><span class="nv">vx</span> <span class="nv">vy</span> <span class="nv">trajectory</span> <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span>
    <span class="o">âˆ¨</span><span class="na">/</span><span class="p">(</span><span class="nv">in_target</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="nv">points</span>
  <span class="kt">}</span>
  <span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="nv">trial</span><span class="na">Â¨</span><span class="p">(</span><span class="o">â³</span><span class="nv">xmax</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">xmax</span><span class="o">+|</span><span class="nv">ymin</span><span class="p">))</span><span class="o">-âŠ‚</span><span class="m">0</span><span class="p">(</span><span class="o">|</span><span class="nv">ymin</span><span class="o">-</span><span class="m">1</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_2</span> <span class="nv">test17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">112
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_2</span> <span class="nv">data17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INTERRUPT
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-18">
<h2>Day 18<a class="headerlink" href="#day-18" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/18">Puzzle link</a></p>
<p>We get to do arithmetic with â€œsnailfish numbersâ€ aka nested pairs.
This involves a bunch of scanning â€œleftâ€ and â€œrightâ€ so itâ€™s going to
be simpler just to treat them as strings than to bother parsing.
I did try, but gave up when Dyalog crashed with error 139 or something
while I was trying to debug a basic tree traversal - you get what you
pay for, I guess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test18</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day18-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data18</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day18-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Adding a and b is just concatenating</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add_snailfish</span><span class="kd">â†</span><span class="kt">{</span><span class="s1">&#39;[&#39;</span><span class="o">,</span><span class="bp">âº</span><span class="o">,</span><span class="s1">&#39;,&#39;</span><span class="o">,</span><span class="bp">âµ</span><span class="o">,</span><span class="s1">&#39;]&#39;</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;[1,2]&#39;</span> <span class="nv">add_snailfish</span> <span class="s1">&#39;[[3,4],5]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[[1,2],[[3,4],5]]
</span></div></div>
</div>
<p>But then reducing involves a bunch of hoo-ha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">explode</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">start</span><span class="kd">â†</span><span class="p">((</span><span class="o">+</span><span class="na">\</span><span class="p">(</span><span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="bp">âµ</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="p">))</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="o">â³</span><span class="m">1</span>  <span class="c1">â start of first pair to explode</span>
  <span class="nv">start</span><span class="o">&gt;â‰¢</span><span class="bp">âµ:âµ</span>                       <span class="c1">â if none, no need to explode</span>
  <span class="nv">len</span><span class="kd">â†</span><span class="p">(</span><span class="nv">start</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span><span class="o">â³</span><span class="s1">&#39;]&#39;</span>                <span class="c1">â end of first pair</span>
  <span class="nv">a</span> <span class="nv">b</span><span class="kd">â†</span><span class="o">â</span><span class="p">(</span><span class="nv">len</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">â†‘</span><span class="p">(</span><span class="nv">start</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span>           <span class="c1">â get numbers a b in pair</span>
  <span class="c1">â add a to rightmost in left substring</span>
  <span class="nv">add_to_left</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="p">(</span><span class="o">â•</span><span class="p">(</span><span class="nv">a</span><span class="o">+â</span><span class="p">(</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span><span class="p">)))</span><span class="o">,</span><span class="p">(</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†“</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">â add b to leftmost in right substring</span>
  <span class="nv">add_to_right</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="p">(</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Offsets</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span><span class="p">)</span><span class="o">,â•</span><span class="p">(</span><span class="nv">b</span><span class="o">+â</span><span class="p">(</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Offsets</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†“</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="c1">â form new left, right substrings</span>
  <span class="nv">left</span><span class="kd">â†</span><span class="p">(</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="nf">â•R</span> <span class="nv">add_to_left</span><span class="p">)</span><span class="o">âŠ¢</span><span class="p">(</span><span class="nv">start</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">â†‘</span><span class="bp">âµ</span>
  <span class="nv">right</span><span class="kd">â†</span><span class="p">(</span><span class="s1">&#39;^[^\d]*(\d+)&#39;</span><span class="nf">â•R</span> <span class="nv">add_to_right</span><span class="p">)</span><span class="o">âŠ¢</span><span class="p">(</span><span class="nv">start</span><span class="o">+</span><span class="nv">len</span><span class="p">)</span><span class="o">â†“</span><span class="bp">âµ</span>
  <span class="nv">left</span><span class="o">,</span><span class="s1">&#39;0&#39;</span><span class="o">,</span><span class="nv">right</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[[[[9,8],1],2],3],4]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[0,9],2],3],4]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[7,[6,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[7,[6,[5,[7,0]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[6,[5,[4,[3,2]]]],1]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[6,[5,[7,0]]],3]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[7,0]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The other hoo-ha operation in reducing is â€œsplitâ€.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span><span class="kd">â†</span><span class="s1">&#39;(\d\d+).*&#39;</span><span class="nf">â•R</span><span class="kt">{</span><span class="nv">n</span><span class="kd">â†</span><span class="o">â</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span> <span class="p">â‹„</span> <span class="s1">&#39;[&#39;</span><span class="o">,</span><span class="p">(</span><span class="o">â•âŒŠ</span><span class="nv">n</span><span class="o">Ã·</span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;,&#39;</span><span class="o">,</span><span class="p">(</span><span class="o">â•âŒˆ</span><span class="nv">n</span><span class="o">Ã·</span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;]&#39;</span><span class="o">,</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">â†“</span><span class="bp">âµ</span><span class="na">.</span><span class="nv">Match</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span> <span class="s1">&#39;10&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[5,5]
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span> <span class="s1">&#39;11&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[5,6]
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">split</span> <span class="s1">&#39;[[[[0,7],4],[15,[0,13]]],[1,1]]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[0,7],4],[[7,8],[0,13]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">split</span> <span class="s1">&#39;[[[[0,7],4],[[7,8],[0,13]]],[1,1]]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[0,7],4],[[7,8],[0,[6,7]]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>To reduce, iterate explode and split.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">reduce</span><span class="kd">â†</span><span class="p">(</span><span class="nv">split</span><span class="na">âˆ˜</span><span class="p">(</span><span class="nv">explode</span><span class="na">â£</span><span class="o">â‰¡</span><span class="p">))</span><span class="na">â£</span><span class="o">â‰¡</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">reduce</span> <span class="s1">&#39;[[[[[4,3],4],4],[7,[[8,4],9]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[[[[0,7],4],[[7,8],[6,0]]],[8,1]]
</span></div></div>
</div>
<p>Adding is folding (left) then reducing. APLâ€™s fold is right-to-left
(because of course) so we need a helper for fold left. Note we have
to be careful to reduce after each addition because otherwise we might
end up with pairs nested more than 4 deep which breaks assumptions
in explode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add_reduce</span><span class="kd">â†</span><span class="p">(</span><span class="nv">reduce</span> <span class="nv">add_snailfish</span><span class="p">)</span><span class="kt">{</span><span class="o">â†‘</span><span class="bp">âºâº</span><span class="na">â¨/</span><span class="p">(</span><span class="o">âŒ½</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,</span><span class="no">â¬</span><span class="kt">}</span><span class="o">âŠ¢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[1,1],[2,2]],[3,3]],[4,4]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span> <span class="s1">&#39;[5,5]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[3,0],[5,3]],[4,4]],[5,5]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span> <span class="s1">&#39;[5,5]&#39;</span> <span class="s1">&#39;[6,6]&#39;</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[5,0],[7,4]],[5,5]],[6,6]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">larger_example</span><span class="kd">â†</span><span class="s1">&#39;[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]&#39;</span> <span class="s1">&#39;[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]&#39;</span> <span class="s1">&#39;[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]&#39;</span> <span class="s1">&#39;[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]&#39;</span> <span class="s1">&#39;[7,[5,[[3,8],[1,4]]]]&#39;</span> <span class="s1">&#39;[[2,[2,2]],[8,[8,1]]]&#39;</span> <span class="s1">&#39;[2,9]&#39;</span> <span class="s1">&#39;[1,[[[9,3],9],[[9,0],[0,7]]]]&#39;</span> <span class="s1">&#39;[[[5,[7,4]],7],1]&#39;</span> <span class="s1">&#39;[[[[4,2],2],6],[8,7]]&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="nv">larger_example</span><span class="p">)</span><span class="o">â‰¡</span><span class="s1">&#39;[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="section" id="id33">
<h3>Part 1<a class="headerlink" href="#id33" title="Permalink to this headline">Â¶</a></h3>
<p>Weâ€™re supposed to multiply and add up the tree of pairs. If APL had operator
precedence, we could substute +2Ã— for â€˜,â€™ and so on and use â. But it doesnâ€™t,
so we have to build our own evaluator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">translate</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âºâº</span><span class="p">(</span><span class="bp">âµâµ</span><span class="o">âŒ·</span><span class="na">â¨âˆ˜</span><span class="o">âŠ‚â³</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="o">âˆŠ</span><span class="na">âˆ˜</span><span class="bp">âºâº</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">parse_snailfish</span><span class="kd">â†</span><span class="o">â</span><span class="s1">&#39;[],&#39;</span> <span class="nv">translate</span> <span class="s1">&#39;() &#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[9,1],[1,9]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”
â”‚9 1â”‚1 9â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">magnitude</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="m">0</span><span class="o">=â‰¡</span><span class="bp">âµ:</span> <span class="bp">âµ</span>
  <span class="nv">left</span> <span class="nv">right</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="p">(</span><span class="m">3</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">magnitude</span> <span class="nv">left</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="m">2</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">magnitude</span> <span class="nv">right</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">129</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[9,1],[1,9]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">143</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[1,2],[[3,4],5]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1384</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[0,7],4],[[7,8],[6,0]]],[8,1]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">445</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[1,1],[2,2]],[3,3]],[4,4]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">791</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[3,0],[5,3]],[4,4]],[5,5]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1137</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[5,0],[7,4]],[5,5]],[6,6]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3488</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Great, that all seems to work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span><span class="kd">â†</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="p">(</span><span class="nv">add_reduce</span> <span class="o">âŠ¢</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span> <span class="nv">test18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4140
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span> <span class="nv">data18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3216
</span></div></div>
</div>
</div>
<div class="section" id="id34">
<h3>Part 2<a class="headerlink" href="#id34" title="Permalink to this headline">Â¶</a></h3>
<p>Ok, find the largest magnitude for pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span><span class="kd">â†</span><span class="o">âŒˆ</span><span class="na">/</span><span class="o">,</span><span class="na">âˆ˜</span><span class="p">(</span><span class="na">âˆ˜.</span><span class="kt">{</span><span class="nv">day18_1</span> <span class="bp">âº</span> <span class="bp">âµ</span><span class="kt">}</span><span class="na">â¨</span><span class="o">âŠ¢</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span> <span class="nv">test18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3993
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span> <span class="nv">data18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4643
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-19">
<h2>Day 19<a class="headerlink" href="#day-19" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/19">Puzzle link</a></p>
<p>Today weâ€™ve got a bunch of cattywampus 3d scanners that separately measure
where some beacons are. We are gonna do a bunch of 3d transformations
so will want to turn the points into homogeneous coordinates.</p>
<p>All the â€œeachâ€ dots are super ugly today - I am sure there is a better way.
We have to be careful reading input because there is an extra newline
after each scannerâ€™s data except the last.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test19</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span><span class="o">,</span><span class="m">1</span><span class="kt">}</span><span class="na">Â¨Â¨</span><span class="o">â</span><span class="na">Â¨Â¨Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨Â¨</span><span class="kt">{{</span><span class="s1">&#39;&#39;</span><span class="o">â‰¡âŠƒ</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="bp">:</span> <span class="m">Â¯1</span><span class="o">â†“</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="bp">âµ</span><span class="kt">}</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="kt">{</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="o">âˆŠ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="kt">}</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day19-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data19</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span><span class="o">,</span><span class="m">1</span><span class="kt">}</span><span class="na">Â¨Â¨</span><span class="o">â</span><span class="na">Â¨Â¨Â¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">â‰ âŠ†âŠ¢</span><span class="p">)</span><span class="na">Â¨Â¨</span><span class="kt">{{</span><span class="s1">&#39;&#39;</span><span class="o">â‰¡âŠƒ</span><span class="p">(</span><span class="m">Â¯1</span><span class="o">â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="bp">:</span> <span class="m">Â¯1</span><span class="o">â†“</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="bp">âµ</span><span class="kt">}</span><span class="p">(</span><span class="m">1</span><span class="o">â†“</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="kt">{</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="o">âˆŠ</span><span class="na">Â¨</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŠ‚</span><span class="bp">âµ</span><span class="kt">}</span><span class="o">âŠƒ</span><span class="nf">â•NGET</span><span class="s1">&#39;day19-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We will need to line some of the scannersâ€™ coordinate frames up.
Each of 3 axes might be negated or not and there are 6 permutations
of axes. But half of those transformations turn the universe inside
out, so det M=1 filters out the 24 we want.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="o">â³</span><span class="bp">âµ</span><span class="p">)(</span><span class="o">,</span><span class="sr">[</span><span class="o">â³</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">âŠ¢,</span><span class="na">â¤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">â¤</span><span class="m">1</span><span class="p">)</span><span class="na">â£</span><span class="bp">âµ</span><span class="o">â‰âª</span><span class="no">â¬</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">det</span><span class="kd">â†</span><span class="kt">{</span><span class="o">-</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="o">Ã—</span><span class="na">/</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="m">2</span> <span class="m">3</span><span class="o">â´</span><span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">0</span> <span class="m">2</span> <span class="m">1</span><span class="p">)</span><span class="o">âŒ½â†‘</span><span class="bp">âµ</span> <span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">orientations</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=</span><span class="p">(</span><span class="nv">det</span><span class="na">â¤</span><span class="m">2</span><span class="p">)</span><span class="bp">âµ</span><span class="p">)</span><span class="na">âŒ¿</span><span class="bp">âµ</span><span class="kt">}</span><span class="o">â†‘â†‘</span><span class="kt">{</span><span class="o">Ã—</span><span class="bp">âµ</span><span class="o">Ã—</span><span class="p">(</span><span class="m">1</span><span class="o">-|</span><span class="bp">âµ</span><span class="p">)</span><span class="o">âŒ½â†‘</span><span class="p">(</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨Â¨</span><span class="o">,</span><span class="p">(</span><span class="o">â†“â‰</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="m">2</span><span class="o">Ã—</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span> <span class="m">2</span><span class="o">âŠ¤â³</span><span class="m">8</span><span class="p">)))</span><span class="na">âˆ˜.</span><span class="o">Ã—â†“</span><span class="p">(</span><span class="nv">permutations</span> <span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">orientations</span><span class="kd">â†</span><span class="o">â†‘</span><span class="kt">{</span><span class="p">((</span><span class="o">â†‘â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="o">,</span><span class="m">0</span><span class="p">)</span><span class="o">âª</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">â†“â†“</span><span class="nv">orientations</span>  <span class="c1">â turn 3x3s into 4x4s</span>
</pre></div>
</div>
</div>
</div>
<p>Weâ€™ll want the 4x4 identity matrix I4, and a helper to make
transformation matrices combining a translation and a rotation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">I4</span><span class="kd">â†</span><span class="o">â†‘</span><span class="p">(</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">transform</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">p</span> <span class="nv">rmat</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">((</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="p">(</span><span class="o">â†‘</span><span class="nv">p</span><span class="p">))</span><span class="na">@</span><span class="p">(</span><span class="m">1</span> <span class="m">4</span><span class="p">)(</span><span class="m">2</span> <span class="m">4</span><span class="p">)(</span><span class="m">3</span> <span class="m">4</span><span class="p">))</span><span class="o">âŠ¢</span><span class="nv">rmat</span><span class="kt">}</span>  <span class="c1">â note ignore 4th of p</span>
</pre></div>
</div>
</div>
</div>
<p>To align two scanners, we guess which beacons i j are the same and
get points relative to that, also trying all rotations k of the second
scanner relative to the first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">align</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">scanner1</span> <span class="nv">scanner2</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">trial</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â count i j k up to corresponding array bounds</span>
    <span class="nv">none</span> <span class="nv">k</span> <span class="nv">j</span> <span class="nv">i</span><span class="kd">â†</span><span class="p">(</span><span class="m">2</span><span class="p">(</span><span class="o">â‰¢</span><span class="nv">orientations</span><span class="p">)(</span><span class="o">â‰¢âŠƒ</span><span class="nv">scanner2</span><span class="p">)(</span><span class="o">â‰¢âŠƒ</span><span class="nv">scanner1</span><span class="p">)</span><span class="o">âŠ¤</span><span class="bp">âµ</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">none</span><span class="bp">:</span><span class="m">0</span>  <span class="c1">â no alignment possible</span>
    <span class="c1">â u translates scanner1 points relative to point i</span>
    <span class="nv">u</span><span class="kd">â†</span><span class="nv">transform</span><span class="p">(</span><span class="o">-</span><span class="nv">i</span><span class="o">âŒ·âŠƒ</span><span class="nv">scanner1</span><span class="p">)</span><span class="nv">I4</span>
    <span class="c1">â v translates scanner2 points relative to point j and rotates</span>
    <span class="c1">â (note that point j must be rotated first)</span>
    <span class="nv">pj</span><span class="kd">â†</span><span class="o">â‰</span><span class="nv">k</span><span class="o">âŒ·</span><span class="nv">orientations</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â‰â†‘</span><span class="nv">j</span><span class="o">âŒ·âŠƒ</span><span class="nv">scanner2</span><span class="p">)</span>
    <span class="nv">v</span><span class="kd">â†</span><span class="nv">transform</span><span class="p">(</span><span class="o">-</span><span class="nv">pj</span><span class="p">)(</span><span class="nv">k</span><span class="o">âŒ·</span><span class="nv">orientations</span><span class="p">)</span>
    <span class="nv">scanner1_p</span><span class="kd">â†</span><span class="o">â†“â†‘</span><span class="kt">{</span><span class="o">â‰</span><span class="nv">u</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â‰â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">scanner1</span>
    <span class="nv">scanner2_p</span><span class="kd">â†</span><span class="o">â†“â†‘</span><span class="kt">{</span><span class="o">â‰</span><span class="nv">v</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â‰â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">scanner2</span>
    <span class="c1">â count transformed point matches</span>
    <span class="nv">num_matches</span><span class="kd">â†</span><span class="nv">scanner1_p</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">âˆŠ</span><span class="p">)</span><span class="nv">scanner2_p</span>
    <span class="nv">num_matches</span><span class="o">â‰¥</span><span class="m">12</span><span class="bp">:</span><span class="p">(</span><span class="o">âŒ¹</span><span class="nv">u</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">v</span><span class="p">)</span>  <span class="c1">â transform from 2-&gt;1 frame</span>
    <span class="bp">âˆ‡</span><span class="p">(</span><span class="bp">âµ</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="nv">trial</span> <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">align</span> <span class="p">(</span><span class="m">1</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Â¯1 0  0    68
 0 1  0 Â¯1246
 0 0 Â¯1   Â¯43
 0 0  0     1
</span></div></div>
</div>
<p>align returns a transformation matrix that maps back to scanner1â€™s frame.
For example, the 10th beacon in scanner1â€™s list is the same as the 1st
beacon in scanner2â€™s list, so multiplying the result matrix canonicalizes
to scanner1â€™s frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">âŒ·âŠƒ</span><span class="p">(</span><span class="m">1</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Â¯618 Â¯824 Â¯621 1â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">â‰</span><span class="p">((</span><span class="nv">align</span> <span class="p">(</span><span class="m">1</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)))</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â‰â†‘</span><span class="p">(</span><span class="m">1</span><span class="o">âŒ·âŠƒ</span><span class="p">(</span><span class="m">2</span><span class="o">âŒ·</span><span class="nv">test19</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Â¯618 Â¯824 Â¯621 1
</span></div></div>
</div>
<p>Then we can just search to figure out the relative positions of all the probes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">align_all</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">done</span><span class="kd">â†</span><span class="m">1</span><span class="o">â´</span><span class="m">1</span>              <span class="c1">â indices that are done</span>
  <span class="nv">todo</span><span class="kd">â†</span><span class="m">1</span><span class="o">â†“â³â‰¢</span><span class="nv">scanners</span>     <span class="c1">â indices left todo</span>
  <span class="nv">mats</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">I4</span><span class="kt">}</span><span class="na">Â¨</span><span class="o">â³â‰¢</span><span class="nv">scanners</span>  <span class="c1">â transform to canonical frame</span>
  <span class="c1">â match a scanner from todo with one from done</span>
  <span class="nv">find_pair</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="c1">â iterate i j over todo and done</span>
    <span class="nv">none</span> <span class="nv">j</span> <span class="nv">i</span><span class="kd">â†</span><span class="p">(</span><span class="m">2</span><span class="p">(</span><span class="o">â‰¢</span><span class="nv">done</span><span class="p">)(</span><span class="o">â‰¢</span><span class="nv">todo</span><span class="p">)</span><span class="o">âŠ¤</span><span class="bp">âµ</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">none</span><span class="bp">:</span><span class="s1">&#39;error&#39;</span>
    <span class="nv">ith</span> <span class="nv">jth</span><span class="kd">â†</span><span class="p">(</span><span class="nv">i</span><span class="o">âŒ·</span><span class="nv">todo</span><span class="p">)(</span><span class="nv">j</span><span class="o">âŒ·</span><span class="nv">done</span><span class="p">)</span>
    <span class="c1">â try aligning scanner i with j</span>
    <span class="nv">r</span><span class="kd">â†</span><span class="nv">align</span><span class="p">(</span><span class="nv">jth</span><span class="o">âŒ·</span><span class="nv">scanners</span><span class="p">)(</span><span class="nv">ith</span><span class="o">âŒ·</span><span class="nv">scanners</span><span class="p">)</span>
    <span class="nv">r</span><span class="o">â‰¡</span><span class="m">0</span><span class="bp">:âˆ‡</span><span class="p">(</span><span class="bp">âµ</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">â no alignment, iterate</span>
    <span class="c1">â update transform for scanner i</span>
    <span class="nv">mats</span><span class="sr">[</span><span class="nv">ith</span><span class="sr">]</span><span class="kd">â†</span><span class="o">âŠ‚</span><span class="p">(</span><span class="o">âŠƒ</span><span class="nv">mats</span><span class="sr">[</span><span class="nv">jth</span><span class="sr">]</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="nv">r</span>
    <span class="c1">â mark scanner i done</span>
    <span class="nv">done</span><span class="o">,</span><span class="kd">â†</span><span class="nv">todo</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="nv">todo</span><span class="o">âŠ¢</span><span class="kd">â†</span><span class="p">((</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">â†‘</span><span class="nv">todo</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">i</span><span class="o">â†“</span><span class="nv">todo</span><span class="p">)</span>
    <span class="nv">search</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="c1">â search until all scanners are done</span>
  <span class="nv">search</span><span class="kd">â†</span><span class="kt">{</span>
    <span class="m">0</span><span class="o">=â‰¢</span><span class="nv">todo</span><span class="bp">:</span><span class="nv">mats</span>
    <span class="nv">find_pair</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">search</span> <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id35">
<h3>Part 1<a class="headerlink" href="#id35" title="Permalink to this headline">Â¶</a></h3>
<p>How many beacons are there total? We can just find all the transforms,
and then collect unique positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day19_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">mats</span><span class="kd">â†</span><span class="nv">align_all</span> <span class="nv">scanners</span>
  <span class="o">â‰¢âˆªâŠƒ,</span><span class="na">/</span><span class="kt">{</span>
    <span class="nv">r</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nv">mats</span><span class="sr">[</span><span class="bp">âµ</span><span class="sr">]</span>
    <span class="nv">beacons</span><span class="kd">â†</span><span class="o">âŠƒ</span><span class="nv">scanners</span><span class="sr">[</span><span class="bp">âµ</span><span class="sr">]</span>
    <span class="o">â†“â†‘</span><span class="kt">{</span><span class="o">â‰</span><span class="nv">r</span><span class="o">+</span><span class="na">.</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â‰â†‘</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">beacons</span>
  <span class="kt">}</span><span class="na">Â¨</span><span class="o">â³â‰¢</span><span class="bp">âµ</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day19_1</span> <span class="nv">test19</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">79
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">âday19_1 data19  â this is extremely... slow...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id36">
<h3>Part 2<a class="headerlink" href="#id36" title="Permalink to this headline">Â¶</a></h3>
<p>Find the max distance between two scanners. We can get this from their
transformation matrices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day19_2</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">mats</span><span class="kd">â†</span><span class="nv">align_all</span> <span class="nv">scanners</span>
  <span class="nv">origins</span><span class="kd">â†</span><span class="kt">{</span><span class="bp">âµ</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span> <span class="m">4</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span> <span class="m">4</span><span class="p">)</span> <span class="p">(</span><span class="m">3</span> <span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">Â¨</span><span class="nv">mats</span>
  <span class="o">âŒˆ</span><span class="na">/</span><span class="o">,</span><span class="na">âˆ˜.</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">|</span><span class="bp">âº</span><span class="o">-</span><span class="bp">âµ</span><span class="kt">}</span><span class="na">â¨</span><span class="nv">origins</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day19_2</span> <span class="nv">test19</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3621
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">âday19_2 data19  â very... very... slow</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-20">
<h2>Day 20<a class="headerlink" href="#day-20" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/20">Puzzle link</a></p>
<p>Ok, this one seems made for APL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span><span class="kd">â†</span><span class="s1">&#39;#&#39;</span><span class="na">âˆ˜</span><span class="o">=</span><span class="na">Â¨</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day20-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">â•</span><span class="kd">â†</span><span class="nv">test20_bitmap</span><span class="kd">â†</span><span class="o">â†‘</span><span class="s1">&#39;#&#39;</span><span class="na">âˆ˜</span><span class="o">=</span><span class="na">Â¨</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day20-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 0
1 0 0 0 0
1 1 0 0 1
0 0 1 0 0
0 0 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span><span class="kd">â†</span><span class="s1">&#39;#&#39;</span><span class="na">âˆ˜</span><span class="o">=</span><span class="na">Â¨</span><span class="o">âŠƒâŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day20-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_bitmap</span><span class="kd">â†</span><span class="o">â†‘</span><span class="s1">&#39;#&#39;</span><span class="na">âˆ˜</span><span class="o">=</span><span class="na">Â¨</span><span class="m">2</span><span class="o">â†“âŠƒ</span><span class="nf">â•NGET</span> <span class="s1">&#39;day20-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>To enhance, we could just use the stencil operator with its default padding.
But trickly the input lookup maps index 0 to 1, so the array should be
1-padded on odd iterations!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">enhance_even</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">k</span><span class="kd">â†</span><span class="bp">âº</span> <span class="p">â‹„</span> <span class="p">(</span><span class="kt">{</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">âŠ¥,</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âŠ¢</span><span class="p">)</span><span class="m">0</span><span class="p">(</span><span class="o">,</span><span class="na">âˆ˜</span><span class="o">âŒ½</span><span class="na">âˆ˜</span><span class="o">â‰</span><span class="na">â£</span><span class="m">20</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">enhance_odd</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">k</span><span class="kd">â†</span><span class="bp">âº</span> <span class="p">â‹„</span> <span class="m">Â¯4</span><span class="o">â†“</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="m">Â¯4</span><span class="o">â†“</span><span class="m">4</span><span class="o">â†“</span><span class="m">4</span><span class="o">â†“</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="kt">{</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">âŠ¥,</span><span class="bp">âµ</span><span class="sr">]</span><span class="kt">}</span><span class="na">âŒº</span><span class="m">3</span> <span class="m">3</span><span class="o">âŠ¢</span><span class="p">)</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">(</span><span class="o">,</span><span class="na">âˆ˜</span><span class="o">âŒ½</span><span class="na">âˆ˜</span><span class="o">â‰</span><span class="na">â£</span><span class="m">20</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id37">
<h3>Part 1<a class="headerlink" href="#id37" title="Permalink to this headline">Â¶</a></h3>
<p>Count 1s after enhancing twice (after once would be infinite!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day20_1</span><span class="kd">â†</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">(</span><span class="bp">âº</span> <span class="nv">enhance_odd</span> <span class="p">(</span><span class="bp">âº</span> <span class="nv">enhance_even</span> <span class="bp">âµ</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span> <span class="nv">day20_1</span> <span class="nv">test20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">35
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span> <span class="nv">day20_1</span> <span class="nv">data20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5275
</span></div></div>
</div>
</div>
<div class="section" id="id38">
<h3>Part 2<a class="headerlink" href="#id38" title="Permalink to this headline">Â¶</a></h3>
<p>Now enhance 50 times instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day20_2</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">k</span><span class="kd">â†</span><span class="bp">âº</span> <span class="p">â‹„</span> <span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="nv">k</span> <span class="nv">enhance_odd</span> <span class="p">(</span><span class="nv">k</span> <span class="nv">enhance_even</span> <span class="bp">âµ</span><span class="p">))</span><span class="kt">}</span><span class="na">â£</span><span class="m">25</span><span class="p">)</span><span class="bp">âµ</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span> <span class="nv">day20_2</span> <span class="nv">test20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3351
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span> <span class="nv">day20_2</span> <span class="nv">data20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16482
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-21">
<h2>Day 21<a class="headerlink" href="#day-21" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/21">Puzzle link</a></p>
<p>We get to play with dice today. My first instinct was to pass a dice
closure to a simulation function, but APL doesnâ€™t have first class functions.
So instead, Iâ€™ll think about the sequences of rolls for each player.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">6</span><span class="kt">{</span><span class="bp">âµ</span><span class="na">âŒ¿â¨</span><span class="m">0</span><span class="o">=</span><span class="bp">âº</span><span class="o">|â³â‰¢</span><span class="bp">âµ</span><span class="kt">}</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">+</span><span class="m">100</span><span class="o">|âŠ¢</span><span class="p">)((</span><span class="o">â³</span><span class="m">306</span><span class="p">)</span><span class="o">-</span><span class="m">6</span><span class="p">)</span>  <span class="c1">â player 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6 24 42 60 78 96 114 132 150 168 186 204 222 240 258 276 294 12 30 48 66 84 102

       120 138 156 174 192 210 228 246 264 282 200 18 36 54 72 90 108 126 144 1

      62 180 198 216 234 252 270 288
</span></div></div>
</div>
<p>This looks like just 6+18n (mod 300) where n is the turn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">300</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6 24 42 60 78 96 114 132 150 168 186 204 222 240 258 276 294 12 30 48 66 84 102

       120 138 156 174 192 210 228 246 264 282 300 18 36 54 72 90 108 126 144 1

      62 180 198 216 234 252 270 288
</span></div></div>
</div>
<p>To find score totals we could add that up mod 10 and add the start position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="m">4</span><span class="o">+</span><span class="m">10</span><span class="o">|+</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">â 4 is start position</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 14 20 26 30 40 44 50 56 60 70 74 80 86 90 100 104 110 116 120 130 134 140 14

      6 150 160 164 170 176 180 190 194 200 206 210 220 224 230 236 240 250 254

       260 266 270 280 284 290 296 300
</span></div></div>
</div>
<p>But note that positions are cyclical with period 5 for player 1 and
10 for player 2, hmm. This is gonna be a little overcomplicated for
part 1, but why not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="p">(</span><span class="o">âŠ¢+âŠ£Ã—</span><span class="m">0</span><span class="o">=âŠ¢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="m">4</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">â player 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10

       4 6 6 4 10 4 6 6 4 10 4 6 6 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="p">(</span><span class="o">âŠ¢+âŠ£Ã—</span><span class="m">0</span><span class="o">=âŠ¢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="m">8</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="m">15</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">â player 2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8

       3 6 7 6 3 8 1 2 1 8
</span></div></div>
</div>
<p>I bet all the positions repeat every 10 turns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">start</span> <span class="nv">offset</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="m">10</span><span class="p">(</span><span class="o">âŠ¢+âŠ£Ã—</span><span class="m">0</span><span class="o">=âŠ¢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="nv">start</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="nv">offset</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">10</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span> <span class="m">4</span> <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 4 6 6 4 10 4 6 6 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span> <span class="m">6</span> <span class="m">15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 4 5 4 1 6 9 10 9 6
</span></div></div>
</div>
<p>This suggests a way to compute the score for turn number n.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">score</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">seq</span> <span class="nv">n</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="p">(</span><span class="o">+</span><span class="na">\</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="nv">seq</span><span class="p">))</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="m">10</span><span class="o">|</span><span class="nv">n</span><span class="p">)</span><span class="sr">]</span><span class="o">+</span><span class="p">((</span><span class="o">âŒŠ</span><span class="p">(</span><span class="nv">n</span><span class="o">Ã·</span><span class="m">10</span><span class="p">))</span><span class="o">Ã—</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="nv">seq</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="m">4</span> <span class="m">6</span><span class="p">)</span> <span class="m">166</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">Â¯1</span><span class="o">â†‘+</span><span class="na">\</span><span class="m">4</span><span class="o">+</span><span class="m">10</span><span class="o">|+</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">Ã—</span><span class="p">(</span><span class="o">â³</span><span class="m">166</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
</span></div></div>
</div>
<div class="section" id="id39">
<h3>Part 1<a class="headerlink" href="#id39" title="Permalink to this headline">Â¶</a></h3>
<p>Find the winning turn.  We can just binary searchâ€¦ but I really
donâ€™t want to write binary search.</p>
<p>TIL that Dyalog has a
<a class="reference external" href="https://aplwiki.com/wiki/Dfns_workspace">standard library</a>!
You can copy stuff out of the baked in â€˜dfnsâ€™ workspaceâ€¦ thatâ€™s
kinda nice. Note that binary search takes a function as an
argument by actually being an â€œoperatorâ€, which is allowed to
operate on functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;bsearch&#39;</span><span class="nf">â•CY</span><span class="s1">&#39;dfns&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day21_1</span><span class="kd">â†</span><span class="kt">{</span>
  <span class="nv">start1</span> <span class="nv">start2</span><span class="kd">â†</span><span class="bp">âµ</span>
  <span class="nv">score1</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="nv">start1</span> <span class="m">6</span><span class="p">)</span> <span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">score2</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="nv">start2</span> <span class="m">15</span><span class="p">)</span> <span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">max_turns</span><span class="kd">â†</span><span class="m">1e12</span>
  <span class="nv">win1</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">score1</span> <span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¥</span><span class="m">1000</span><span class="kt">}</span> <span class="nv">bsearch</span> <span class="m">1</span> <span class="nv">max_turns</span>
  <span class="nv">win2</span><span class="kd">â†</span><span class="kt">{</span><span class="p">(</span><span class="nv">score2</span> <span class="bp">âµ</span><span class="p">)</span><span class="o">â‰¥</span><span class="m">1000</span><span class="kt">}</span> <span class="nv">bsearch</span> <span class="m">1</span> <span class="nv">max_turns</span>
  <span class="nv">win1</span><span class="o">&lt;</span><span class="nv">win2</span><span class="bp">:</span> <span class="p">((</span><span class="m">6</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">win1</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="o">+</span><span class="m">3</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">score2</span> <span class="p">(</span><span class="nv">win1</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>  <span class="c1">â p1 wins</span>
  <span class="p">(</span><span class="m">6</span><span class="o">Ã—</span><span class="nv">win2</span><span class="p">)</span><span class="o">Ã—</span><span class="p">(</span><span class="nv">score1</span> <span class="nv">win2</span><span class="p">)</span> <span class="c1">â p2 wins</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_1</span> <span class="m">4</span> <span class="m">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">739785
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_1</span> <span class="m">8</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">518418
</span></div></div>
</div>
</div>
<div class="section" id="id40">
<h3>Part 2<a class="headerlink" href="#id40" title="Permalink to this headline">Â¶</a></h3>
<p>Ok, now we have a quantum die, and have to count winning games.
This seems like a dynamic programming thing. We will tabulate
outcomes (#p1wins #p2wins), filling in backwards to avoid crazy
recursion.</p>
<p>I am going to use for loops, because it is easier to understand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">dirac_table</span><span class="kd">â†</span><span class="m">2</span> <span class="m">10</span> <span class="m">21</span> <span class="m">10</span> <span class="m">21</span><span class="o">â´</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span>  <span class="c1">â to_play p1 p1_score+1 p2 p2_score+1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">r</span><span class="kd">â†</span><span class="nv">tabulate_dirac_wins</span><span class="sr">;</span><span class="nv">to_play</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="nv">p1_n</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="nv">p2_n</span><span class="sr">;</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2_score</span><span class="sr">;</span><span class="nv">r1</span><span class="sr">;</span><span class="nv">r2</span><span class="sr">;</span><span class="nv">r3</span><span class="sr">;</span><span class="nv">outcome</span>
 <span class="nv">mod10</span><span class="kd">â†</span><span class="kt">{</span><span class="m">10</span><span class="p">(</span><span class="o">âŠ¢+âŠ£Ã—</span><span class="m">0</span><span class="o">=âŠ¢</span><span class="p">)(</span><span class="m">10</span><span class="o">|</span><span class="bp">âµ</span><span class="p">)</span><span class="kt">}</span>
 <span class="bp">:</span><span class="nv">For</span> <span class="nv">p1_score</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">âŒ½</span><span class="p">(</span><span class="o">â³</span><span class="m">21</span><span class="p">)</span><span class="o">-</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">For</span> <span class="nv">p2_score</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">âŒ½</span><span class="p">(</span><span class="o">â³</span><span class="m">21</span><span class="p">)</span><span class="o">-</span><span class="m">1</span>
         <span class="bp">:</span><span class="nv">For</span> <span class="nv">p1</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">10</span>
             <span class="bp">:</span><span class="nv">For</span> <span class="nv">p2</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">10</span>
                 <span class="bp">:</span><span class="nv">For</span> <span class="nv">to_play</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">2</span>
                     <span class="bp">:</span><span class="nv">For</span> <span class="nv">r1</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">3</span>
                         <span class="bp">:</span><span class="nv">For</span> <span class="nv">r2</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">3</span>
                             <span class="bp">:</span><span class="nv">For</span> <span class="nv">r3</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">â³</span><span class="m">3</span>
                                 <span class="bp">:</span><span class="nv">If</span> <span class="nv">to_play</span><span class="o">=</span><span class="m">1</span>
                                     <span class="nv">p1_n</span><span class="kd">â†</span><span class="nv">mod10</span><span class="p">(</span><span class="nv">p1</span><span class="o">+</span><span class="nv">r1</span><span class="o">+</span><span class="nv">r2</span><span class="o">+</span><span class="nv">r3</span><span class="p">)</span>
                                     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">p1_score</span><span class="o">+</span><span class="nv">p1_n</span><span class="p">)</span><span class="o">â‰¥</span><span class="m">21</span>
                                         <span class="nv">outcome</span><span class="kd">â†</span><span class="o">âŠ‚</span><span class="m">1</span> <span class="m">0</span>
                                     <span class="bp">:</span><span class="nv">Else</span>
                                         <span class="nv">outcome</span><span class="kd">â†</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="nv">p1_n</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="o">+</span><span class="nv">p1_n</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="sr">]</span>
                                     <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="bp">:</span><span class="nv">Else</span> <span class="c1">â to_play=2</span>
                                     <span class="nv">p2_n</span><span class="kd">â†</span><span class="nv">mod10</span><span class="p">(</span><span class="nv">p2</span><span class="o">+</span><span class="nv">r1</span><span class="o">+</span><span class="nv">r2</span><span class="o">+</span><span class="nv">r3</span><span class="p">)</span>
                                     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">p2_score</span><span class="o">+</span><span class="nv">p2_n</span><span class="p">)</span><span class="o">â‰¥</span><span class="m">21</span>
                                         <span class="nv">outcome</span><span class="kd">â†</span><span class="o">âŠ‚</span><span class="m">0</span> <span class="m">1</span>
                                     <span class="bp">:</span><span class="nv">Else</span>
                                         <span class="nv">outcome</span><span class="kd">â†</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2_n</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="o">+</span><span class="nv">p2_n</span><span class="sr">]</span>
                                     <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="nv">dirac_table</span><span class="sr">[</span><span class="nv">to_play</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="sr">]</span><span class="o">+</span><span class="kd">â†</span><span class="nv">outcome</span>
                             <span class="bp">:</span><span class="nv">EndFor</span>
                         <span class="bp">:</span><span class="nv">EndFor</span>
                     <span class="bp">:</span><span class="nv">EndFor</span>
                 <span class="bp">:</span><span class="nv">EndFor</span>
             <span class="bp">:</span><span class="nv">EndFor</span>
         <span class="bp">:</span><span class="nv">EndFor</span>
     <span class="bp">:</span><span class="nv">EndFor</span>
 <span class="bp">:</span><span class="nv">EndFor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tabulate_dirac_wins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span><span class="kd">â†</span><span class="kt">{</span><span class="nv">start1</span> <span class="nv">start2</span><span class="kd">â†</span><span class="bp">âµ</span> <span class="p">â‹„</span> <span class="o">âŒˆ</span><span class="na">/</span><span class="o">âŠƒ</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="nv">start1</span><span class="sr">;</span><span class="m">1</span><span class="sr">;</span><span class="nv">start2</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">â•PP</span><span class="kd">â†</span><span class="m">16</span>  <span class="c1">â big numbers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span> <span class="m">4</span> <span class="m">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">444356092776315
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span> <span class="m">8</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">116741133558209
</span></div></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>