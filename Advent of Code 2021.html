
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advent of Code 2021 - APL &#8212; My Jupyter Book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-2 bd-sidebar site-navigation show single-page" id="site-navigation">
    
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Advent of Code 2021.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Advent of Code 2021.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-1">
   Day 1
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-1">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-2">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-2">
   Day 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-3">
   Day 3
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-4">
   Day 4
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-5">
   Day 5
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-6">
   Day 6
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-7">
   Day 7
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-8">
   Day 8
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-9">
   Day 9
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-10">
   Day 10
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-11">
   Day 11
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-12">
   Day 12
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-13">
   Day 13
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-14">
   Day 14
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id25">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id26">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-15">
   Day 15
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id27">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id28">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-16">
   Day 16
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id29">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id30">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-17">
   Day 17
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id31">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id32">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-18">
   Day 18
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id34">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-19">
   Day 19
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id35">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-20">
   Day 20
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id37">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id38">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-21">
   Day 21
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id40">
     Part 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#day-22">
   Day 22
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id41">
     Part 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id42">
     Part 2
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="advent-of-code-2021-apl">
<h1>Advent of Code 2021 - APL<a class="headerlink" href="#advent-of-code-2021-apl" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://adventofcode.com/">Advent of Code</a> is a daily programming puzzle
challenge published each December. The puzzles are pretty easy for experienced
programmers, so they’re a great way to play around with new programming
languages and tools. This year I’m trying out
<a class="reference external" href="https://en.wikipedia.org/wiki/APL_(programming_language)">APL</a>, a famously
terse array language from the 60s. You may have seen its memeable program for
<a class="reference external" href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway’s game of life</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">gol</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">≢⍸</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">∊</span><span class="na">¨</span><span class="m">3</span><span class="o">+</span><span class="m">0</span><span class="o">,</span><span class="na">¨</span><span class="o">⊢</span> <span class="c1">⍝ Generate the next generation 🤯</span>
</pre></div>
</div>
</div>
</div>
<p>A few people expressed interest, so about halfway through December I decided
to try publishing a Jupyter notebook with my solutions in literate programming
fashion. Caveat that I’m a complete APL newb so some of my answers may be
really bad/ugly! But I’m having fun. After a few weeks, the funny symbols are
starting to make some sense, and I’m contemplating buying a special keyboard…</p>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.dyalog.com/">Dyalog</a> seems to be the APL that most people use.
Some good online resources are <a class="reference external" href="https://aplcart.info/">APLcart</a>,
<a class="reference external" href="https://xpqz.github.io/learnapl/">Learning APL</a>, and
<a class="reference external" href="https://mastering.dyalog.com/README.html">Mastering Dyalog APL</a>.</p>
<p>A few days in, YouTube’s algorithm told me about another crazy person solving
AoC in APL! <a class="reference external" href="https://www.youtube.com/c/codereport">code_report</a> seems to be much
better at it and for the first few days, I compared notes with their videos
and learned a ton.</p>
</div>
<div class="section" id="day-1">
<h2>Day 1<a class="headerlink" href="#day-1" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/1">Puzzle link</a></p>
<div class="section" id="part-1">
<h3>Part 1<a class="headerlink" href="#part-1" title="Permalink to this headline">¶</a></h3>
<p>Today we’re just supposed to count increasing numbers in a list, which takes
all of 5 characters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test1</span><span class="kd">←</span><span class="m">199</span> <span class="m">200</span> <span class="m">208</span> <span class="m">210</span> <span class="m">200</span> <span class="m">207</span> <span class="m">240</span> <span class="m">269</span> <span class="m">260</span> <span class="m">263</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="nv">test1</span> <span class="c1">⍝ reduce test1 pairwise on &lt; then sum the resulting boolean array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<p>Note that APL is read right to left. The parser is really, really basic, and
I keep shooting myself in the foot by forgetting parentheses.</p>
<p>The pinacle of APL style is “tacit” programming involving just “trains” of
functions and operators smushed together with no explicit arguments. We can
store and reuse the solution for day 1, part 1, thusly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="o">⊢</span> <span class="c1">⍝ the ⊢ means &quot;I&#39;m with stupid&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span> <span class="nv">test1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7
</span></div></div>
</div>
<p>Reading stuff from a file took embarrasingly long to figure out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data1</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day1-input.txt&#39;</span> <span class="m">1</span> <span class="c1">⍝ read lines and eval each one turning strings to numbers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_1</span> <span class="nv">data1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1390
</span></div></div>
</div>
</div>
<div class="section" id="part-2">
<h3>Part 2<a class="headerlink" href="#part-2" title="Permalink to this headline">¶</a></h3>
<p>Instead we need to sum every three adjacent elements and then count increases,
which takes a whole 8 characters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="nv">test1</span> <span class="c1">⍝ reduce test1 on 3-wise sums, pairwise compare, and sum increases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_2</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="m">2</span><span class="o">&lt;</span><span class="na">/</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="o">⊢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day1_2</span> <span class="nv">data1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1457
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-2">
<h2>Day 2<a class="headerlink" href="#day-2" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/2">Puzzle link</a></p>
<p>Today we have to deal with words to drive a submarine around. APL strings are
(predictably) just arrays, and there don’t seem to be special string libraries.
So let’s turn this all into numbers to simplify life.</p>
<p>We’ll use a “dfn” i.e. a function to parse lines. The dfn grammar is powerful
enough that once you understand it, you can basically use APL as a terrible
functional language.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_sub_command</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ converts a command like &#39;forward 5&#39; into two numbers</span>
  <span class="nv">dir</span> <span class="nv">delta</span><span class="kd">←</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="bp">⍵</span>      <span class="c1">⍝ split on space (i.e. partition on not-equal &#39; &#39;)</span>
  <span class="nv">dir</span><span class="o">≡</span><span class="s1">&#39;forward&#39;</span><span class="bp">:</span><span class="p">(</span><span class="o">⍎</span><span class="nv">delta</span><span class="p">)</span><span class="m">0</span>  <span class="c1">⍝ &#39;forward x&#39;: x 0</span>
  <span class="nv">dir</span><span class="o">≡</span><span class="s1">&#39;down&#39;</span><span class="bp">:</span><span class="m">0</span><span class="p">(</span><span class="o">⍎</span><span class="nv">delta</span><span class="p">)</span>     <span class="c1">⍝ &#39;down x&#39;: 0 x</span>
  <span class="m">0</span><span class="p">(</span><span class="o">-⍎</span><span class="nv">delta</span><span class="p">)</span>               <span class="c1">⍝ &#39;up x&#39;: 0 -x</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test2</span><span class="kd">←</span><span class="nv">parse_sub_command</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day2-test.txt&#39;</span> <span class="m">1</span> <span class="c1">⍝ map parser over lines</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬────┬───┬───┐
│5 0│0 5│8 0│0 ¯3│0 8│2 0│
└───┴───┴───┴────┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data2</span><span class="kd">←</span><span class="nv">parse_sub_command</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day2-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Part 1<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>First we’re supposed to move the sub, then return its position times its
depth to prove we parsed the commands ok. We can just add up our tuples
then multiply the components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span><span class="kd">←</span><span class="o">×</span><span class="na">/∘</span><span class="o">↑</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">⊢</span><span class="p">)</span> <span class="c1">⍝ sum reduce, unbox, then multiply</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">150
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_1</span> <span class="nv">data2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1938402
</span></div></div>
</div>
</div>
<div class="section" id="id2">
<h3>Part 2<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>jk actually there’s another state variable aim. We can make this variable
explicit using a scan which is a reduce that gives you partial answers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="m">2</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">test2</span> <span class="c1">⍝ + scan over seconds of test2 (i.e. up/down amounts)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 5 5 2 10 10
</span></div></div>
</div>
<p>So to get depth we multiply aim by the X for forward commands, then sum.
Horizontal pos is just the sum of the firsts as before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">⊃</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">×+</span><span class="na">/</span><span class="p">(</span><span class="o">+</span><span class="na">\</span><span class="m">2</span><span class="o">⊃</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="o">⊃</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span> <span class="c1">⍝ sum aim×X, then multiply horizontal pos</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">900
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">data2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1947878632
</span></div></div>
</div>
<p>If you wanted you could probably trim some characters and write this tacitly
but it’s already needlessly obtuse imo, and reads better with some names for
things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day2_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">forward</span> <span class="nv">up_down</span><span class="kd">←</span><span class="o">↓⍉↑</span><span class="bp">⍵</span> <span class="c1">⍝ forward is firsts, up_down is seconds </span>
  <span class="nv">aim</span><span class="kd">←</span><span class="o">+</span><span class="na">\</span><span class="nv">up_down</span>        <span class="c1">⍝ aim is sum of ups and downs</span>
  <span class="nv">depth</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="nv">aim</span><span class="o">×</span><span class="nv">forward</span>  <span class="c1">⍝ depths are sum of aim times forward</span>
  <span class="nv">pos</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="nv">forward</span>        <span class="c1">⍝ pos is sum of forward</span>
  <span class="nv">depth</span><span class="o">×</span><span class="nv">pos</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day2_2</span> <span class="nv">test2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">900
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-3">
<h2>Day 3<a class="headerlink" href="#day-3" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/3">Puzzle link</a></p>
<p>Today our data is a list of binary numbers we need to look at bitwise,
so we’ll want that as a bit matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test3</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day3-test.txt&#39;</span> <span class="m">1</span> <span class="c1">⍝ mix (unbox as rows) eval&#39;d digits from lines</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 1 0 0
1 1 1 1 0
1 0 1 1 0
1 0 1 1 1
1 0 1 0 1
0 1 1 1 1
0 0 1 1 1
1 1 1 0 0
1 0 0 0 0
1 1 0 0 1
0 0 0 1 0
0 1 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data3</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day3-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Part 1<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>We’re supposed to form two binary numbers by taking the most and least
commmon bits each in each position. We can sum bits in each column to
find the most common bit, e.g.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="o">≢</span><span class="nv">test3</span><span class="p">)</span><span class="o">&lt;+</span><span class="na">⌿</span><span class="nv">test3</span> <span class="c1">⍝ bit mask where 6 &lt; column sums of test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 0
</span></div></div>
</div>
<p>APL has fancy operators for base conversion too so this can be smushed
into another ridiculous one liner. It could even probably be <em>more</em> condensed,
in case it’s already too readable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span><span class="kd">←</span><span class="m">2</span><span class="o">⊥</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">&lt;+</span><span class="na">⌿</span><span class="p">)</span><span class="o">×</span><span class="m">2</span><span class="o">⊥</span><span class="p">(</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">&gt;+</span><span class="na">⌿</span>  <span class="c1">⍝ sorry</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span> <span class="nv">test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">198
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_1</span> <span class="nv">data3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3429254
</span></div></div>
</div>
</div>
<div class="section" id="id4">
<h3>Part 2<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Now we gotta find a row in our bit matrix, by taking only rows with the majority
bit in the first position, then from those only rows with the majority bit in
the second position, and so on until we only have one row left. This requires
iteratively filtering a set of things which, unsurprisingly, we can do in one
line of terrible code. (Sorry.)</p>
<p>Finding the majority bit in the leftmost position is easy. Using ≤ means that
when there are an equal number of 0s and 1s we prefer 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="nv">test3</span>  <span class="c1">⍝ take first from bit mask where 6 ≤ column sums</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Here is one way to get the first (leftmost) bit of each row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊣</span><span class="na">/</span><span class="nv">test3</span>  <span class="c1">⍝ i.e. first column</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1 1 1 0 0 1 1 1 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="nv">test3</span>  <span class="c1">⍝ bit mask of rows matching majority bit...</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 1 1 1 0 0 1 1 1 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="nv">test3</span><span class="p">)</span><span class="na">⌿</span><span class="nv">test3</span>  <span class="c1">⍝ select just the matching rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 0
1 0 1 1 0
1 0 1 1 1
1 0 1 0 1
1 1 1 0 0
1 0 0 0 0
1 1 0 0 1
</span></div></div>
</div>
<p>Now we just need to rotate the masks and then iterate this n times
where n is the number of bits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">⌽</span><span class="p">((</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="nv">test3</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="nv">test3</span><span class="p">)</span><span class="na">⌿</span><span class="nv">test3</span>  <span class="c1">⍝ rotate left</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 1
0 1 1 0 1
0 1 1 1 1
0 1 0 1 1
1 1 0 0 1
0 0 0 0 1
1 0 0 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">⌽</span><span class="p">((</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="m">5</span><span class="p">)</span><span class="nv">test3</span>  <span class="c1">⍝ star dot means do 5 times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 1
</span></div></div>
</div>
<p>This idea almost works, except we have to deal with the case where there is
just one match left. Then we need to keep it for the next iteration whether or
not its current bit is 1 (the tiebreaker). Also, our result will actually be a
2d matrix with one row; the , operator converts it back down to a vector.</p>
<p>Now we can do this again for the minority bits and then convert to decimal
and multiply to get the answer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">o2_rating</span><span class="kd">←</span><span class="o">,</span><span class="kt">{</span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">⌽</span><span class="p">(((</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">≤+</span><span class="na">⌿</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∨</span><span class="p">((</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="p">(</span><span class="m">2</span><span class="o">⊃⍴</span><span class="bp">⍵</span><span class="p">))</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">co2_rating</span><span class="kd">←</span><span class="o">,</span><span class="kt">{</span><span class="p">(</span><span class="kt">{</span><span class="m">1</span><span class="o">⌽</span><span class="p">(((</span><span class="o">⊃</span><span class="p">((</span><span class="m">2</span><span class="o">÷</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢⊢</span><span class="p">))</span><span class="o">&gt;+</span><span class="na">⌿</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=⊣</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∨</span><span class="p">((</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="p">(</span><span class="m">2</span><span class="o">⊃⍴</span><span class="bp">⍵</span><span class="p">))</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span><span class="kd">←</span><span class="m">2</span><span class="o">⊥</span><span class="nv">o2_rating</span><span class="o">×</span><span class="m">2</span><span class="o">⊥</span><span class="nv">co2_rating</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span> <span class="nv">test3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">230
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day3_2</span> <span class="nv">data3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5410338
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-4">
<h2>Day 4<a class="headerlink" href="#day-4" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/4">Puzzle link</a></p>
<p>We’re playing bingo today. Calls are on the first input line, and
cards follow separated by blank lines. Rather than try to parse this
into one array and unbox it again later, we’ll just split it out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test4_calls</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day4-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 4 9 5 11 17 23 2 0 14 21 24 10 16 13 6 15 25 12 22 18 20 8 19 3 26 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test4_cards</span><span class="kd">←</span><span class="o">↑↑⍎</span><span class="na">¨¨</span><span class="kt">{</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="o">≢⊢</span><span class="p">)</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊆</span><span class="bp">⍵</span><span class="kt">}</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day4-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">22 13 17 11  0
 8  2 23  4 24
21  9 14 16  7
 6 10  3 18  5
 1 12 20 15 19

 3 15  0  2 22
 9 18 13 17  5
19  8  7 25 23
20 11 10 24  4
14 21 16 12  6

14 21 17 24  4
10 16 15  9 19
18  8 23 26 20
22 11 13  6  5
 2  0 12  3  7
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data4_calls</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day4-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data4_cards</span><span class="kd">←</span><span class="o">↑↑⍎</span><span class="na">¨¨</span><span class="kt">{</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="o">≢⊢</span><span class="p">)</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊆</span><span class="bp">⍵</span><span class="kt">}</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day4-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll be using 5x5 bit matrices to match called positions.
In this variant of bingo, diagonals don’t count, so we just need
to sum up 1s in each row and column to detect bingos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">bingo</span><span class="kd">←</span><span class="o">∨</span><span class="na">/</span><span class="m">5</span><span class="o">=</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="o">⊢</span><span class="p">)</span><span class="o">,+</span><span class="na">⌿</span><span class="p">)</span>  <span class="c1">⍝ or over boolean 5 = row sums cat col sums</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Part 1<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>We compute bit matrices of marked numbers for each prefix of calls.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="o">↑,</span><span class="na">\</span><span class="nv">test4_calls</span>  <span class="c1">⍝ e.g. scan cat to get prefixes of calls (5 shown for example)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬───┬─────┬───────┬──────────┐
│7│7 4│7 4 9│7 4 9 5│7 4 9 5 11│
└─┴───┴─────┴───────┴──────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">⌿</span><span class="m">7</span> <span class="m">4</span> <span class="m">9</span><span class="na">∘.</span><span class="o">⍷</span><span class="nv">test4_cards</span>  <span class="c1">⍝ e.g. sum ⍷ to mark positions of 7 4 9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0
0 0 0 1 0
0 1 0 0 1
0 0 0 0 0
0 0 0 0 0

0 0 0 0 0
1 0 0 0 0
0 0 1 0 0
0 0 0 0 1
0 0 0 0 0

0 0 0 0 1
0 0 0 1 0
0 0 0 0 0
0 0 0 0 0
0 0 0 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test4_game</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="p">(</span><span class="m">¯1</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘.</span><span class="o">⍷</span><span class="nv">test4_cards</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">,</span><span class="na">\</span><span class="nv">test4_calls</span>  <span class="c1">⍝ mark cards for each call prefix</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can find the first bingo round and board.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="m">1</span><span class="p">(</span><span class="o">⍸⍷</span><span class="p">)</span><span class="o">↑</span><span class="p">((</span><span class="nv">bingo</span><span class="na">⍤</span><span class="m">2</span><span class="p">)</span><span class="na">¨</span><span class="nv">test4_game</span><span class="p">)</span>  <span class="c1">⍝ bingo over 2nd axis submatrices, find first one</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12 3
</span></div></div>
</div>
<p>Probably this could all go in some kind of horrible one liner but instead
I will put it into a dfn with names and things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day4_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">cards</span> <span class="nv">calls</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">game</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="p">(</span><span class="m">¯1</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘.</span><span class="o">⍷</span><span class="nv">cards</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">,</span><span class="na">\</span><span class="nv">calls</span>   <span class="c1">⍝ bit matrices for each prefix of calls </span>
  <span class="nv">round</span> <span class="nv">card</span><span class="kd">←</span><span class="o">⊃</span><span class="m">1</span><span class="p">(</span><span class="o">⍸⍷</span><span class="p">)</span><span class="o">↑</span><span class="p">((</span><span class="nv">bingo</span><span class="na">⍤</span><span class="m">2</span><span class="p">)</span><span class="na">¨</span><span class="nv">game</span><span class="p">)</span>  <span class="c1">⍝ round and card of first bingo</span>
  <span class="c1">⍝ score is winning call times sum of uncalled numbers on winning card</span>
  <span class="p">(</span><span class="nv">round</span><span class="o">⌷</span><span class="nv">calls</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">~</span><span class="nv">card</span><span class="o">⌷↑</span><span class="nv">round</span><span class="o">⌷</span><span class="nv">game</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="nv">card</span><span class="o">⌷</span><span class="nv">cards</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_1</span> <span class="nv">test4_cards</span> <span class="nv">test4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4512
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_1</span> <span class="nv">data4_cards</span> <span class="nv">data4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">63424
</span></div></div>
</div>
</div>
<div class="section" id="id6">
<h3>Part 2<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Now we need to cheat instead and find the last winning card.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day4_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">cards</span> <span class="nv">calls</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">game</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">+</span><span class="na">⌿</span><span class="p">(</span><span class="m">¯1</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘.</span><span class="o">⍷</span><span class="nv">cards</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">,</span><span class="na">\</span><span class="nv">calls</span>
  <span class="c1">⍝ last card to win and round in which it wins</span>
  <span class="c1">⍝ (sum 1s for each non-winning row of col per card)</span>
  <span class="nv">round</span> <span class="nv">card</span><span class="kd">←</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="o">,⊢⍳⌈</span><span class="na">/</span><span class="p">)</span><span class="m">1</span><span class="o">++</span><span class="na">⌿</span><span class="o">~↑</span><span class="p">((</span><span class="nv">bingo</span><span class="na">⍤</span><span class="m">2</span><span class="p">)</span><span class="na">¨</span><span class="nv">game</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">round</span><span class="o">⌷</span><span class="nv">calls</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">~</span><span class="nv">card</span><span class="o">⌷↑</span><span class="nv">round</span><span class="o">⌷</span><span class="nv">game</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="nv">card</span><span class="o">⌷</span><span class="nv">cards</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_2</span> <span class="nv">test4_cards</span> <span class="nv">test4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1924
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day4_2</span> <span class="nv">data4_cards</span> <span class="nv">data4_calls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23541
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-5">
<h2>Day 5<a class="headerlink" href="#day-5" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/5">Puzzle link</a></p>
<p>Today we get to plot lines. Splitting on ‘,’ and ‘ -&gt; ‘ is a little
different since usually we split on one character; ∊ gives an
array with 1s for delimiter chars ~ flips it for partition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test5</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="kt">{</span><span class="s1">&#39;, -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">⍤</span><span class="o">∊</span><span class="na">⍨</span><span class="o">⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day5-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 9 5 9
8 0 0 8
9 4 3 4
2 2 2 1
7 0 7 4
6 4 2 0
0 9 2 9
3 4 1 4
0 0 8 8
5 5 8 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data5</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="kt">{</span><span class="s1">&#39;, -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">⍤</span><span class="o">∊</span><span class="na">⍨</span><span class="o">⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day5-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>Part 1<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>We are supposed to consider just horizontal or vertical lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">h_or_v</span><span class="kd">←</span><span class="kt">{</span><span class="p">((</span><span class="m">1</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="m">3</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">))</span><span class="o">∨</span><span class="p">((</span><span class="m">2</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="m">4</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span>  <span class="c1">⍝ same x or y</span>
</pre></div>
</div>
</div>
</div>
<p>To find all the intersections we’ll just plot them all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day5_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ counts overlapping points for horizontal and vertical lines only </span>
  <span class="nv">grid</span><span class="kd">←</span><span class="m">1000</span> <span class="m">1000</span><span class="o">⍴</span><span class="m">0</span>
  <span class="nv">plot_hv</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ plots a horizontal or vertical line in grid</span>
    <span class="nv">line</span><span class="kd">←</span><span class="bp">⍵</span>                  <span class="c1">⍝ x1 y1 x2 y2</span>
    <span class="nv">p1</span><span class="kd">←</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span><span class="o">⌊</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>  <span class="c1">⍝ p1 is lower leftmost</span>
    <span class="nv">p2</span><span class="kd">←</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span><span class="o">⌈</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>  <span class="c1">⍝ p2 is upper rightmost</span>
    <span class="nv">pts</span><span class="kd">←</span><span class="p">(</span><span class="o">,⍳</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">))</span><span class="o">+</span><span class="na">¨</span><span class="o">⊂</span><span class="nv">p1</span>  <span class="c1">⍝ indices from p1 to p2 inclusive</span>
    <span class="nv">grid</span><span class="sr">[</span><span class="nv">pts</span><span class="sr">]</span><span class="o">+</span><span class="kd">←</span><span class="m">1</span>            <span class="c1">⍝ plot the points</span>
    <span class="no">⍬</span>
  <span class="kt">}</span>
  <span class="nv">hv</span><span class="kd">←</span><span class="p">((</span><span class="nv">h_or_v</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="na">⌿</span><span class="bp">⍵</span>  <span class="c1">⍝ reduce lines over h_or_v on each row</span>
  <span class="nv">_</span><span class="kd">←</span><span class="nv">plot_hv</span><span class="na">¨</span><span class="o">↓</span><span class="nv">hv</span>       <span class="c1">⍝ plot the lines</span>
  <span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">)</span><span class="nv">grid</span><span class="o">≥</span><span class="m">2</span>         <span class="c1">⍝ sum where grid ≥ 2</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_1</span> <span class="nv">test5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_1</span> <span class="nv">data5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4655
</span></div></div>
</div>
</div>
<div class="section" id="id8">
<h3>Part 2<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Now we are supposed to consider all the lines. This is actually a
little easier. The trickiest bit is just generating the plot indices.
The key idea is that ×p2-p1 is a unit vector from p1 to p2 (scalar ×
is the sign function).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day5_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ counts overlapping points for horizontal, vertical, and diagonal lines</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="m">1000</span> <span class="m">1000</span><span class="o">⍴</span><span class="m">0</span>
  <span class="nv">plot</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ plots a line in the grid</span>
    <span class="nv">line</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">p1</span><span class="kd">←</span><span class="nv">line</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span>
    <span class="nv">p2</span><span class="kd">←</span><span class="nv">line</span><span class="sr">[</span><span class="m">3</span> <span class="m">4</span><span class="sr">]</span>
    <span class="c1">⍝ iota length times unit vector</span>
    <span class="nv">ds</span><span class="kd">←</span><span class="p">((</span><span class="o">⍳</span><span class="p">(</span><span class="m">1</span><span class="o">+⌈</span><span class="na">/</span><span class="o">|</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">))</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="na">∘.</span><span class="o">×</span><span class="p">(</span><span class="o">×</span><span class="nv">p2</span><span class="o">-</span><span class="nv">p1</span><span class="p">)</span>
    <span class="nv">pts</span><span class="kd">←</span><span class="nv">ds</span><span class="o">+</span><span class="p">((</span><span class="o">⍴</span><span class="nv">ds</span><span class="p">)</span><span class="o">⍴</span><span class="p">(</span><span class="m">1</span> <span class="m">1</span><span class="o">+</span><span class="nv">p1</span><span class="p">))</span>  <span class="c1">⍝ add back p1</span>
    <span class="nv">grid</span><span class="sr">[</span><span class="o">↓</span><span class="nv">pts</span><span class="sr">]</span><span class="o">+</span><span class="kd">←</span><span class="m">1</span>
    <span class="no">⍬</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">←</span><span class="nv">plot</span><span class="na">¨</span><span class="o">↓</span><span class="bp">⍵</span>   <span class="c1">⍝ plot the lines</span>
  <span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">)</span><span class="nv">grid</span><span class="o">≥</span><span class="m">2</span> <span class="c1">⍝ sum where grid ≥ 2</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_2</span> <span class="nv">test5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day5_2</span> <span class="nv">data5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20500
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-6">
<h2>Day 6<a class="headerlink" href="#day-6" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/6">Puzzle link</a></p>
<p>Today we have to simulate fish reproduction. Great.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test6</span><span class="kd">←</span><span class="m">3</span> <span class="m">4</span> <span class="m">3</span> <span class="m">1</span> <span class="m">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data6</span><span class="kd">←</span><span class="o">⊃⍎</span><span class="na">¨¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day6-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Part 1<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>For small numbers of fish this is just a one liner. We concatenate
new 8s for each 0, replace 0s with 7s, and decrement everything so
really 0s become 6s. The starfish operator iterates (appropriately).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span><span class="kd">←</span><span class="o">≢</span><span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="m">7</span><span class="o">×</span><span class="p">(</span><span class="m">0</span><span class="o">=</span><span class="bp">⍵</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="bp">⍵</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="o">,</span><span class="kt">{</span><span class="m">8</span><span class="o">+</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="p">(</span><span class="m">0</span><span class="na">∘</span><span class="o">=</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="p">)</span><span class="na">⍣</span><span class="m">80</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span> <span class="nv">test6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5934
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day6_1</span> <span class="nv">data6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">377263
</span></div></div>
</div>
</div>
<div class="section" id="id10">
<h3>Part 2<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>All right, 256 days is too many to cheese this. We will keep a census
of fish in the population instead of storing one number per fish.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day6_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ (n day6_2 fish) returns population size after n generations</span>
  <span class="nv">n</span><span class="kd">←</span><span class="bp">⍺</span>
  <span class="nv">census</span><span class="kd">←</span><span class="m">9</span><span class="o">⍴</span><span class="m">0</span>     <span class="c1">⍝ init to zero of each age</span>
  <span class="nv">census</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span><span class="sr">]</span><span class="o">+</span><span class="kd">←</span><span class="m">1</span> <span class="c1">⍝ add 1 to count of age for each fish</span>
  <span class="c1">⍝ 1⊖ rotates the current ages down 1</span>
  <span class="nv">generation</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">⊖</span><span class="bp">⍵</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="o">,</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="o">,</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span>
  <span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">generation</span><span class="na">⍣</span><span class="nv">n</span><span class="p">)</span><span class="nv">census</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕PP</span><span class="kd">←</span><span class="m">16</span>  <span class="c1">⍝ we need more precision, apparently</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">256</span> <span class="nv">day6_2</span> <span class="nv">test6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26984457539
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">256</span> <span class="nv">day6_2</span> <span class="nv">data6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1695929023803
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-7">
<h2>Day 7<a class="headerlink" href="#day-7" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/7">Puzzle link</a></p>
<p>Something with crabs. I can’t even with this today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test7</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day7-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16 1 2 0 4 2 7 1 2 14
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data7</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day7-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h3>Part 1<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Find the minimum fuel cost for all crabs to align. It makes no sense
to move away from all the other crabs so this will clearly occur at a
point inside the convex hull of the crabs.</p>
<p>For part 1 this should occur at some crab’s current position. Consider
a non-crab position with M crabs to the left and N crabs to the right,
where the nearest crab in either direction is m or n units away.
Choosing the nearest left crab’s position instead would reduce cost by
δ=(M-N)m; right would reduce by δ=(N-M)n. m&gt;0, n&gt;0, and either M-N≥0 or
N-M≥0 or both so this is the same or better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span><span class="kd">←</span><span class="kt">{</span><span class="nv">v</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="o">⌊</span><span class="na">/</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">|</span><span class="bp">⍵</span><span class="o">-</span><span class="na">⍨</span><span class="nv">v</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">v</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span> <span class="nv">test7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">37
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_1</span> <span class="nv">data7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">357353
</span></div></div>
</div>
</div>
<div class="section" id="id12">
<h3>Part 2<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The new cost function uses triangular numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tri</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="bp">⍵</span><span class="o">×</span><span class="p">(</span><span class="bp">⍵</span><span class="o">+</span><span class="m">1</span><span class="p">))</span><span class="o">÷</span><span class="m">2</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>The minimum fuel cost isn’t at some crab’s current position anymore.
For example, now it costs 1+1 for x=0 and x=2 to meet at x=1, but it
would cost 1+2 for them to meet at x=0 or x=2. But the minimum is
still in the convex hull, so just search over the whole range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span><span class="kd">←</span><span class="kt">{</span><span class="nv">v</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="o">⌊</span><span class="na">/</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="nv">tri</span><span class="p">(</span><span class="o">|</span><span class="bp">⍵</span><span class="o">-</span><span class="nv">v</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳⌈</span><span class="na">/</span><span class="nv">v</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span> <span class="nv">test7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">168
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day7_2</span> <span class="nv">data7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">104822130
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-8">
<h2>Day 8<a class="headerlink" href="#day-8" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/8">Puzzle link</a></p>
<p>We’re sorting out really specifically mangled wiring today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test8</span><span class="kd">←</span><span class="o">↑</span><span class="s1">&#39;|&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day8-test.txt&#39;</span> <span class="m">1</span>  <span class="c1">⍝ extra spaces are ok</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────────────────────────────────────────────────┬──────────────────
│be cfbegad cbdgef fgaecd cgeb fdcge agebfd fecdb fabcd edb │ fdgacbe cefdb cef
├───────────────────────────────────────────────────────────┼──────────────────
│edbfga begcd cbg gc gcadebf fbgde acbgfd abcde gfcbed gfec │ fcgedb cgb dgebac
├───────────────────────────────────────────────────────────┼──────────────────
│fgaebd cg bdaec gdafb agbcfd gdcbef bgcad gfac gcb cdgabef │ cg cg fdcagb cbg 
├───────────────────────────────────────────────────────────┼──────────────────
│fbegcd cbd adcefb dageb afcb bc aefdc ecdab fgdeca fcdbega │ efabcd cedba gadf
├───────────────────────────────────────────────────────────┼──────────────────
│aecbfdg fbg gf bafeg dbefa fcge gcbea fcaegb dgceab fcbdga │ gecf egdcabf bgf 
├───────────────────────────────────────────────────────────┼──────────────────
│fgeab ca afcebg bdacfeg cfaedg gcfdb baec bfadeg bafgc acf │ gebdcfa ecba ca f
├───────────────────────────────────────────────────────────┼──────────────────
│dbcfg fgd bdegcaf fgec aegbdf ecdfab fbedc dacgb gdcebf gf │ cefg dcbef fcge g
├───────────────────────────────────────────────────────────┼──────────────────
│bdfegc cbegaf gecbf dfcage bdacg ed bedf ced adcbefg gebcd │ ed bcgafe cdgba c
├───────────────────────────────────────────────────────────┼──────────────────
│egadfb cdbfeg cegd fecab cgb gbdefca cg fgcdab egfdb bfceg │ gbdfcae bgc cg cg
├───────────────────────────────────────────────────────────┼──────────────────
│gcafb gcf dcaebfg ecagb gf abcdeg gaef cafbge fdbac fegbdc │ fgae cfgab fg bag
└───────────────────────────────────────────────────────────┴──────────────────

      ────────┐
      bgd gcbe│
      ────────┤
      f gc    │
      ────────┤
              │
      ────────┤
      ec cb   │
      ────────┤
      bfgea   │
      ────────┤
      adegcb  │
      ────────┤
      bcadfe  │
      ────────┤
      bgef    │
      ────────┤
      b       │
      ────────┤
      ce      │
      ────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data8</span><span class="kd">←</span><span class="o">↑</span><span class="s1">&#39;|&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day8-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>In theory one could probably do this with boolean algebra and logic.  But
we are absolutely going to cheese this instead, so will be needing a way to
generate permutations. I got this from APLcart. Instead of thinking about
fancy lightbulbs, let’s think about how it works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⍳</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="na">⍣</span><span class="bp">⍵</span><span class="o">⍉⍪</span><span class="no">⍬</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>It is iterating something ⍵ times on ⍳⍵ and ⍉⍪⍬. That something is ,[⍳2](⊢,⍤1 0~).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  ┌──┴──┐  
  [1·2] ⍤  
┌─┘   ┌─┴─┐
,   ┌─┼─┐ 1
    ⊢ ⍤ ~  
     ┌┴┐   
     , 1 0 
</span></div></div>
</div>
<p>,⍤1 0 pairs the left vector with each element from the right; (⊢(,⍤1 0)~) instead pairs the right vector with each element from the left less those from the right.  ,[⍳2] is catenate with an axis specification [1 2] presumably to put things into rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">d8p1</span><span class="kd">←</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="o">⍉⍪</span><span class="no">⍬</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
2
3
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">d8p2</span><span class="kd">←</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="nv">d8p1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2
1 3
2 1
2 3
3 1
3 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">(</span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="nv">d8p2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 2 3
1 3 2
2 1 3
2 3 1
3 1 2
3 2 1
</span></div></div>
</div>
<p>So this is iteratively catenating new rows with each element of ⍳3 not in the left. Kinda mind blowing.</p>
<div class="section" id="id13">
<h3>Part 1<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>For part 1 we are just supposed to count up strings of certain lengths…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">7</span><span class="p">)</span><span class="o">∊</span><span class="na">⍨</span><span class="o">≢</span><span class="na">¨</span><span class="o">,↑</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="p">(</span><span class="m">1</span><span class="na">∘</span><span class="o">↓</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span> <span class="nv">test8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_1</span> <span class="nv">data8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">470
</span></div></div>
</div>
</div>
<div class="section" id="id14">
<h3>Part 2<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Now we have to figure out what’s up with the wiring. We first define the
canonical set of segments for each digit from 0 to 9.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">digits</span><span class="kd">←</span><span class="s1">&#39;abcefg&#39;</span> <span class="s1">&#39;cf&#39;</span> <span class="s1">&#39;acdeg&#39;</span> <span class="s1">&#39;acdfg&#39;</span> <span class="s1">&#39;bcdf&#39;</span> <span class="s1">&#39;abdfg&#39;</span> <span class="s1">&#39;abdefg&#39;</span> <span class="s1">&#39;acf&#39;</span> <span class="s1">&#39;abcdefg&#39;</span> <span class="s1">&#39;abcdfg&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We will also need a helper which translates corresponding values from one array to another, also from APLcart.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">translate</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺⍺</span><span class="p">(</span><span class="bp">⍵⍵</span><span class="o">⌷</span><span class="na">⍨∘</span><span class="o">⊂⍳</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="o">∊</span><span class="na">∘</span><span class="bp">⍺⍺</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;12345&#39;</span><span class="nv">translate</span><span class="s1">&#39;abcde&#39;</span><span class="p">)</span><span class="s1">&#39;52341&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">ebcda
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations_of_length_7</span><span class="kd">←</span><span class="nv">permutations</span> <span class="m">7</span>
</pre></div>
</div>
</div>
</div>
<p>To decode the scrambled up displays, we will just try all 5040 permutations
on the scrambled digit set until we get the canonical digit set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">decode_display</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">patterns</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍋</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃</span><span class="p">(</span><span class="m">1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span>  <span class="c1">⍝ scrambled segment sets for each digit</span>
  <span class="nv">readout</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍋</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="o">⊃</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span>   <span class="c1">⍝ segment sets we are supposed to decode</span>
  <span class="nv">trial</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">assignment</span><span class="kd">←</span><span class="s1">&#39;abcdefg&#39;</span><span class="sr">[</span><span class="o">⊃</span><span class="bp">⍵</span><span class="sr">]</span>  <span class="c1">⍝ segment permutation to assume</span>
    <span class="c1">⍝ find index of each remapped pattern in canonical digits</span>
    <span class="nv">code</span><span class="kd">←</span><span class="nv">digits</span><span class="o">⍳</span><span class="p">(</span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍋</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="p">(</span><span class="nv">assignment</span> <span class="nv">translate</span><span class="s1">&#39;abcdefg&#39;</span><span class="p">)</span><span class="na">¨</span><span class="nv">patterns</span><span class="p">)</span>
    <span class="c1">⍝ if all digits found, decode the readout </span>
    <span class="p">(</span><span class="o">∧</span><span class="na">/</span><span class="nv">code</span><span class="o">≤</span><span class="m">10</span><span class="p">)</span><span class="bp">:</span><span class="m">10</span><span class="o">⊥</span><span class="nv">code</span><span class="sr">[</span><span class="nv">patterns</span><span class="o">⍳</span><span class="nv">readout</span><span class="sr">]</span><span class="o">-</span><span class="m">1</span>
    <span class="p">((</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="s1">&#39;error&#39;</span>
    <span class="bp">∇</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="nv">trial</span><span class="p">(</span><span class="o">↓</span><span class="nv">permutations_of_length_7</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="nv">decode_display</span><span class="na">¨</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span> <span class="nv">test8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">61229
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day8_2</span> <span class="nv">data8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">989396
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-9">
<h2>Day 9<a class="headerlink" href="#day-9" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/9">Puzzle link</a></p>
<p>Woo hoo, today looks really array-ish.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test9</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day9-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 1 9 9 9 4 3 2 1 0
3 9 8 7 8 9 4 9 2 1
9 8 5 6 7 8 9 8 9 2
8 7 6 7 8 9 6 7 8 9
9 8 9 9 9 6 5 6 7 8
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data9</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day9-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h3>Part 1<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>APL’s ⌺ operator lets us count in neighborhoods really easily.
Technically this problem doesn’t include diagonal neighbors but it
works anyways because of what we’re doing and I reaaallly wanna use
it, ok?</p>
<p>We find a bit matrix of all the 3x3s where the center element is
≤ all its neighbors, dropping those that are padding. Then get the
values at those indices and add 1 and sum reduce. Whee…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">∧</span><span class="na">/¨</span><span class="o">,</span><span class="na">¨</span><span class="p">(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="o">↓</span><span class="p">((</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">≤</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">⊢</span><span class="bp">⍵</span><span class="p">))</span><span class="sr">]</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span> <span class="nv">test9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">15
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_1</span> <span class="nv">data9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">545
</span></div></div>
</div>
</div>
<div class="section" id="id16">
<h3>Part 2<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>We have to count the sizes of connected regions in an array. Originally I just
solved this with a chesy flood fill, but I was hoping there would be a clever
morphological image processing way to do this.</p>
<p>The idea would be to build a bit matrix and have the 1s “flow” to
adjacent cells. But there’s ambiguity about which way they should flow. For
example, the test has an 8 surrounded by two 7s. The flow could “split”,
but then that’s nonlocal. So I guess I’ll stick with the flood fill.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">flood_fill</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">to_visit</span><span class="kd">←</span><span class="o">⊃</span><span class="m">1</span><span class="o">⌷</span><span class="bp">⍵</span>
  <span class="nv">visited</span><span class="kd">←</span><span class="o">⊃</span><span class="m">2</span><span class="o">⌷</span><span class="bp">⍵</span>
  <span class="nv">regions</span><span class="kd">←</span><span class="o">⊃</span><span class="m">3</span><span class="o">⌷</span><span class="bp">⍵</span>
  <span class="p">((</span><span class="o">≢</span><span class="nv">to_visit</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">visited</span>
  <span class="nv">next</span><span class="kd">←</span><span class="m">1</span><span class="o">↑</span><span class="nv">to_visit</span>
  <span class="nv">already_visited</span><span class="kd">←</span><span class="o">∨</span><span class="na">/</span><span class="o">∨</span><span class="na">/</span><span class="nv">next</span><span class="o">⍷</span><span class="nv">visited</span>
  <span class="nv">outside</span><span class="kd">←</span><span class="nv">next</span><span class="kt">{</span><span class="m">3</span><span class="bp">::</span><span class="m">1</span> <span class="p">⋄</span> <span class="m">0</span><span class="o">=</span><span class="p">((</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)</span><span class="o">⌷↑</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="nv">regions</span>
  <span class="p">(</span><span class="nv">already_visited</span><span class="o">∨</span><span class="nv">outside</span><span class="p">)</span><span class="bp">:∇</span><span class="p">((</span><span class="m">1</span><span class="o">↓</span><span class="nv">to_visit</span><span class="p">)</span><span class="nv">visited</span> <span class="nv">regions</span><span class="p">)</span>
  <span class="nv">nextp</span><span class="kd">←</span><span class="p">(</span><span class="nv">next</span><span class="o">+</span><span class="p">((</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">¯1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">¯1</span><span class="p">)))</span><span class="o">,</span><span class="m">1</span><span class="o">↓</span><span class="nv">to_visit</span>
  <span class="nv">visitedp</span><span class="kd">←</span><span class="nv">visited</span><span class="o">,</span><span class="nv">next</span>
  <span class="bp">∇</span><span class="p">(</span><span class="nv">nextp</span> <span class="nv">visitedp</span> <span class="nv">regions</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day9_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">sinks</span><span class="kd">←</span><span class="kt">{</span><span class="o">⍸</span><span class="p">(</span><span class="o">∧</span><span class="na">/¨</span><span class="o">,</span><span class="na">¨</span><span class="p">(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="o">↓</span><span class="p">((</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">≤</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">⊢</span><span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span><span class="bp">⍵</span>  <span class="c1">⍝ sink positions</span>
  <span class="nv">basins</span><span class="kd">←</span><span class="o">~</span><span class="m">9</span><span class="o">=</span><span class="bp">⍵</span>  <span class="c1">⍝ bitmask of basins</span>
  <span class="nv">region_size</span><span class="kd">←</span><span class="o">≢</span><span class="m">1</span><span class="o">↓</span><span class="kt">{</span><span class="nv">flood_fill</span><span class="p">(</span><span class="o">⊂</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">⊂</span><span class="no">⍬</span><span class="p">)(</span><span class="o">⊂</span><span class="nv">basins</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">sizes</span><span class="kd">←</span><span class="nv">region_size</span><span class="na">¨</span><span class="nv">sinks</span>
  <span class="o">×</span><span class="na">/</span><span class="nv">sizes</span><span class="sr">[</span><span class="m">3</span><span class="o">↑⍒</span><span class="nv">sizes</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_2</span> <span class="nv">test9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1134
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day9_2</span> <span class="nv">data9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">950600
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-10">
<h2>Day 10<a class="headerlink" href="#day-10" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/10">Puzzle link</a></p>
<p>Parsing stuff today. Not really APL’s strong suit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test10</span><span class="kd">←</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day10-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────────────────┬──────────────────────┬────────────────────────┬─────
│[({(&lt;(())[]&gt;[[{[]{&lt;()&lt;&gt;&gt;│[(()[&lt;&gt;])]({[&lt;{&lt;&lt;[]&gt;&gt;(│{([(&lt;{}[&lt;&gt;[]}&gt;{[]{[(&lt;()&gt;│(((({
└────────────────────────┴──────────────────────┴────────────────────────┴─────

      ──────────────────┬──────────────────────┬───────────────────────┬───────
      &lt;&gt;}&lt;{&lt;{&lt;&gt;}{[]{[]{}│[[&lt;[([]))&lt;([[{}[[()]]]│[{[{({}]{}}([{[{{{}}([]│{&lt;[[]]&gt;
      ──────────────────┴──────────────────────┴───────────────────────┴───────

      ────────────────┬──────────────────────┬──────────────────────┬──────────
      }&lt;{[{[{[]{()[[[]│[&lt;(&lt;(&lt;(&lt;{}))&gt;&lt;([]([]()│&lt;{([([[(&lt;&gt;()){}]&gt;(&lt;&lt;{{│&lt;{([{{}}[&lt;
      ────────────────┴──────────────────────┴──────────────────────┴──────────

      ──────────────┐
      [[[&lt;&gt;{}]]]&gt;[]]│
      ──────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data10</span><span class="kd">←</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day10-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>There’s nothing particularly hard here but Dyalog really liked to crash with
a mysterious error 139 a lot. So some of the code is a little awkward because
I kept modifying it not to break the interpreter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_chunks</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">expr</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">stack</span><span class="kd">←</span><span class="no">⍬</span>
  <span class="nv">next_char</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">i</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">i</span><span class="o">&gt;≢</span><span class="nv">expr</span><span class="bp">:</span><span class="m">0</span>
    <span class="nv">c</span><span class="kd">←</span><span class="nv">expr</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="c1">⍝ for opening chars, push the expected closing char</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;]&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;}&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;)&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;&gt;&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">c</span><span class="o">∊</span><span class="s1">&#39;[{(&lt;&#39;</span><span class="bp">:∇</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
    <span class="c1">⍝ for closing chars, check if they match</span>
    <span class="nv">match</span><span class="kd">←</span><span class="kt">{</span>
      <span class="nv">top</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">stack</span>
      <span class="nv">stack</span><span class="o">⊢</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">stack</span>
      <span class="nv">c</span><span class="o">=</span><span class="nv">top</span>
    <span class="kt">}</span><span class="m">0</span>
    <span class="nv">match</span><span class="bp">:∇</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">⍝ char matches keep going</span>
    <span class="c1">⍝ wrong closing char score it</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;)&#39;</span><span class="bp">:</span><span class="m">3</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="bp">:</span><span class="m">57</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;}&#39;</span><span class="bp">:</span><span class="m">1197</span>
    <span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="bp">:</span><span class="m">25137</span>
  <span class="kt">}</span>
  <span class="nv">next_char</span> <span class="m">1</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id17">
<h3>Part 1<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Score the mismatched closing chars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">parse_chunks</span><span class="na">¨</span><span class="o">⊢</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span> <span class="nv">test10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">26397
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_1</span> <span class="nv">data10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">343863
</span></div></div>
</div>
</div>
<div class="section" id="id18">
<h3>Part 2<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Now we need to add up the stack contents instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_chunks2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">expr</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">stack</span><span class="kd">←</span><span class="no">⍬</span>
  <span class="nv">next_char</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">i</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">i</span><span class="o">&gt;≢</span><span class="nv">expr</span><span class="bp">:</span><span class="m">0</span>
    <span class="nv">c</span><span class="kd">←</span><span class="nv">expr</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="c1">⍝ for opening chars, push the expected closing char</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;]&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;{&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;}&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;)&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="bp">:</span><span class="nv">stack</span><span class="o">,</span><span class="kd">←</span><span class="s1">&#39;&gt;&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="kt">}</span><span class="m">0</span>
    <span class="nv">c</span><span class="o">∊</span><span class="s1">&#39;[{(&lt;&#39;</span><span class="bp">:∇</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
    <span class="c1">⍝ for closing chars, check if they match</span>
    <span class="nv">match</span><span class="kd">←</span><span class="kt">{</span>
      <span class="nv">top</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">stack</span>
      <span class="nv">stack</span><span class="o">⊢</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">stack</span>
      <span class="nv">c</span><span class="o">=</span><span class="nv">top</span>
    <span class="kt">}</span><span class="m">0</span>
    <span class="nv">match</span><span class="bp">:∇</span><span class="p">(</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">⍝ char matches keep going</span>
    <span class="m">1</span>  <span class="c1">⍝ this is a corrupted line skip it</span>
  <span class="kt">}</span>
  <span class="nv">corrupt</span><span class="kd">←</span><span class="nv">next_char</span> <span class="m">1</span>
  <span class="nv">corrupt</span><span class="bp">:</span><span class="m">0</span>
  <span class="c1">⍝ score the expected completion if not corrupt</span>
  <span class="m">5</span><span class="o">⊥</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;)&#39;</span><span class="bp">:</span><span class="m">1</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="bp">:</span><span class="m">2</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;}&#39;</span><span class="bp">:</span><span class="m">3</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="bp">:</span><span class="m">4</span><span class="kt">}</span><span class="na">¨</span><span class="o">⌽</span><span class="nv">stack</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day10_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">scores</span><span class="kd">←</span><span class="p">(</span><span class="m">0</span><span class="na">∘</span><span class="o">≠</span><span class="p">)</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="bp">⍺⍺</span> <span class="bp">⍵</span><span class="kt">}</span><span class="nv">parse_chunks2</span><span class="na">¨</span><span class="bp">⍵</span>  <span class="c1">⍝ nonzero scores</span>
  <span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="o">⊂⍋</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⌷</span><span class="bp">⍵</span><span class="kt">}</span><span class="nv">scores</span><span class="p">)</span><span class="sr">[</span><span class="o">⌈</span><span class="p">(</span><span class="o">≢</span><span class="nv">scores</span><span class="p">)</span><span class="o">÷</span><span class="m">2</span><span class="sr">]</span>       <span class="c1">⍝ middle of sorted scores</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_2</span> <span class="nv">test10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">288957
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day10_2</span> <span class="nv">data10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2924734236
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-11">
<h2>Day 11<a class="headerlink" href="#day-11" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/11">Puzzle link</a></p>
<p>Cool trippy looking octopus simulation today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test11</span><span class="kd">←</span><span class="o">↑↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day11-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5 4 8 3 1 4 3 2 2 3
2 7 4 5 8 5 4 7 1 1
5 2 6 4 5 5 6 1 7 3
6 1 4 1 3 3 6 1 4 6
6 3 5 7 3 8 5 4 7 8
4 1 6 7 5 2 4 6 4 5
2 1 7 6 8 4 1 7 2 1
6 8 8 2 8 8 1 1 3 4
4 8 4 6 8 4 8 5 5 4
5 2 8 3 7 5 1 5 2 6
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data11</span><span class="kd">←</span><span class="o">↑↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day11-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We need a little dfn to simulate the octopi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">step_octopi</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="m">1</span><span class="o">+</span><span class="bp">⍵</span>
  <span class="nv">already_flashed</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴</span><span class="nv">grid</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>
  <span class="nv">do_flashes</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">flash</span><span class="kd">←</span><span class="p">(</span><span class="nv">grid</span><span class="o">&gt;</span><span class="m">9</span><span class="p">)</span><span class="o">∧~</span><span class="nv">already_flashed</span>
    <span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="nv">flash</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">grid</span>
    <span class="nv">grid</span><span class="o">+</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">↓</span><span class="m">¯5</span><span class="o">⌽,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">⊢</span><span class="nv">flash</span>
    <span class="nv">already_flashed</span><span class="o">∨</span><span class="kd">←</span><span class="nv">flash</span>
    <span class="bp">∇</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="nv">do_flashes</span> <span class="m">0</span>
  <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nv">grid</span><span class="o">&gt;</span><span class="m">9</span><span class="p">))</span><span class="o">×</span><span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id19">
<h3>Part 1<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>Count flashes after 100 steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day11_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">flashes</span><span class="kd">←</span><span class="m">0</span>
  <span class="nv">n</span><span class="kd">←</span><span class="bp">⍺</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="p">(</span><span class="nv">n</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">flashes</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="nv">step_octopi</span> <span class="nv">grid</span>
  <span class="nv">flashes</span><span class="o">+</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="nv">grid</span>
  <span class="nv">flashes</span><span class="o">+</span><span class="p">(</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="bp">∇</span> <span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">100</span> <span class="nv">day11_1</span> <span class="nv">test11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1656
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">100</span> <span class="nv">day11_1</span> <span class="nv">data11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1591
</span></div></div>
</div>
</div>
<div class="section" id="id20">
<h3>Part 2<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Find the step when all octopi flash.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day11_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="bp">⍺</span><span class="kd">←</span><span class="m">1</span>
  <span class="nv">n</span><span class="kd">←</span><span class="bp">⍺</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="nv">step_octopi</span> <span class="nv">grid</span>
  <span class="p">((</span><span class="o">×</span><span class="na">/</span><span class="o">⍴</span><span class="nv">grid</span><span class="p">)</span><span class="o">=+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="nv">grid</span><span class="p">)</span><span class="bp">:</span><span class="nv">n</span>
  <span class="p">(</span><span class="nv">n</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="bp">∇</span> <span class="nv">grid</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day11_2</span> <span class="nv">test11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">195
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day11_2</span> <span class="nv">data11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">314
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-12">
<h2>Day 12<a class="headerlink" href="#day-12" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/12">Puzzle link</a></p>
<p>Bleh graph search today. APL really isn’t especially great at this.</p>
<p>I’ll write out test12_1 longhand so that you can notice that ‘x’ is
a scalar and not a vector. But ‘xx’ is an array. So strings may be
arrays or not arrays depending on their length. This is somewhat
error-prone when trying things in the REPL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test12_1</span><span class="kd">←</span><span class="p">(</span><span class="s1">&#39;start&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">))(</span><span class="s1">&#39;start&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;d&#39;</span><span class="p">))((</span><span class="o">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="s1">&#39;end&#39;</span><span class="p">)((</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┬─────────┬─────┬─────┬─────┬───────┬───────┐
│┌─────┬─┐│┌─────┬─┐│┌─┬─┐│┌─┬─┐│┌─┬─┐│┌─┬───┐│┌─┬───┐│
││start│A│││start│b│││A│c│││A│b│││b│d│││A│end│││b│end││
│└─────┴─┘│└─────┴─┘│└─┴─┘│└─┴─┘│└─┴─┘│└─┴───┘│└─┴───┘│
└─────────┴─────────┴─────┴─────┴─────┴───────┴───────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test12_2</span><span class="kd">←</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day12-test2.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬──────────┬──────────┬──────────┬───────┬───────┬────────┬───────┬───
│┌──┬───┐│┌──┬─────┐│┌─────┬──┐│┌──┬─────┐│┌──┬──┐│┌──┬──┐│┌──┬───┐│┌──┬──┐│┌──
││dc│end│││HN│start│││start│kj│││dc│start│││dc│HN│││LN│dc│││HN│end│││kj│sa│││kj
│└──┴───┘│└──┴─────┘│└─────┴──┘│└──┴─────┘│└──┴──┘│└──┴──┘│└──┴───┘│└──┴──┘│└──
└────────┴──────────┴──────────┴──────────┴───────┴───────┴────────┴───────┴───

      ────┬───────┐
      ┬──┐│┌──┬──┐│
      │HN│││kj│dc││
      ┴──┘│└──┴──┘│
      ────┴───────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test12_3</span><span class="kd">←</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day12-test3.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬───────┬───────┬──────────┬───────┬────────┬───────┬───────┬───────┬─
│┌──┬───┐│┌──┬──┐│┌──┬──┐│┌─────┬──┐│┌──┬──┐│┌───┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌
││fs│end│││he│DX│││fs│he│││start│DX│││pj│DX│││end│zg│││zg│sl│││zg│pj│││pj│he│││
│└──┴───┘│└──┴──┘│└──┴──┘│└─────┴──┘│└──┴──┘│└───┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└
└────────┴───────┴───────┴──────────┴───────┴────────┴───────┴───────┴───────┴─

      ──────┬───────┬───────┬───────┬──────────┬───────┬───────┬───────┬───────
      ──┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌─────┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌─────┬
      RW│he│││fs│DX│││pj│RW│││zg│RW│││start│pj│││he│WI│││zg│he│││pj│fs│││start│
      ──┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└─────┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└─────┴
      ──────┴───────┴───────┴───────┴──────────┴───────┴───────┴───────┴───────

      ───┐
      ──┐│
      RW││
      ──┘│
      ───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data12</span><span class="kd">←</span><span class="s1">&#39;-&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day12-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id21">
<h3>Part 1<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>Count all paths visiting small letter caves at most once. We’ll just use
a recursive dfn to enumerate them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">paths</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">graph</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">xs</span><span class="kd">←</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">graph</span>
  <span class="nv">ys</span><span class="kd">←</span><span class="m">2</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">graph</span>
  <span class="nv">is_lower</span><span class="kd">←</span><span class="o">∧</span><span class="na">/</span><span class="p">(</span><span class="m">1</span><span class="na">∘</span><span class="nf">⎕C</span><span class="o">≠⊢</span><span class="p">)</span>  <span class="c1">⍝ 1 if c is lowercase</span>
  <span class="nv">visit</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">cur</span><span class="kd">←</span><span class="o">⊃</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span>  <span class="c1">⍝ current node</span>
    <span class="nv">pps</span><span class="kd">←</span><span class="o">⊃</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span>  <span class="c1">⍝ open partial paths</span>
    <span class="p">(</span><span class="nv">cur</span><span class="o">≡</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="bp">:</span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="na">∘</span><span class="o">,</span><span class="na">¨</span><span class="nv">pps</span>  <span class="c1">⍝ open paths stop at end</span>
    <span class="c1">⍝ collect adjacent vertices</span>
    <span class="nv">nexts</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">xs</span><span class="na">/⍨</span><span class="p">(</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">ys</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">ys</span><span class="na">/⍨</span><span class="p">(</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">xs</span><span class="p">)</span><span class="kt">}</span><span class="nv">cur</span>
    <span class="c1">⍝ prune paths that have gone through cur before if small </span>
    <span class="nv">small</span><span class="kd">←</span><span class="nv">is_lower</span> <span class="nv">cur</span>
    <span class="nv">open_pps</span><span class="kd">←</span><span class="nv">pps</span><span class="na">/⍨</span><span class="p">((</span><span class="o">~</span><span class="nv">small</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="o">∧</span><span class="na">/¨</span><span class="p">(</span><span class="o">,</span><span class="nv">cur</span><span class="na">∘</span><span class="o">≢</span><span class="na">¨¨</span><span class="nv">pps</span><span class="p">)))</span>
    <span class="p">((</span><span class="o">≢</span><span class="nv">open_pps</span><span class="p">)</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="m">0</span>  <span class="c1">⍝ dead end</span>
    <span class="c1">⍝ return all the paths here</span>
    <span class="nv">next_pps</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="nv">cur</span><span class="p">)</span><span class="na">∘</span><span class="o">,</span><span class="na">¨</span><span class="nv">open_pps</span>
    <span class="nv">here</span><span class="kd">←</span><span class="o">,↑</span><span class="kt">{</span><span class="nv">visit</span><span class="p">(</span><span class="bp">⍵</span> <span class="nv">next_pps</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">nexts</span>
    <span class="p">((</span><span class="m">1</span><span class="na">∘</span><span class="o">≠</span><span class="p">)</span><span class="o">≢</span><span class="na">¨</span><span class="nv">here</span><span class="p">)</span><span class="na">/</span><span class="nv">here</span>
  <span class="kt">}</span>
  <span class="c1">⍝ this filters out annoying empty paths</span>
  <span class="nv">paths_with_ghosts</span><span class="kd">←</span><span class="nv">visit</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">(</span><span class="o">,</span><span class="s1">&#39;-&#39;</span><span class="p">))</span>
  <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">∊</span><span class="na">¨</span><span class="nv">paths_with_ghosts</span><span class="p">)</span><span class="na">/</span><span class="nv">paths_with_ghosts</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">paths</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">19
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">test12_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">226
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_1</span> <span class="nv">data12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3761
</span></div></div>
</div>
</div>
<div class="section" id="id22">
<h3>Part 2<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>How many paths are there if we can revisit one small letter cave twice?</p>
<p>Originally, I modified my recursive dfn from part 1 to solve this part,
and it blew Dyalog’s stack limit. So I rewrote the search to be iterative
instead. That worked but took so long that I wrote a naive Python solution
instead of waiting for it to finish (the runtime was 5 seconds).</p>
<p>I eventually figured out that “drop” is slow linear time and so it is really
easy to make things n^2 by mistake.</p>
<p>This uses “tradfns” and Dyalog’s procedural programming keywords, which
feels super gross.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">result</span><span class="kd">←</span><span class="nv">paths2_non_recursive</span> <span class="nv">graph</span><span class="sr">;</span><span class="nv">xs</span><span class="sr">;</span><span class="nv">ys</span><span class="sr">;</span><span class="nv">is_lower</span><span class="sr">;</span><span class="nv">q</span><span class="sr">;</span><span class="nv">n</span><span class="sr">;</span><span class="nv">i</span><span class="sr">;</span><span class="nv">cur</span><span class="sr">;</span><span class="nv">pps</span><span class="sr">;</span><span class="nv">open_pps</span><span class="sr">;</span><span class="nv">nexts</span><span class="sr">;</span><span class="nv">next_pps</span>
 <span class="nv">xs</span><span class="kd">←</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">graph</span>
 <span class="nv">ys</span><span class="kd">←</span><span class="m">2</span><span class="o">⊃</span><span class="na">¨</span><span class="nv">graph</span>
 <span class="nv">is_lower</span><span class="kd">←</span><span class="o">∧</span><span class="na">/</span><span class="p">(</span><span class="m">1</span><span class="na">∘</span><span class="nf">⎕C</span><span class="o">≠⊢</span><span class="p">)</span>

 <span class="nv">paths_with_ghosts</span><span class="kd">←</span><span class="no">⍬</span>
 <span class="c1">⍝ trying to pop a queue is absurdly slow, so instead</span>
 <span class="c1">⍝ keep our own running start index and length</span>
 <span class="c1">⍝q←⊂(&#39;start&#39;(,&#39;-&#39;))</span>
 <span class="c1">⍝:While (≢q)&gt;0</span>
     <span class="c1">⍝cur←⊃⊃q</span>
     <span class="c1">⍝pps←2⊃⊃q</span>
     <span class="c1">⍝q←(1↓q)</span>
 <span class="nv">q</span><span class="kd">←</span><span class="p">(</span><span class="o">,↓</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">(</span><span class="o">,</span><span class="s1">&#39;-&#39;</span><span class="p">)))</span>
 <span class="nv">n</span><span class="kd">←</span><span class="m">1</span>
 <span class="nv">i</span><span class="kd">←</span><span class="m">1</span>
 <span class="bp">:</span><span class="nv">While</span> <span class="nv">n</span><span class="o">&gt;</span><span class="m">0</span>
     <span class="nv">cur</span><span class="kd">←</span><span class="o">⊃⊃</span><span class="nv">q</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
     <span class="nv">pps</span><span class="kd">←</span><span class="m">2</span><span class="o">⊃⊃</span><span class="nv">q</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
     <span class="nv">n</span><span class="o">-</span><span class="kd">←</span><span class="m">1</span>
     <span class="nv">i</span><span class="o">+</span><span class="kd">←</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">cur</span><span class="o">≡</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
         <span class="nv">paths_with_ghosts</span><span class="o">,</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="na">∘</span><span class="o">,</span><span class="na">¨</span><span class="nv">pps</span>
         <span class="bp">:</span><span class="nv">Continue</span>
     <span class="bp">:</span><span class="nv">EndIf</span>
     <span class="nv">open_pps</span><span class="kd">←</span><span class="p">(</span><span class="kt">{</span><span class="nv">cur</span> <span class="nv">is_open</span> <span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="nv">pps</span><span class="p">)</span><span class="na">/</span><span class="nv">pps</span>
     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">≢</span><span class="nv">open_pps</span><span class="p">)</span><span class="o">=</span><span class="m">0</span>
         <span class="bp">:</span><span class="nv">Continue</span>
     <span class="bp">:</span><span class="nv">EndIf</span>
     <span class="nv">nexts</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">xs</span><span class="na">/⍨</span><span class="p">(</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">ys</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">ys</span><span class="na">/⍨</span><span class="p">(</span><span class="o">,</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">xs</span><span class="p">)</span><span class="kt">}</span><span class="nv">cur</span>
     <span class="nv">next_pps</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="nv">cur</span><span class="p">)</span><span class="na">∘</span><span class="o">,</span><span class="na">¨</span><span class="nv">open_pps</span>
     <span class="nv">q</span><span class="o">,</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="bp">⍵</span> <span class="nv">next_pps</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">nexts</span>
     <span class="nv">n</span><span class="o">+</span><span class="kd">←</span><span class="o">≢</span><span class="nv">nexts</span>
 <span class="bp">:</span><span class="nv">EndWhile</span>
 <span class="nv">result</span><span class="kd">←</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">∊</span><span class="na">¨</span><span class="nv">paths_with_ghosts</span><span class="p">)</span><span class="na">/</span><span class="nv">paths_with_ghosts</span>
</pre></div>
</div>
</div>
</div>
<p>I extracted a separate procedure for is_open in an effort to see
if it would speed up the search. It did not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">result</span><span class="kd">←</span><span class="nv">cur</span> <span class="nv">is_open</span> <span class="nv">pp</span><span class="sr">;</span><span class="nv">ppt</span><span class="sr">;</span><span class="nv">count</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="nv">is_lower</span> <span class="nv">cur</span><span class="p">))</span>
     <span class="nv">result</span><span class="kd">←</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">((</span><span class="nv">cur</span><span class="o">≡</span><span class="s1">&#39;start&#39;</span><span class="p">)</span><span class="o">∧</span><span class="p">((</span><span class="o">≢</span><span class="nv">pp</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">))</span>
     <span class="nv">result</span><span class="kd">←</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="nv">ppt</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="nv">cur</span><span class="p">)</span><span class="o">,</span><span class="nv">pp</span>
 <span class="nv">count</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="p">((</span><span class="nv">is_lower</span><span class="na">¨</span><span class="nv">ppt</span><span class="p">)</span><span class="na">/</span><span class="nv">ppt</span><span class="p">)</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="o">∨</span><span class="na">/</span><span class="p">(</span><span class="o">&gt;</span><span class="na">∘</span><span class="m">2</span><span class="p">)</span><span class="nv">count</span><span class="p">)</span>
     <span class="nv">result</span><span class="kd">←</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="bp">:</span><span class="nv">If</span> <span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">=</span><span class="na">∘</span><span class="m">2</span><span class="p">)</span><span class="nv">count</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">)</span>
     <span class="nv">result</span><span class="kd">←</span><span class="m">0</span>
     <span class="bp">:</span><span class="nv">Return</span>
 <span class="bp">:</span><span class="nv">EndIf</span>
 <span class="nv">result</span><span class="kd">←</span><span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">paths2_non_recursive</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">36
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">103
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day12_2</span> <span class="nv">test12_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3509
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝day12_2 data12  ⍝ still really slow</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-13">
<h2>Day 13<a class="headerlink" href="#day-13" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/13">Puzzle link</a></p>
<p>Ooh, origami today, that sounds cool.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test13</span> <span class="kd">←</span> <span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day13-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data13</span> <span class="kd">←</span> <span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day13-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start by parsing out the points and the folding instructions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_folds</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ given lines like (&#39;0,0&#39;)(&#39;3,2&#39;)(&#39;fold along x=5&#39;)(&#39;fold along y=4&#39;)</span>
  <span class="c1">⍝ returns (points folds) where points are (x y)s and folds are (x 0)</span>
  <span class="c1">⍝ for vertical folds and (0 y) for horizontal folds </span>
  <span class="nv">parse_line</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ note that we add 1 to x ys because APL arrays are 1-indexed</span>
    <span class="s1">&#39;,&#39;</span><span class="o">∊</span><span class="bp">⍵:</span><span class="m">1</span><span class="o">,</span><span class="p">(</span><span class="o">⌽</span><span class="m">1</span><span class="o">+⍎</span><span class="na">¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span> <span class="c1">⍝ &#39;,&#39; lines: 1 x+1 y+1 </span>
    <span class="s1">&#39;x&#39;</span><span class="o">∊</span><span class="bp">⍵:</span><span class="m">2</span><span class="p">(</span><span class="o">⍎</span><span class="m">2</span><span class="o">⊃</span><span class="s1">&#39;=&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="m">0</span>   <span class="c1">⍝ &#39;x&#39; lines: 2 x 0</span>
    <span class="s1">&#39;y&#39;</span><span class="o">∊</span><span class="bp">⍵:</span><span class="m">2</span> <span class="m">0</span><span class="p">(</span><span class="o">⍎</span><span class="m">2</span><span class="o">⊃</span><span class="s1">&#39;=&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span>  <span class="c1">⍝ &#39;y&#39; lines: 2 0 y</span>
    <span class="m">0</span>                        <span class="c1">⍝ ignore extra newlines</span>
  <span class="kt">}</span>
  <span class="c1">⍝ selects rows with first element =⍺, dropping that element</span>
  <span class="nv">select</span><span class="kd">←</span><span class="kt">{</span><span class="m">1</span><span class="o">↓</span><span class="na">¨</span><span class="p">(</span><span class="bp">⍺</span><span class="o">=⊃</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span>
  <span class="c1">⍝ collect 1 lines (i.e. points) and then 2 lines (i.e. folds)</span>
  <span class="p">(</span><span class="o">⊂</span><span class="na">∘</span><span class="p">(</span><span class="m">1</span><span class="na">∘</span><span class="nv">select</span><span class="p">)</span><span class="o">,⊂</span><span class="na">∘</span><span class="p">(</span><span class="m">2</span><span class="na">∘</span><span class="nv">select</span><span class="p">))</span><span class="nv">parse_line</span><span class="na">¨</span><span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>We can sanity check this with a little plotting helper.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">plot</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">points</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">paper</span><span class="kd">←</span><span class="p">(</span><span class="o">↑⌈</span><span class="na">/</span><span class="nv">points</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>  <span class="c1">⍝ 0s as wide and tall as max x and max y</span>
  <span class="nv">paper</span><span class="sr">[</span><span class="nv">points</span><span class="sr">]</span><span class="kd">←</span><span class="m">1</span>      <span class="c1">⍝ plot 1s at each point</span>
  <span class="nv">paper</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">x</span><span class="kd">←</span><span class="nv">plot</span> <span class="o">⊃</span><span class="nv">parse_folds</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 1 0 0 1 0 0 1 0
0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
1 0 0 0 0 0 0 0 0 0 0
0 0 0 1 0 0 0 0 1 0 1
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
0 1 0 0 0 0 1 0 1 1 0
0 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 1
1 0 0 0 0 0 0 0 0 0 0
1 0 1 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<p>To fold, we can just reflect the matrix horizontally or vertically
and or it with itself, and then take only the upper or left part.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">x</span><span class="kd">←</span><span class="m">7</span><span class="o">↑</span><span class="nv">x</span><span class="o">∨⊖</span><span class="nv">x</span>   <span class="c1">⍝ e.g. fold up and keep 7 rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 1 0 0 1 0 0 1 0
1 0 0 0 1 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0 0 1
1 0 0 0 1 0 0 0 0 0 0
0 1 0 1 0 0 1 0 1 1 1
0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">x</span><span class="kd">←</span><span class="m">5</span><span class="o">↑</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">x</span><span class="o">∨⌽</span><span class="nv">x</span> <span class="c1">⍝ now fold left and keep 5 cols</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1
1 0 0 0 1
1 0 0 0 1
1 0 0 0 1
1 1 1 1 1
0 0 0 0 0
0 0 0 0 0
</span></div></div>
</div>
<p>Let’s just write a general program for any number of folds and then
have it only do the first to solve part 1. It isn’t really that much
different.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">fold</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">points</span> <span class="nv">folds</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">paper</span><span class="kd">←</span><span class="nv">plot</span> <span class="nv">points</span> <span class="c1">⍝ make bitmap of points</span>
  <span class="nv">fold_left</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ modify paper, or&#39;ing right-to-left and keeping left ⍵ cols</span>
    <span class="nv">paper</span><span class="o">⊢</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">↑</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">paper</span><span class="o">∨⌽</span><span class="nv">paper</span> <span class="p">⋄</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">fold_up</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ modify paper, or&#39;ing top-to-bottom and keeping top ⍵ rows</span>
    <span class="nv">paper</span><span class="o">⊢</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">↑</span><span class="nv">paper</span><span class="o">∨⊖</span><span class="nv">paper</span> <span class="p">⋄</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">left</span> <span class="nv">up</span><span class="kd">←</span><span class="bp">⍵</span>   <span class="c1">⍝ each element has x/y fold amount  </span>
    <span class="p">(</span><span class="nv">left</span><span class="o">≠</span><span class="m">0</span><span class="p">)</span><span class="bp">:</span><span class="nv">fold_left</span> <span class="nv">left</span>
    <span class="nv">fold_up</span> <span class="nv">up</span>
  <span class="kt">}</span><span class="na">¨</span><span class="nv">folds</span>
  <span class="nv">paper</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">fold</span> <span class="nv">parse_folds</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 1 1
1 0 0 0 1
1 0 0 0 1
1 0 0 0 1
1 1 1 1 1
0 0 0 0 0
0 0 0 0 0
</span></div></div>
</div>
<div class="section" id="id23">
<h3>Part 1<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>To prove this works, count up points after doing just the first fold.
The inline dfn here keeps all the points and only the first fold from
instructions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="nv">fold</span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">⊂</span><span class="p">(</span><span class="o">⊃</span><span class="m">2</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span><span class="nv">parse_folds</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span> <span class="nv">test13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">17
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_1</span> <span class="nv">data13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">842
</span></div></div>
</div>
</div>
<div class="section" id="id24">
<h3>Part 2<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>Then we do the whole thing and get a bitmap to answer with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_2</span> <span class="kd">←</span> <span class="nv">fold</span> <span class="nv">parse_folds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day13_2</span> <span class="nv">data13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 0 1 1 1 1 0 1 0 0 1 0 1 1 1 0 0 0 1 1 0 0 0 0 1 1 0 1 1 1 1 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 1 0 0 0 0 1 0 0 0 0 1 0 1 0 0 1 0
1 1 1 0 0 1 1 1 0 0 1 1 0 0 0 1 0 0 1 0 1 0 0 0 0 0 0 0 1 0 0 0 1 0 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 1 1 0 0 1 0 0 0 0 0 0 0 1 0 0 1 0 0 0 1 0 0 1 0
1 0 0 1 0 1 0 0 0 0 1 0 1 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 1 0 1 0 0 0 0 1 0 0 1 0
1 1 1 0 0 1 0 0 0 0 1 0 0 1 0 1 0 0 1 0 0 1 1 0 0 0 1 1 0 0 1 1 1 1 0 0 1 1 0 0
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-14">
<h2>Day 14<a class="headerlink" href="#day-14" title="Permalink to this headline">¶</a></h2>
<p>Today we get to do string shenanigans, substituting pairs for letters.
APL doesn’t really seem to have dictionaries so I guess I’ll roll my own…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">polymers</span><span class="kd">←</span><span class="o">↑</span><span class="p">(</span><span class="s1">&#39;NN&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;C&#39;</span><span class="p">))(</span><span class="s1">&#39;NC&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;B&#39;</span><span class="p">))(</span><span class="s1">&#39;CB&#39;</span> <span class="p">(</span><span class="o">,</span><span class="s1">&#39;H&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─┐
│NN│C│
├──┼─┤
│NC│B│
├──┼─┤
│CB│H│
└──┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">⌽</span><span class="s1">&#39;NC&#39;</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span>  <span class="c1">⍝ lookup letter where adjacent column is &#39;NC&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">B
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">⍝ get pairs from string</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬──┬──┐
│NN│NC│CB│
└──┴──┴──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊃⊃</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">⍝ lookup letter for each pair</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">CBH
</span></div></div>
</div>
<p>We’re supposed to squidge the letters between the pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">⊃,</span><span class="na">/</span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,⊃⊃</span><span class="nv">polymers</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">polymers</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span><span class="s1">&#39;NNCB&#39;</span>  <span class="c1">⍝ put pair letters around lookups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NCNBCHB
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">polymerize</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">pairs</span><span class="kd">←</span><span class="bp">⍺</span>
  <span class="nv">template</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">lookup</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃⊃</span><span class="nv">pairs</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">pairs</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span>
  <span class="p">(</span><span class="o">⊃,</span><span class="na">/</span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="nv">lookup</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="nv">template</span><span class="p">)</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">template</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">polymers</span> <span class="nv">polymerize</span> <span class="s1">&#39;NNCB&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NCNBCHB
</span></div></div>
</div>
<p>Ok, time to read inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test14_template</span><span class="kd">←</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day14-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NNCB
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test14_pairs</span><span class="kd">←</span><span class="o">↑</span><span class="kt">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">⍤</span><span class="o">∊</span><span class="na">⍨</span><span class="o">⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day14-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬─┐
│CH│B│
├──┼─┤
│HH│N│
├──┼─┤
│CB│H│
├──┼─┤
│NH│C│
├──┼─┤
│HB│C│
├──┼─┤
│HC│B│
├──┼─┤
│HN│C│
├──┼─┤
│NN│C│
├──┼─┤
│BH│H│
├──┼─┤
│NC│B│
├──┼─┤
│NB│B│
├──┼─┤
│BN│B│
├──┼─┤
│BB│N│
├──┼─┤
│BC│B│
├──┼─┤
│CC│N│
├──┼─┤
│CN│C│
└──┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_template</span><span class="kd">←</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day14-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span><span class="kd">←</span><span class="o">↑</span><span class="kt">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="p">(</span><span class="o">~</span><span class="na">⍤</span><span class="o">∊</span><span class="na">⍨</span><span class="o">⊆⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day14-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id25">
<h3>Part 1<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>Polymerize repeatedly…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="nv">test14_pairs</span><span class="na">∘</span><span class="nv">polymerize</span><span class="p">)</span><span class="na">⍣</span><span class="m">4</span><span class="p">)</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">NBBNBNBBCCNBCNCCNBBNBBNBBBNBBNBBCBHCBHHNHCBBCBHCB
</span></div></div>
</div>
<p>and find the most common minus the least common character.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">most_minus_least</span><span class="kd">←</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="o">-⌊</span><span class="na">/</span><span class="p">)</span><span class="kt">{</span><span class="o">≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸∘</span><span class="o">⊢</span>  <span class="c1">⍝ tally keys, then take max-min </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">most_minus_least</span> <span class="s1">&#39;ABBBCCCCC&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day14_1</span><span class="kd">←</span><span class="kt">{</span><span class="nv">most_minus_least</span> <span class="p">((</span><span class="bp">⍺</span><span class="na">∘</span><span class="nv">polymerize</span><span class="p">)</span><span class="na">⍣</span><span class="m">10</span><span class="p">)</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_1</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1588
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span> <span class="nv">day14_1</span> <span class="nv">data14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2587
</span></div></div>
</div>
</div>
<div class="section" id="id26">
<h3>Part 2<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>Now we have to do this 40 times in a row. Naive string substitution
won’t work anymore; Dyalog bogs down at around 16 or 17 iterations.</p>
<p>Notice that in each generation, each pair yields 2 new pairs: xy -&gt; z
gives xz and zy. The order isn’t important, so we can just count them.
First we have to count pairs in the template.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">count_pairs</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span> <span class="m">1</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span><span class="o">,</span><span class="na">/</span><span class="o">⊢</span>  <span class="c1">⍝ (pair 1) for each pair in template</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_census</span><span class="kd">←</span><span class="nv">count_pairs</span> <span class="nv">test14_template</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">data14_census</span><span class="kd">←</span><span class="nv">count_pairs</span> <span class="nv">data14_template</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬─
│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌
││VH│1│││HC│1│││CK│1│││KB│1│││BF│1│││FO│1│││OV│1│││VC│1│││CH│1│││HH│1│││HK│1│││
│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴─

      ─────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐
      ──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│
      KO│1│││OH│1│││HB│1│││BP│1│││PN│1│││NC│1│││CK│1│││KO│1││
      ──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│
      ─────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘
</span></div></div>
</div>
<p>Note that CK and KO are duplicated, so we need to collect counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="o">↓</span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)(</span><span class="o">+</span><span class="na">/</span><span class="o">⊢</span><span class="na">/</span><span class="o">↑</span><span class="nv">c</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="o">⊣</span><span class="na">/</span><span class="o">↑</span><span class="nv">c</span><span class="kt">}</span>  <span class="c1">⍝ sum counts for duplicate keys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬─
│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌
││VH│1│││HC│1│││CK│2│││KB│1│││BF│1│││FO│1│││OV│1│││VC│1│││CH│1│││HH│1│││HK│1│││
│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴─

      ─────┬──────┬──────┬──────┬──────┬──────┐
      ──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│
      KO│2│││OH│1│││HB│1│││BP│1│││PN│1│││NC│1││
      ──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│
      ─────┴──────┴──────┴──────┴──────┴──────┘
</span></div></div>
</div>
<p>We can now polymerize pair counts rather than strings, which ought to be
much more efficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">polymerize2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ update association list of (pair count) by inserting two new pairs</span>
  <span class="c1">⍝ for each existing pair according to substitution instructions</span>
  <span class="nv">pairs</span><span class="kd">←</span><span class="bp">⍺</span>   <span class="c1">⍝ (pair letter) substitution instructions</span>
  <span class="nv">census</span><span class="kd">←</span><span class="bp">⍵</span>  <span class="c1">⍝ (pair count) current counts</span>
  <span class="nv">lookup</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃⊃</span><span class="nv">pairs</span><span class="sr">[</span><span class="o">⍸</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="na">∘</span><span class="o">≡</span><span class="na">¨</span><span class="nv">pairs</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span>
  <span class="nv">merge_counts</span><span class="o">,↑</span><span class="kt">{</span>
    <span class="nv">pair</span> <span class="nv">count</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">letter</span><span class="kd">←</span><span class="nv">lookup</span> <span class="nv">pair</span>
    <span class="nv">left</span><span class="kd">←</span><span class="p">(</span><span class="m">1</span><span class="o">↑</span><span class="nv">pair</span><span class="p">)</span><span class="o">,</span><span class="nv">letter</span>
    <span class="nv">right</span><span class="kd">←</span><span class="nv">letter</span><span class="o">,</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">pair</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">left</span> <span class="nv">count</span><span class="p">)(</span><span class="nv">right</span> <span class="nv">count</span><span class="p">)</span>
  <span class="kt">}</span><span class="na">¨</span><span class="nv">census</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">polymerize2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬──────┬──────┬──────┬──────┐
│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│
││NC│1│││CN│1│││NB│1│││BC│1│││CH│1│││HB│1││
│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│
└──────┴──────┴──────┴──────┴──────┴──────┘
</span></div></div>
</div>
<p>But in the final analysis, we need to count letters, not pairs. Each
pair contributes one distinct letter except the last pair which
contributes two. We can refine merge to leave out the last pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">merge_counts</span><span class="kd">←</span><span class="kt">{</span><span class="nv">c</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↓</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="o">↓</span><span class="kt">{</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍺</span><span class="p">)(</span><span class="o">+</span><span class="na">/</span><span class="o">⊢</span><span class="na">/</span><span class="o">↑</span><span class="nv">c</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span><span class="p">)</span><span class="kt">}</span><span class="na">⌸</span><span class="o">⊣</span><span class="na">/</span><span class="o">↑</span><span class="nv">c</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>  <span class="c1">⍝ merge all but last pair counts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">data14_census</span><span class="kd">←</span><span class="nv">merge_counts</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬─
│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌
││VH│1│││HC│1│││CK│2│││KB│1│││BF│1│││FO│1│││OV│1│││VC│1│││CH│1│││HH│1│││HK│1│││
│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴─

      ─────┬──────┬──────┬──────┬──────┬──────┬──────┐
      ──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│┌──┬─┐│
      KO│1│││OH│1│││HB│1│││BP│1│││PN│1│││NC│1│││KO│1││
      ──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│└──┴─┘│
      ─────┴──────┴──────┴──────┴──────┴──────┴──────┘
</span></div></div>
</div>
<p>This way the last pair in the census will always be the literal last pair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="nv">test14_pairs</span><span class="na">∘</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">⍣</span><span class="m">10</span><span class="p">)</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────┬────────┬────────┬────────┬───────┬────────┬───────┬────────┬───────┬
│┌──┬───┐│┌──┬───┐│┌──┬───┐│┌──┬───┐│┌──┬──┐│┌──┬───┐│┌──┬──┐│┌──┬───┐│┌──┬──┐│
││NB│796│││BB│812│││BN│735│││BC│120│││CC│60│││CN│102│││NC│42│││CB│114│││BH│81││
│└──┴───┘│└──┴───┘│└──┴───┘│└──┴───┘│└──┴──┘│└──┴───┘│└──┴──┘│└──┴───┘│└──┴──┘│
└────────┴────────┴────────┴────────┴───────┴────────┴───────┴────────┴───────┴

      ───────┬───────┬───────┬───────┬───────┬───────┬──────┐
      ┌──┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌──┬──┐│┌──┬─┐│
      │HC│76│││HH│32│││HN│27│││NH│27│││CH│21│││HB│26│││CB│1││
      └──┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└──┴──┘│└──┴─┘│
      ───────┴───────┴───────┴───────┴───────┴───────┴──────┘
</span></div></div>
</div>
<p>Finally we just have to write a horrible function to sum up letter counts given
pair counts. It merges the counts of the first letters of each pair, plus the
last letter of the last pair, then takes the max count minus the min count.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="o">-⌊</span><span class="na">/</span><span class="p">)</span><span class="o">⊢</span><span class="na">⌿</span><span class="o">⍉↑</span><span class="m">¯1</span><span class="o">↓</span><span class="p">(</span><span class="nv">merge_counts</span> <span class="p">(</span><span class="kt">{</span><span class="p">((</span><span class="o">⊃⊃</span><span class="p">(</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">))(</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">))</span><span class="kt">}</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⊂</span><span class="p">((</span><span class="m">2</span><span class="o">⊃⊃⊃</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">))</span> <span class="m">1</span><span class="p">))</span><span class="o">,</span><span class="m">0</span><span class="p">)</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="nv">test14_pairs</span><span class="na">∘</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">⍣</span><span class="m">10</span><span class="p">)</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1588
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="nv">data14_pairs</span><span class="na">∘</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">⍣</span><span class="m">10</span><span class="p">)</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2587
</span></div></div>
</div>
<p>Since it seems to work we can try it out on the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day14_2</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">letter_diff_from_census</span> <span class="p">((</span><span class="bp">⍺</span><span class="na">∘</span><span class="nv">polymerize2</span><span class="p">)</span><span class="na">⍣</span><span class="m">40</span><span class="p">)</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2188189693529
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕PP</span><span class="kd">←</span><span class="m">16</span>  <span class="c1">⍝ we need more precision, apparently</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test14_pairs</span> <span class="nv">day14_2</span> <span class="nv">test14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2188189693529
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data14_pairs</span> <span class="nv">day14_2</span> <span class="nv">data14_census</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3318837563123
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-15">
<h2>Day 15<a class="headerlink" href="#day-15" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/15">Puzzle link</a></p>
<p>Find a shortest path from top left to bottom right in a grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test15</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day15-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 6 3 7 5 1 7 4 2
1 3 8 1 3 7 3 6 7 2
2 1 3 6 5 1 1 3 2 8
3 6 9 4 9 3 1 5 6 9
7 4 6 3 4 1 7 1 1 1
1 3 1 9 1 2 8 1 3 7
1 3 5 9 9 1 2 4 2 1
3 1 2 5 4 2 1 6 3 9
1 2 9 3 1 3 8 5 2 1
2 3 1 1 9 4 4 5 8 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data15</span><span class="kd">←</span><span class="o">↑⍎</span><span class="na">¨¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day15-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll use <a class="reference external" href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s algorithm</a>.
Here is straightforward code for it, not really particularly APLy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">dijkstra</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">grid</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">in_bounds</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">∧</span><span class="na">/</span><span class="bp">⍵</span><span class="o">≤</span><span class="p">(</span><span class="o">⊃⍴</span><span class="nv">grid</span><span class="p">))</span><span class="o">∧</span><span class="p">(</span><span class="o">∧</span><span class="na">/</span><span class="bp">⍵</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">start</span><span class="kd">←</span><span class="m">1</span> <span class="m">1</span>           <span class="c1">⍝ start at upper left</span>
  <span class="nv">visited</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴</span><span class="nv">grid</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>   <span class="c1">⍝ init all nodes to unvisited</span>
  <span class="nv">M</span><span class="kd">←</span><span class="m">10000000</span>          <span class="c1">⍝ this distance means &quot;infinity&quot;</span>
  <span class="nv">distance</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴</span><span class="nv">grid</span><span class="p">)</span><span class="o">⍴</span><span class="nv">M</span>  <span class="c1">⍝ init nodes at &quot;infinity&quot;</span>
  <span class="nv">distance</span><span class="sr">[</span><span class="o">⊂</span><span class="nv">start</span><span class="sr">]</span><span class="kd">←</span><span class="m">0</span>  <span class="c1">⍝ start at distance 0</span>
  <span class="nv">step</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">m</span><span class="kd">←</span><span class="nv">distance</span><span class="o">+</span><span class="nv">M</span><span class="o">×</span><span class="nv">visited</span>
    <span class="nv">min</span><span class="kd">←</span><span class="o">⌊</span><span class="na">/</span><span class="o">,</span><span class="nv">m</span>     <span class="c1">⍝ select min distance or M if all visited</span>
    <span class="nv">min</span><span class="o">≥</span><span class="nv">M</span><span class="bp">:</span><span class="m">0</span>      <span class="c1">⍝ stop if all visited</span>
    <span class="nv">v</span><span class="kd">←</span><span class="o">⊃⍸</span><span class="p">(</span><span class="nv">m</span><span class="o">=</span><span class="nv">min</span><span class="p">)</span>  <span class="c1">⍝ find first index of min</span>
    <span class="nv">visited</span><span class="sr">[</span><span class="o">⊂</span><span class="nv">v</span><span class="sr">]</span><span class="kd">←</span><span class="m">1</span> <span class="c1">⍝ mark visited</span>
    <span class="c1">⍝ collect in bounds, unvisited orthogonal neighbors</span>
    <span class="nv">neighbors</span><span class="kd">←</span><span class="o">↓</span><span class="nv">v</span><span class="p">(</span><span class="o">+</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="o">↑</span><span class="p">(</span><span class="m">¯1</span> <span class="m">0</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">¯1</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">neighbors</span><span class="kd">←</span><span class="p">(</span><span class="kt">{</span><span class="o">~</span><span class="nv">in_bounds</span> <span class="bp">⍵:</span><span class="m">0</span> <span class="p">⋄</span> <span class="o">~</span><span class="nv">visited</span><span class="sr">[</span><span class="o">⊂</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="nv">neighbors</span><span class="p">)</span><span class="na">/</span><span class="nv">neighbors</span>
    <span class="m">0</span><span class="o">=≢</span><span class="nv">neighbors</span><span class="bp">:∇</span> <span class="no">⍬</span>  <span class="c1">⍝ skip if no unvisited neighbors</span>
    <span class="c1">⍝ update min distance to neighbors</span>
    <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span><span class="nv">distance</span><span class="sr">[</span><span class="o">⊂</span><span class="bp">⍵</span><span class="sr">]</span><span class="o">⌊</span><span class="kd">←</span><span class="nv">grid</span><span class="sr">[</span><span class="o">⊂</span><span class="bp">⍵</span><span class="sr">]</span><span class="o">+</span><span class="nv">distance</span><span class="sr">[</span><span class="o">⊂</span><span class="nv">v</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="nv">neighbors</span>
    <span class="bp">∇</span> <span class="no">⍬</span>
  <span class="kt">}</span>
  <span class="nv">_</span><span class="kd">←</span><span class="nv">step</span> <span class="no">⍬</span>
  <span class="nv">distance</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h3>Part 1<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>Just call our Dijkstra helper to get the shortest path length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴⊢</span><span class="p">)</span><span class="o">⌷</span><span class="na">∘</span><span class="nv">dijkstra</span><span class="o">⊢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span> <span class="nv">test15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">40
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_1</span> <span class="nv">data15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">458
</span></div></div>
</div>
</div>
<div class="section" id="id28">
<h3>Part 2<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>The graph is secretly bigger and we need to tile it five times in each
direction and adjust the values slightly. We can do this easily with an
outer product over an index matrix ⍳5 5 and the tile.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍳</span><span class="m">5</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┐
│1 1│1 2│1 3│1 4│1 5│
├───┼───┼───┼───┼───┤
│2 1│2 2│2 3│2 4│2 5│
├───┼───┼───┼───┼───┤
│3 1│3 2│3 3│3 4│3 5│
├───┼───┼───┼───┼───┤
│4 1│4 2│4 3│4 4│4 5│
├───┼───┼───┼───┼───┤
│5 1│5 2│5 3│5 4│5 5│
└───┴───┴───┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span><span class="kt">{</span><span class="m">1</span><span class="o">+</span><span class="m">9</span><span class="o">|</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="bp">⍵</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="nv">test15</span>  <span class="c1">⍝ offset tile values by index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2 2 7 4 8 6 2 8 5 3
2 4 9 2 4 8 4 7 8 3
3 2 4 7 6 2 2 4 3 9
4 7 1 5 1 4 2 6 7 1
8 5 7 4 5 2 8 2 2 2
2 4 2 1 2 3 9 2 4 8
2 4 6 1 1 2 3 5 3 2
4 2 3 6 5 3 2 7 4 1
2 3 1 4 2 4 9 6 3 2
3 4 2 2 1 5 5 6 9 2
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tile</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃⍪</span><span class="na">⌿</span><span class="o">,</span><span class="na">/</span><span class="p">(</span><span class="o">⍳</span><span class="m">5</span> <span class="m">5</span><span class="p">)</span><span class="na">∘.</span><span class="kt">{</span><span class="m">1</span><span class="o">+</span><span class="m">9</span><span class="o">|</span><span class="p">((</span><span class="o">+</span><span class="na">/</span><span class="bp">⍺</span><span class="p">)</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="bp">⍵</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span>  <span class="c1">⍝ flattened product of indices×adjusted tiles</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_2</span><span class="kd">←</span><span class="kt">{</span><span class="nv">t</span><span class="kd">←</span><span class="nv">tile</span> <span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="o">⍴</span><span class="nv">t</span><span class="p">)</span><span class="o">⌷</span><span class="nv">dijkstra</span> <span class="nv">t</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day15_2</span> <span class="nv">test15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">315
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝day15_2 data15  ⍝ takes a while...</span>
</pre></div>
</div>
</div>
</div>
<p>The search on the full 500x500 matrix takes a while, but not enough to
think harder about this.</p>
</div>
</div>
<div class="section" id="day-16">
<h2>Day 16<a class="headerlink" href="#day-16" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/16">Puzzle link</a></p>
<p>Today we get to parse a nested binary serialization format from hex numbers.
The easiest representation is to use nested arrays so this isn’t going to
be super APLy or anything.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hex_to_binary</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃,</span><span class="na">/</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span><span class="o">⊤⊢</span><span class="p">)</span><span class="na">¨</span><span class="p">(</span><span class="m">¯1</span><span class="o">+</span><span class="p">(</span><span class="nf">⎕D</span><span class="o">,</span><span class="nf">⎕A</span><span class="p">)</span><span class="o">⍳⊢</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">data16</span><span class="kd">←</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day16-input.txt&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">805311100469800804A3E488ACC0B10055D8009548874F65665AD42F60073E7338E7E5C538D8201


      14AEA1A19927797976F8F43CD7354D66747B3005B401397C6CBA2FCEEE7AACDECC017938B


      3F802E000854488F70FC401F8BD09E199005B3600BCBFEEE12FFBB84FC8466B515E92B79B


      1003C797AEBAF53917E99FF2E953D0D284359CA0CB80193D12B3005B4017968D77EB224B4


      6BBF591E7BEBD2FA00100622B4ED64773D0CF7816600B68020000874718E715C0010D8AF1


      E61CC946FB99FC2C20098275EBC0109FA14CAEDC20EB8033389531AAB14C72162492DE33A


      E0118012C05EEB801C0054F880102007A01192C040E100ED20035DA8018402BE20099A002


      0CB801AE0049801E800DD10021E4002DC7D30046C0160004323E42C8EA200DC5A87D06250


      C50015097FB2CFC93A101006F532EB600849634912799EF7BF609270D0802B59876F00424


      6941091A5040402C9BD4DF654967BFDE4A6432769CED4EC3C4F04C000A895B8E98013246A


      6016CB3CCC94C9144A03CFAB9002033E7B24A24016DD802933AFAE48EAA3335A632013BC4


      01D8850863A8803D1C61447A00042E3647B83F313674009E6533E158C3351F94C9902803D


      35C869865D564690103004E74CB001F39BEFFAAD37DFF558C012D005A5A9E851D25F76DD8


      8A5F4BC600ACB6E1322B004E5FE1F2FF0E3005EC017969EB7AE4D1A53D07B918C0B1802F0


      88B2C810326215CCBB6BC140C0149EE87780233E0D298C33B008C52763C9C94BF8DC88650


      4E1ECD4E75C7E4EA00284180371362C44320043E2EC258F24008747785D10C001039F8064


      4F201217401500043A2244B8D200085C3F8690BA78F08018394079A7A996D200806647A49


      E249C675C0802609D66B004658BA7F1562500366279CCBEB2600ACCA6D802C00085C658BD


      1DC401A8EB136100

</span></div></div>
</div>
<p>Now we have to write a bunch of packet parsers operating on bit arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_packet</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ split off 3 bit version, 3 bit type, and remaining bits</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">bits</span><span class="kd">←</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="o">⊂</span><span class="bp">⍵</span>
  <span class="c1">⍝ dispatch to parsers for types given in part 1</span>
  <span class="nv">type</span><span class="o">≡</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="bp">:</span><span class="nv">parse_literal</span> <span class="nv">version</span> <span class="nv">bits</span>
  <span class="nv">length_type</span><span class="kd">←</span><span class="m">1</span><span class="o">↑</span><span class="nv">bits</span>
  <span class="c1">⍝ operator length_type 0: 15-bit subpacket length in bits</span>
  <span class="nv">length_type</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span><span class="nv">parse_operator_length</span> <span class="nv">version</span> <span class="nv">type</span><span class="p">(</span><span class="m">2</span><span class="o">⊥</span><span class="p">(</span><span class="m">15</span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">bits</span><span class="p">)))(</span><span class="m">16</span><span class="o">↓</span><span class="nv">bits</span><span class="p">)</span>
  <span class="c1">⍝ operator length_type 1: 11-bit subpacket count</span>
  <span class="nv">parse_operator_count</span> <span class="nv">version</span> <span class="nv">type</span><span class="p">(</span><span class="m">2</span><span class="o">⊥</span><span class="p">(</span><span class="m">11</span><span class="o">↑</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">bits</span><span class="p">)))(</span><span class="m">12</span><span class="o">↓</span><span class="nv">bits</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Literals don’t nest and use a simple group encoding. We return the total length
because they go inside other packets that need to skip over them after parsing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_literal</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ returns (#bits (&#39;literal&#39; version value))</span>
  <span class="nv">version</span> <span class="nv">bits</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="c1">⍝ 5-bit groups up to one starting with 0</span>
  <span class="nv">length</span><span class="kd">←</span><span class="m">5</span><span class="o">×</span><span class="p">(((</span><span class="o">⍴</span><span class="nv">bits</span><span class="p">)</span><span class="o">⍴</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="na">/</span><span class="nv">bits</span><span class="p">)</span><span class="o">⍳</span><span class="m">0</span>
  <span class="nv">value</span><span class="kd">←</span><span class="p">(</span><span class="nv">length</span><span class="o">⍴</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span><span class="na">/</span><span class="nv">length</span><span class="o">↑</span><span class="nv">bits</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;literal&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">value</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Length operators slurp up to length bits of nested subpackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_operator_length</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ returns (#bits (&#39;operator&#39; version type subpackets))</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">length</span> <span class="nv">bits</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">subpackets</span><span class="kd">←</span><span class="kt">{</span>
    <span class="bp">⍵</span><span class="o">=</span><span class="nv">length</span><span class="bp">:</span><span class="no">⍬</span>
    <span class="nv">sublength</span> <span class="nv">packet</span><span class="kd">←</span><span class="nv">parse_packet</span> <span class="bp">⍵</span><span class="o">↓</span><span class="nv">bits</span>
    <span class="p">(</span><span class="o">⊂</span><span class="nv">packet</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="bp">∇</span><span class="p">(</span><span class="nv">sublength</span><span class="o">+</span><span class="bp">⍵</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="m">1</span><span class="o">+</span><span class="m">15</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;operator&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">type</span><span class="p">)(</span><span class="nv">subpackets</span> <span class="m">0</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>And count operators slurp up to count nested subpackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_operator_count</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ returns (#bits (&#39;operator&#39; version type subpackets))</span>
  <span class="nv">version</span> <span class="nv">type</span> <span class="nv">count</span> <span class="nv">bits</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">length</span><span class="kd">←</span><span class="m">0</span>
  <span class="nv">subpackets</span><span class="kd">←</span><span class="kt">{</span>
    <span class="m">0</span><span class="o">=</span><span class="bp">⍵:</span><span class="no">⍬</span>
    <span class="nv">sublength</span> <span class="nv">packet</span><span class="kd">←</span><span class="nv">parse_packet</span> <span class="nv">length</span><span class="o">↓</span><span class="nv">bits</span>
    <span class="nv">length</span><span class="o">+</span><span class="kd">←</span><span class="nv">sublength</span>
    <span class="p">(</span><span class="o">⊂</span><span class="nv">packet</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="bp">∇</span><span class="p">(</span><span class="bp">⍵</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="p">((</span><span class="m">6</span><span class="o">+</span><span class="m">1</span><span class="o">+</span><span class="m">11</span><span class="o">+</span><span class="nv">length</span><span class="p">)(</span><span class="s1">&#39;operator&#39;</span><span class="p">(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">version</span><span class="p">)(</span><span class="m">2</span><span class="o">⊥</span><span class="nv">type</span><span class="p">)(</span><span class="nv">subpackets</span> <span class="nv">count</span><span class="p">)))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id29">
<h3>Part 1<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>We’re supposed to add up “version” fields in each nested packet to prove
that we are parsing correctly I guess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">version_sum</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">version</span><span class="kd">←</span><span class="m">2</span><span class="o">⌷</span><span class="bp">⍵</span>  <span class="c1">⍝ version is always at index 2</span>
  <span class="p">(</span><span class="m">1</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">≡⊂</span><span class="s1">&#39;operator&#39;</span><span class="bp">:</span><span class="nv">version</span><span class="o">++</span><span class="na">/</span><span class="bp">∇</span><span class="na">¨</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">4</span><span class="sr">]</span><span class="p">)</span>
  <span class="nv">version</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;C0015000016115A2E0802F182340&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">23
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;A0016C880162017C3686B18A3D4780&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">31
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;620080001611562C8802118E34&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">12
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span><span class="s1">&#39;8A004A801A8002F478&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_1</span><span class="kd">←</span><span class="kt">{</span><span class="nv">version_sum</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_1</span> <span class="nv">data16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">971
</span></div></div>
</div>
</div>
<div class="section" id="id30">
<h3>Part 2<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>Now we get to write an expression evaluator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">evaluate</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ literals evaluate to fixed value</span>
  <span class="p">(</span><span class="m">1</span><span class="o">⌷</span><span class="bp">⍵</span><span class="p">)</span><span class="o">≡⊂</span><span class="s1">&#39;literal&#39;</span><span class="bp">:</span><span class="m">3</span><span class="o">⌷</span><span class="bp">⍵</span>
  <span class="c1">⍝ everything else is an operator</span>
  <span class="nv">values</span><span class="kd">←</span><span class="nv">evaluate</span><span class="na">¨</span><span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="sr">[</span><span class="m">4</span><span class="sr">]</span><span class="p">)</span>
  <span class="nv">type</span><span class="kd">←</span><span class="m">3</span><span class="o">⌷</span><span class="bp">⍵</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">0</span><span class="bp">:</span><span class="o">+</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">1</span><span class="bp">:</span><span class="o">×</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">2</span><span class="bp">:</span><span class="o">⌊</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">3</span><span class="bp">:</span><span class="o">⌈</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">5</span><span class="bp">:</span><span class="o">&gt;</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">6</span><span class="bp">:</span><span class="o">&lt;</span><span class="na">/</span><span class="nv">values</span>
  <span class="nv">type</span><span class="o">=</span><span class="m">7</span><span class="bp">:</span><span class="o">=</span><span class="na">/</span><span class="nv">values</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span><span class="kd">←</span><span class="kt">{</span><span class="nv">evaluate</span> <span class="m">2</span><span class="o">⊃</span><span class="nv">parse_packet</span> <span class="nv">hex_to_binary</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span><span class="na">¨</span><span class="s1">&#39;C200B40A82&#39;</span> <span class="s1">&#39;04005AC33890&#39;</span> <span class="s1">&#39;880086C3E88112&#39;</span> <span class="s1">&#39;CE00C43D881120&#39;</span> <span class="s1">&#39;D8005AC2A8F0&#39;</span> <span class="s1">&#39;F600BC2D8F&#39;</span> <span class="s1">&#39;9C005AC2F8F0&#39;</span> <span class="s1">&#39;9C0141080250320F1802104A08&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 54 7 9 1 0 0 1
</span></div></div>
</div>
<p>The examples seem to work ok. This is pretty convenient and we
could probably represent the tree as an APL expression instead, and
use ⍎. Not for the first time I’m wondering if they had APL on the
brain this year…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day16_2</span> <span class="nv">data16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">831996589851
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-17">
<h2>Day 17<a class="headerlink" href="#day-17" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/17">Puzzle link</a></p>
<p>Today the input is just 4 numbers so I’m going to type it in manually, being careful to use the unary ¯ instead of -.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test17</span><span class="kd">←</span><span class="m">20</span> <span class="m">30</span> <span class="m">¯10</span> <span class="m">¯5</span>  <span class="c1">⍝ xmin..xmax ymin..ymax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data17</span><span class="kd">←</span><span class="m">240</span> <span class="m">292</span> <span class="m">¯90</span> <span class="m">¯57</span>
</pre></div>
</div>
</div>
</div>
<p>We are doing something with trajectories, which we will represent as
2d arrays with one row per step. The current state is a 4-tuple x y vx vy
in the last row that updates like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">step_projectile</span><span class="kd">←</span><span class="kt">{</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">←</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span> <span class="o">⍪</span> <span class="p">((</span><span class="nv">x</span><span class="o">+</span><span class="nv">vx</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span><span class="o">+</span><span class="nv">vy</span><span class="p">)</span> <span class="p">(</span><span class="nv">vx</span><span class="o">-×</span><span class="nv">vx</span><span class="p">)</span> <span class="p">(</span><span class="nv">vy</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll iterate this until we’ve flown past the target. Since vy decreases
monotonically and the target is below the x-axis, we’ll just say that
happens when y &lt; ymin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">trajectory</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">←</span><span class="bp">⍺</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">past_target</span><span class="kd">←</span><span class="kt">{</span><span class="nv">_</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">←</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="nv">y</span><span class="o">&lt;</span><span class="nv">ymin</span><span class="p">)</span><span class="kt">}</span>
  <span class="p">(</span><span class="nv">step_projectile</span><span class="na">⍣</span><span class="nv">past_target</span><span class="p">)</span><span class="m">1</span> <span class="m">4</span><span class="o">⍴</span><span class="m">0</span> <span class="m">0</span> <span class="nv">vx</span> <span class="nv">vy</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span> <span class="m">2</span> <span class="nv">trajectory</span> <span class="m">20</span> <span class="m">30</span> <span class="m">¯10</span> <span class="m">¯5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 0   0 7  2
 7   2 6  1
13   3 5  0
18   3 4 ¯1
22   2 3 ¯2
25   0 2 ¯3
27  ¯3 1 ¯4
28  ¯7 0 ¯5
28 ¯12 0 ¯6
28 ¯18 0 ¯7
</span></div></div>
</div>
<div class="section" id="id31">
<h3>Part 1<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>We’ll just search velocities to find the best one. The target is to the
right so we want 0 &lt; vx ≤ xmax. Also ymin ≤ vy since any lower would go
past immediately, and vy ≤ xmax since we get at most xmax x steps and vy
only decreases by 1 each step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day17_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="c1">⍝ returns 1 if point is in target, else 0</span>
  <span class="nv">in_target</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">x</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="nv">x</span><span class="o">≥</span><span class="nv">xmin</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">x</span><span class="o">≤</span><span class="nv">xmax</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">y</span><span class="o">≥</span><span class="nv">ymin</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">y</span><span class="o">≤</span><span class="nv">ymax</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">⍝ tries trajectory vx vy, returns max height if hits target else 0</span>
  <span class="nv">trial</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">points</span><span class="kd">←</span><span class="nv">vx</span> <span class="nv">vy</span> <span class="nv">trajectory</span> <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span>
    <span class="nv">hit</span><span class="kd">←</span><span class="o">∨</span><span class="na">/</span><span class="p">(</span><span class="nv">in_target</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="nv">points</span>
    <span class="nv">hit</span><span class="bp">:</span><span class="m">2</span><span class="o">⌷⌈</span><span class="na">⌿</span><span class="nv">points</span>
    <span class="m">0</span>
  <span class="kt">}</span>
  <span class="o">⌈</span><span class="na">/</span><span class="o">,</span><span class="nv">trial</span><span class="na">¨</span><span class="o">⍳</span><span class="nv">xmax</span> <span class="nv">xmax</span>  <span class="c1">⍝ not quite enough range but works for part 1</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_1</span> <span class="nv">test17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">45
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ day17_1 data17  ⍝ embarrassingly slow</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id32">
<h3>Part 2<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>Now we want all the velocities. This is sorta simpler actually…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day17_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="c1">⍝ returns 1 if point is in target, else 0</span>
  <span class="nv">in_target</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">x</span> <span class="nv">y</span> <span class="nv">_</span> <span class="nv">_</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="nv">x</span><span class="o">≥</span><span class="nv">xmin</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">x</span><span class="o">≤</span><span class="nv">xmax</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">y</span><span class="o">≥</span><span class="nv">ymin</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="nv">y</span><span class="o">≤</span><span class="nv">ymax</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">⍝ returns 1 if trajectory with initial velocity vx vy hits target else 0</span>
  <span class="nv">trial</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">vx</span> <span class="nv">vy</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">points</span><span class="kd">←</span><span class="nv">vx</span> <span class="nv">vy</span> <span class="nv">trajectory</span> <span class="nv">xmin</span> <span class="nv">xmax</span> <span class="nv">ymin</span> <span class="nv">ymax</span>
    <span class="o">∨</span><span class="na">/</span><span class="p">(</span><span class="nv">in_target</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="nv">points</span>
  <span class="kt">}</span>
  <span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="nv">trial</span><span class="na">¨</span><span class="p">(</span><span class="o">⍳</span><span class="nv">xmax</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">xmax</span><span class="o">+|</span><span class="nv">ymin</span><span class="p">))</span><span class="o">-⊂</span><span class="m">0</span><span class="p">(</span><span class="o">|</span><span class="nv">ymin</span><span class="o">-</span><span class="m">1</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_2</span> <span class="nv">test17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">112
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day17_2</span> <span class="nv">data17</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INTERRUPT
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-18">
<h2>Day 18<a class="headerlink" href="#day-18" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/18">Puzzle link</a></p>
<p>We get to do arithmetic with “snailfish numbers” aka nested pairs.
This involves a bunch of scanning “left” and “right” so it’s going to
be simpler just to treat them as strings than to bother parsing.
I did try, but gave up when Dyalog crashed with error 139 or something
while I was trying to debug a basic tree traversal - you get what you
pay for, I guess.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test18</span><span class="kd">←</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day18-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data18</span><span class="kd">←</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day18-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>Adding a and b is just concatenating</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add_snailfish</span><span class="kd">←</span><span class="kt">{</span><span class="s1">&#39;[&#39;</span><span class="o">,</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;,&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="o">,</span><span class="s1">&#39;]&#39;</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;[1,2]&#39;</span> <span class="nv">add_snailfish</span> <span class="s1">&#39;[[3,4],5]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[[1,2],[[3,4],5]]
</span></div></div>
</div>
<p>But then reducing involves a bunch of hoo-ha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">explode</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">start</span><span class="kd">←</span><span class="p">((</span><span class="o">+</span><span class="na">\</span><span class="p">(</span><span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;[&#39;</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="bp">⍵</span><span class="o">=</span><span class="s1">&#39;]&#39;</span><span class="p">))</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="o">⍳</span><span class="m">1</span>  <span class="c1">⍝ start of first pair to explode</span>
  <span class="nv">start</span><span class="o">&gt;≢</span><span class="bp">⍵:⍵</span>                       <span class="c1">⍝ if none, no need to explode</span>
  <span class="nv">len</span><span class="kd">←</span><span class="p">(</span><span class="nv">start</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍳</span><span class="s1">&#39;]&#39;</span>                <span class="c1">⍝ end of first pair</span>
  <span class="nv">a</span> <span class="nv">b</span><span class="kd">←</span><span class="o">⍎</span><span class="p">(</span><span class="nv">len</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">↑</span><span class="p">(</span><span class="nv">start</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span>           <span class="c1">⍝ get numbers a b in pair</span>
  <span class="c1">⍝ add a to rightmost in left substring</span>
  <span class="nv">add_to_left</span><span class="kd">←</span><span class="kt">{</span>
    <span class="p">(</span><span class="o">⍕</span><span class="p">(</span><span class="nv">a</span><span class="o">+⍎</span><span class="p">(</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↑</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="p">)))</span><span class="o">,</span><span class="p">(</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↓</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">⍝ add b to leftmost in right substring</span>
  <span class="nv">add_to_right</span><span class="kd">←</span><span class="kt">{</span>
    <span class="p">(</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Offsets</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↑</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="p">)</span><span class="o">,⍕</span><span class="p">(</span><span class="nv">b</span><span class="o">+⍎</span><span class="p">(</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Offsets</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↓</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="p">))</span>
  <span class="kt">}</span>
  <span class="c1">⍝ form new left, right substrings</span>
  <span class="nv">left</span><span class="kd">←</span><span class="p">(</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="nf">⎕R</span> <span class="nv">add_to_left</span><span class="p">)</span><span class="o">⊢</span><span class="p">(</span><span class="nv">start</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍵</span>
  <span class="nv">right</span><span class="kd">←</span><span class="p">(</span><span class="s1">&#39;^[^\d]*(\d+)&#39;</span><span class="nf">⎕R</span> <span class="nv">add_to_right</span><span class="p">)</span><span class="o">⊢</span><span class="p">(</span><span class="nv">start</span><span class="o">+</span><span class="nv">len</span><span class="p">)</span><span class="o">↓</span><span class="bp">⍵</span>
  <span class="nv">left</span><span class="o">,</span><span class="s1">&#39;0&#39;</span><span class="o">,</span><span class="nv">right</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[[[[9,8],1],2],3],4]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[0,9],2],3],4]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[7,[6,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[7,[6,[5,[7,0]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[6,[5,[4,[3,2]]]],1]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[6,[5,[7,0]]],3]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">explode</span> <span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[3,[2,[8,0]]],[9,[5,[7,0]]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>The other hoo-ha operation in reducing is “split”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span><span class="kd">←</span><span class="s1">&#39;(\d\d+).*&#39;</span><span class="nf">⎕R</span><span class="kt">{</span><span class="nv">n</span><span class="kd">←</span><span class="o">⍎</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↑</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span> <span class="p">⋄</span> <span class="s1">&#39;[&#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕⌊</span><span class="nv">n</span><span class="o">÷</span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;,&#39;</span><span class="o">,</span><span class="p">(</span><span class="o">⍕⌈</span><span class="nv">n</span><span class="o">÷</span><span class="m">2</span><span class="p">)</span><span class="o">,</span><span class="s1">&#39;]&#39;</span><span class="o">,</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↓</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span> <span class="s1">&#39;10&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[5,5]
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">split</span> <span class="s1">&#39;11&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[5,6]
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">split</span> <span class="s1">&#39;[[[[0,7],4],[15,[0,13]]],[1,1]]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[0,7],4],[[7,8],[0,13]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">split</span> <span class="s1">&#39;[[[[0,7],4],[[7,8],[0,13]]],[1,1]]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[0,7],4],[[7,8],[0,[6,7]]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>To reduce, iterate explode and split.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">reduce</span><span class="kd">←</span><span class="p">(</span><span class="nv">split</span><span class="na">∘</span><span class="p">(</span><span class="nv">explode</span><span class="na">⍣</span><span class="o">≡</span><span class="p">))</span><span class="na">⍣</span><span class="o">≡</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">reduce</span> <span class="s1">&#39;[[[[[4,3],4],4],[7,[[8,4],9]]],[1,1]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">[[[[0,7],4],[[7,8],[6,0]]],[8,1]]
</span></div></div>
</div>
<p>Adding is folding (left) then reducing. APL’s fold is right-to-left
(because of course) so we need a helper for fold left. Note we have
to be careful to reduce after each addition because otherwise we might
end up with pairs nested more than 4 deep which breaks assumptions
in explode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add_reduce</span><span class="kd">←</span><span class="p">(</span><span class="nv">reduce</span> <span class="nv">add_snailfish</span><span class="p">)</span><span class="kt">{</span><span class="o">↑</span><span class="bp">⍺⍺</span><span class="na">⍨/</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="no">⍬</span><span class="kt">}</span><span class="o">⊢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[1,1],[2,2]],[3,3]],[4,4]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span> <span class="s1">&#39;[5,5]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[3,0],[5,3]],[4,4]],[5,5]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="s1">&#39;[1,1]&#39;</span> <span class="s1">&#39;[2,2]&#39;</span> <span class="s1">&#39;[3,3]&#39;</span> <span class="s1">&#39;[4,4]&#39;</span> <span class="s1">&#39;[5,5]&#39;</span> <span class="s1">&#39;[6,6]&#39;</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[5,0],[7,4]],[5,5]],[6,6]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">larger_example</span><span class="kd">←</span><span class="s1">&#39;[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]&#39;</span> <span class="s1">&#39;[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]&#39;</span> <span class="s1">&#39;[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]&#39;</span> <span class="s1">&#39;[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]&#39;</span> <span class="s1">&#39;[7,[5,[[3,8],[1,4]]]]&#39;</span> <span class="s1">&#39;[[2,[2,2]],[8,[8,1]]]&#39;</span> <span class="s1">&#39;[2,9]&#39;</span> <span class="s1">&#39;[1,[[[9,3],9],[[9,0],[0,7]]]]&#39;</span> <span class="s1">&#39;[[[5,[7,4]],7],1]&#39;</span> <span class="s1">&#39;[[[[4,2],2],6],[8,7]]&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add_reduce</span> <span class="nv">larger_example</span><span class="p">)</span><span class="o">≡</span><span class="s1">&#39;[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="section" id="id33">
<h3>Part 1<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>We’re supposed to multiply and add up the tree of pairs. If APL had operator
precedence, we could substute +2× for ‘,’ and so on and use ⍎. But it doesn’t,
so we have to build our own evaluator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">translate</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺⍺</span><span class="p">(</span><span class="bp">⍵⍵</span><span class="o">⌷</span><span class="na">⍨∘</span><span class="o">⊂⍳</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="o">∊</span><span class="na">∘</span><span class="bp">⍺⍺</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">parse_snailfish</span><span class="kd">←</span><span class="o">⍎</span><span class="s1">&#39;[],&#39;</span> <span class="nv">translate</span> <span class="s1">&#39;() &#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[9,1],[1,9]]&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┐
│9 1│1 9│
└───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">magnitude</span><span class="kd">←</span><span class="kt">{</span>
  <span class="m">0</span><span class="o">=≡</span><span class="bp">⍵:</span> <span class="bp">⍵</span>
  <span class="nv">left</span> <span class="nv">right</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="p">(</span><span class="m">3</span><span class="o">×</span><span class="p">(</span><span class="nv">magnitude</span> <span class="nv">left</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="m">2</span><span class="o">×</span><span class="p">(</span><span class="nv">magnitude</span> <span class="nv">right</span><span class="p">))</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">129</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[9,1],[1,9]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">143</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[1,2],[[3,4],5]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1384</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[0,7],4],[[7,8],[6,0]]],[8,1]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">445</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[1,1],[2,2]],[3,3]],[4,4]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">791</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[3,0],[5,3]],[4,4]],[5,5]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1137</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[5,0],[7,4]],[5,5]],[6,6]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">3488</span><span class="o">=</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="s1">&#39;[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Great, that all seems to work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span><span class="kd">←</span><span class="nv">magnitude</span><span class="p">(</span><span class="nv">parse_snailfish</span> <span class="p">(</span><span class="nv">add_reduce</span> <span class="o">⊢</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span> <span class="nv">test18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4140
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_1</span> <span class="nv">data18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3216
</span></div></div>
</div>
</div>
<div class="section" id="id34">
<h3>Part 2<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>Ok, find the largest magnitude for pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span><span class="kd">←</span><span class="o">⌈</span><span class="na">/</span><span class="o">,</span><span class="na">∘</span><span class="p">(</span><span class="na">∘.</span><span class="kt">{</span><span class="nv">day18_1</span> <span class="bp">⍺</span> <span class="bp">⍵</span><span class="kt">}</span><span class="na">⍨</span><span class="o">⊢</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span> <span class="nv">test18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3993
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day18_2</span> <span class="nv">data18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4643
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-19">
<h2>Day 19<a class="headerlink" href="#day-19" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/19">Puzzle link</a></p>
<p>Today we’ve got a bunch of cattywampus 3d scanners that separately measure
where some beacons are. We are gonna do a bunch of 3d transformations
so will want to turn the points into homogeneous coordinates.</p>
<p>All the “each” dots are super ugly today - I am sure there is a better way.
We have to be careful reading input because there is an extra newline
after each scanner’s data except the last.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test19</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="m">1</span><span class="kt">}</span><span class="na">¨¨</span><span class="o">⍎</span><span class="na">¨¨¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨¨</span><span class="kt">{{</span><span class="s1">&#39;&#39;</span><span class="o">≡⊃</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="bp">:</span> <span class="m">¯1</span><span class="o">↓</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="kt">}</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="kt">{</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="o">∊</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day19-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data19</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="m">1</span><span class="kt">}</span><span class="na">¨¨</span><span class="o">⍎</span><span class="na">¨¨¨</span><span class="s1">&#39;,&#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span><span class="na">¨¨</span><span class="kt">{{</span><span class="s1">&#39;&#39;</span><span class="o">≡⊃</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="bp">:</span> <span class="m">¯1</span><span class="o">↓</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="kt">}</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="kt">{</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="o">∊</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;day19-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>We will need to line some of the scanners’ coordinate frames up.
Each of 3 axes might be negated or not and there are 6 permutations
of axes. But half of those transformations turn the universe inside
out, so det M=1 filters out the 24 we want.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">permutations</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⍳</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">,</span><span class="sr">[</span><span class="o">⍳</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="o">⊢,</span><span class="na">⍤</span><span class="m">1</span> <span class="m">0</span><span class="o">~</span><span class="p">)</span><span class="na">⍤</span><span class="m">1</span><span class="p">)</span><span class="na">⍣</span><span class="bp">⍵</span><span class="o">⍉⍪</span><span class="no">⍬</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">det</span><span class="kd">←</span><span class="kt">{</span><span class="o">-</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="o">×</span><span class="na">/</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="m">2</span> <span class="m">3</span><span class="o">⍴</span><span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">0</span> <span class="m">2</span> <span class="m">1</span><span class="p">)</span><span class="o">⌽↑</span><span class="bp">⍵</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">orientations</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=</span><span class="p">(</span><span class="nv">det</span><span class="na">⍤</span><span class="m">2</span><span class="p">)</span><span class="bp">⍵</span><span class="p">)</span><span class="na">⌿</span><span class="bp">⍵</span><span class="kt">}</span><span class="o">↑↑</span><span class="kt">{</span><span class="o">×</span><span class="bp">⍵</span><span class="o">×</span><span class="p">(</span><span class="m">1</span><span class="o">-|</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⌽↑</span><span class="p">(</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span><span class="na">¨¨</span><span class="o">,</span><span class="p">(</span><span class="o">↓⍉</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="m">2</span><span class="o">×</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span> <span class="m">2</span><span class="o">⊤⍳</span><span class="m">8</span><span class="p">)))</span><span class="na">∘.</span><span class="o">×↓</span><span class="p">(</span><span class="nv">permutations</span> <span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">orientations</span><span class="kd">←</span><span class="o">↑</span><span class="kt">{</span><span class="p">((</span><span class="o">↑↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="m">0</span><span class="p">)</span><span class="o">⍪</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">↓↓</span><span class="nv">orientations</span>  <span class="c1">⍝ turn 3x3s into 4x4s</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll want the 4x4 identity matrix I4, and a helper to make
transformation matrices combining a translation and a rotation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">I4</span><span class="kd">←</span><span class="o">↑</span><span class="p">(</span><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">transform</span><span class="kd">←</span><span class="kt">{</span><span class="nv">p</span> <span class="nv">rmat</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">((</span><span class="m">¯1</span><span class="o">↓</span><span class="p">(</span><span class="o">↑</span><span class="nv">p</span><span class="p">))</span><span class="na">@</span><span class="p">(</span><span class="m">1</span> <span class="m">4</span><span class="p">)(</span><span class="m">2</span> <span class="m">4</span><span class="p">)(</span><span class="m">3</span> <span class="m">4</span><span class="p">))</span><span class="o">⊢</span><span class="nv">rmat</span><span class="kt">}</span>  <span class="c1">⍝ note ignore 4th of p</span>
</pre></div>
</div>
</div>
</div>
<p>To align two scanners, we guess which beacons i j are the same and
get points relative to that, also trying all rotations k of the second
scanner relative to the first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">align</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">scanner1</span> <span class="nv">scanner2</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">trial</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ count i j k up to corresponding array bounds</span>
    <span class="nv">none</span> <span class="nv">k</span> <span class="nv">j</span> <span class="nv">i</span><span class="kd">←</span><span class="p">(</span><span class="m">2</span><span class="p">(</span><span class="o">≢</span><span class="nv">orientations</span><span class="p">)(</span><span class="o">≢⊃</span><span class="nv">scanner2</span><span class="p">)(</span><span class="o">≢⊃</span><span class="nv">scanner1</span><span class="p">)</span><span class="o">⊤</span><span class="bp">⍵</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">none</span><span class="bp">:</span><span class="m">0</span>  <span class="c1">⍝ no alignment possible</span>
    <span class="c1">⍝ u translates scanner1 points relative to point i</span>
    <span class="nv">u</span><span class="kd">←</span><span class="nv">transform</span><span class="p">(</span><span class="o">-</span><span class="nv">i</span><span class="o">⌷⊃</span><span class="nv">scanner1</span><span class="p">)</span><span class="nv">I4</span>
    <span class="c1">⍝ v translates scanner2 points relative to point j and rotates</span>
    <span class="c1">⍝ (note that point j must be rotated first)</span>
    <span class="nv">pj</span><span class="kd">←</span><span class="o">⍉</span><span class="nv">k</span><span class="o">⌷</span><span class="nv">orientations</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="o">⍉↑</span><span class="nv">j</span><span class="o">⌷⊃</span><span class="nv">scanner2</span><span class="p">)</span>
    <span class="nv">v</span><span class="kd">←</span><span class="nv">transform</span><span class="p">(</span><span class="o">-</span><span class="nv">pj</span><span class="p">)(</span><span class="nv">k</span><span class="o">⌷</span><span class="nv">orientations</span><span class="p">)</span>
    <span class="nv">scanner1_p</span><span class="kd">←</span><span class="o">↓↑</span><span class="kt">{</span><span class="o">⍉</span><span class="nv">u</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="o">⍉↑</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">scanner1</span>
    <span class="nv">scanner2_p</span><span class="kd">←</span><span class="o">↓↑</span><span class="kt">{</span><span class="o">⍉</span><span class="nv">v</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="o">⍉↑</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">scanner2</span>
    <span class="c1">⍝ count transformed point matches</span>
    <span class="nv">num_matches</span><span class="kd">←</span><span class="nv">scanner1_p</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">∊</span><span class="p">)</span><span class="nv">scanner2_p</span>
    <span class="nv">num_matches</span><span class="o">≥</span><span class="m">12</span><span class="bp">:</span><span class="p">(</span><span class="o">⌹</span><span class="nv">u</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="nv">v</span><span class="p">)</span>  <span class="c1">⍝ transform from 2-&gt;1 frame</span>
    <span class="bp">∇</span><span class="p">(</span><span class="bp">⍵</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="nv">trial</span> <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">align</span> <span class="p">(</span><span class="m">1</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯1 0  0    68
 0 1  0 ¯1246
 0 0 ¯1   ¯43
 0 0  0     1
</span></div></div>
</div>
<p>align returns a transformation matrix that maps back to scanner1’s frame.
For example, the 10th beacon in scanner1’s list is the same as the 1st
beacon in scanner2’s list, so multiplying the result matrix canonicalizes
to scanner1’s frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="o">⌷⊃</span><span class="p">(</span><span class="m">1</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌────────────────┐
│¯618 ¯824 ¯621 1│
└────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍉</span><span class="p">((</span><span class="nv">align</span> <span class="p">(</span><span class="m">1</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)))</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="o">⍉↑</span><span class="p">(</span><span class="m">1</span><span class="o">⌷⊃</span><span class="p">(</span><span class="m">2</span><span class="o">⌷</span><span class="nv">test19</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">¯618 ¯824 ¯621 1
</span></div></div>
</div>
<p>Then we can just search to figure out the relative positions of all the probes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">align_all</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">done</span><span class="kd">←</span><span class="m">1</span><span class="o">⍴</span><span class="m">1</span>              <span class="c1">⍝ indices that are done</span>
  <span class="nv">todo</span><span class="kd">←</span><span class="m">1</span><span class="o">↓⍳≢</span><span class="nv">scanners</span>     <span class="c1">⍝ indices left todo</span>
  <span class="nv">mats</span><span class="kd">←</span><span class="kt">{</span><span class="nv">I4</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳≢</span><span class="nv">scanners</span>  <span class="c1">⍝ transform to canonical frame</span>
  <span class="c1">⍝ match a scanner from todo with one from done</span>
  <span class="nv">find_pair</span><span class="kd">←</span><span class="kt">{</span>
    <span class="c1">⍝ iterate i j over todo and done</span>
    <span class="nv">none</span> <span class="nv">j</span> <span class="nv">i</span><span class="kd">←</span><span class="p">(</span><span class="m">2</span><span class="p">(</span><span class="o">≢</span><span class="nv">done</span><span class="p">)(</span><span class="o">≢</span><span class="nv">todo</span><span class="p">)</span><span class="o">⊤</span><span class="bp">⍵</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span> <span class="m">1</span><span class="p">)</span>
    <span class="nv">none</span><span class="bp">:</span><span class="s1">&#39;error&#39;</span>
    <span class="nv">ith</span> <span class="nv">jth</span><span class="kd">←</span><span class="p">(</span><span class="nv">i</span><span class="o">⌷</span><span class="nv">todo</span><span class="p">)(</span><span class="nv">j</span><span class="o">⌷</span><span class="nv">done</span><span class="p">)</span>
    <span class="c1">⍝ try aligning scanner i with j</span>
    <span class="nv">r</span><span class="kd">←</span><span class="nv">align</span><span class="p">(</span><span class="nv">jth</span><span class="o">⌷</span><span class="nv">scanners</span><span class="p">)(</span><span class="nv">ith</span><span class="o">⌷</span><span class="nv">scanners</span><span class="p">)</span>
    <span class="nv">r</span><span class="o">≡</span><span class="m">0</span><span class="bp">:∇</span><span class="p">(</span><span class="bp">⍵</span><span class="o">+</span><span class="m">1</span><span class="p">)</span>  <span class="c1">⍝ no alignment, iterate</span>
    <span class="c1">⍝ update transform for scanner i</span>
    <span class="nv">mats</span><span class="sr">[</span><span class="nv">ith</span><span class="sr">]</span><span class="kd">←</span><span class="o">⊂</span><span class="p">(</span><span class="o">⊃</span><span class="nv">mats</span><span class="sr">[</span><span class="nv">jth</span><span class="sr">]</span><span class="p">)</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="nv">r</span>
    <span class="c1">⍝ mark scanner i done</span>
    <span class="nv">done</span><span class="o">,</span><span class="kd">←</span><span class="nv">todo</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span>
    <span class="nv">todo</span><span class="o">⊢</span><span class="kd">←</span><span class="p">((</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">↑</span><span class="nv">todo</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="nv">i</span><span class="o">↓</span><span class="nv">todo</span><span class="p">)</span>
    <span class="nv">search</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="c1">⍝ search until all scanners are done</span>
  <span class="nv">search</span><span class="kd">←</span><span class="kt">{</span>
    <span class="m">0</span><span class="o">=≢</span><span class="nv">todo</span><span class="bp">:</span><span class="nv">mats</span>
    <span class="nv">find_pair</span> <span class="m">0</span>
  <span class="kt">}</span>
  <span class="nv">search</span> <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id35">
<h3>Part 1<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>How many beacons are there total? We can just find all the transforms,
and then collect unique positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day19_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">mats</span><span class="kd">←</span><span class="nv">align_all</span> <span class="nv">scanners</span>
  <span class="o">≢∪⊃,</span><span class="na">/</span><span class="kt">{</span>
    <span class="nv">r</span><span class="kd">←</span><span class="o">⊃</span><span class="nv">mats</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
    <span class="nv">beacons</span><span class="kd">←</span><span class="o">⊃</span><span class="nv">scanners</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
    <span class="o">↓↑</span><span class="kt">{</span><span class="o">⍉</span><span class="nv">r</span><span class="o">+</span><span class="na">.</span><span class="o">×</span><span class="p">(</span><span class="o">⍉↑</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="nv">beacons</span>
  <span class="kt">}</span><span class="na">¨</span><span class="o">⍳≢</span><span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day19_1</span> <span class="nv">test19</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">79
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝day19_1 data19  ⍝ this is extremely... slow...</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id36">
<h3>Part 2<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>Find the max distance between two scanners. We can get this from their
transformation matrices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day19_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">scanners</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">mats</span><span class="kd">←</span><span class="nv">align_all</span> <span class="nv">scanners</span>
  <span class="nv">origins</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="p">(</span><span class="m">1</span> <span class="m">4</span><span class="p">)</span> <span class="p">(</span><span class="m">2</span> <span class="m">4</span><span class="p">)</span> <span class="p">(</span><span class="m">3</span> <span class="m">4</span><span class="p">)</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="nv">mats</span>
  <span class="o">⌈</span><span class="na">/</span><span class="o">,</span><span class="na">∘.</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">|</span><span class="bp">⍺</span><span class="o">-</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍨</span><span class="nv">origins</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day19_2</span> <span class="nv">test19</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3621
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝day19_2 data19  ⍝ very... very... slow</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="day-20">
<h2>Day 20<a class="headerlink" href="#day-20" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/20">Puzzle link</a></p>
<p>Ok, this one seems made for APL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span><span class="kd">←</span><span class="s1">&#39;#&#39;</span><span class="na">∘</span><span class="o">=</span><span class="na">¨</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day20-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test20_bitmap</span><span class="kd">←</span><span class="o">↑</span><span class="s1">&#39;#&#39;</span><span class="na">∘</span><span class="o">=</span><span class="na">¨</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day20-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 0 1 0
1 0 0 0 0
1 1 0 0 1
0 0 1 0 0
0 0 1 1 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span><span class="kd">←</span><span class="s1">&#39;#&#39;</span><span class="na">∘</span><span class="o">=</span><span class="na">¨</span><span class="o">⊃⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day20-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_bitmap</span><span class="kd">←</span><span class="o">↑</span><span class="s1">&#39;#&#39;</span><span class="na">∘</span><span class="o">=</span><span class="na">¨</span><span class="m">2</span><span class="o">↓⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day20-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>To enhance, we could just use the stencil operator with its default padding.
But trickly the input lookup maps index 0 to 1, so the array should be
1-padded on odd iterations!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">enhance_even</span><span class="kd">←</span><span class="kt">{</span><span class="nv">k</span><span class="kd">←</span><span class="bp">⍺</span> <span class="p">⋄</span> <span class="p">(</span><span class="kt">{</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">⊥,</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">⊢</span><span class="p">)</span><span class="m">0</span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="o">⌽</span><span class="na">∘</span><span class="o">⍉</span><span class="na">⍣</span><span class="m">20</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">enhance_odd</span><span class="kd">←</span><span class="kt">{</span><span class="nv">k</span><span class="kd">←</span><span class="bp">⍺</span> <span class="p">⋄</span> <span class="m">¯4</span><span class="o">↓</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="m">¯4</span><span class="o">↓</span><span class="m">4</span><span class="o">↓</span><span class="m">4</span><span class="o">↓</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="p">(</span><span class="kt">{</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="m">2</span><span class="o">⊥,</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="o">⊢</span><span class="p">)</span><span class="nv">k</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="o">⌽</span><span class="na">∘</span><span class="o">⍉</span><span class="na">⍣</span><span class="m">20</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id37">
<h3>Part 1<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>Count 1s after enhancing twice (after once would be infinite!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day20_1</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">(</span><span class="bp">⍺</span> <span class="nv">enhance_odd</span> <span class="p">(</span><span class="bp">⍺</span> <span class="nv">enhance_even</span> <span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span> <span class="nv">day20_1</span> <span class="nv">test20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">35
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span> <span class="nv">day20_1</span> <span class="nv">data20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">5275
</span></div></div>
</div>
</div>
<div class="section" id="id38">
<h3>Part 2<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>Now enhance 50 times instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day20_2</span><span class="kd">←</span><span class="kt">{</span><span class="nv">k</span><span class="kd">←</span><span class="bp">⍺</span> <span class="p">⋄</span> <span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="p">(</span><span class="kt">{</span><span class="p">(</span><span class="nv">k</span> <span class="nv">enhance_odd</span> <span class="p">(</span><span class="nv">k</span> <span class="nv">enhance_even</span> <span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span><span class="na">⍣</span><span class="m">25</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test20_lookup</span> <span class="nv">day20_2</span> <span class="nv">test20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3351
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data20_lookup</span> <span class="nv">day20_2</span> <span class="nv">data20_bitmap</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">16482
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-21">
<h2>Day 21<a class="headerlink" href="#day-21" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/21">Puzzle link</a></p>
<p>We get to play with dice today. My first instinct was to pass a dice
closure to a simulation function, but APL doesn’t have first class functions.
So instead, I’ll think about the sequences of rolls for each player.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">6</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">⌿⍨</span><span class="m">0</span><span class="o">=</span><span class="bp">⍺</span><span class="o">|⍳≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="m">3</span><span class="o">+</span><span class="na">/</span><span class="m">1</span><span class="o">+</span><span class="m">100</span><span class="o">|⊢</span><span class="p">)((</span><span class="o">⍳</span><span class="m">306</span><span class="p">)</span><span class="o">-</span><span class="m">6</span><span class="p">)</span>  <span class="c1">⍝ player 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6 24 42 60 78 96 114 132 150 168 186 204 222 240 258 276 294 12 30 48 66 84 102

       120 138 156 174 192 210 228 246 264 282 200 18 36 54 72 90 108 126 144 1

      62 180 198 216 234 252 270 288
</span></div></div>
</div>
<p>This looks like just 6+18n (mod 300) where n is the turn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">300</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6 24 42 60 78 96 114 132 150 168 186 204 222 240 258 276 294 12 30 48 66 84 102

       120 138 156 174 192 210 228 246 264 282 300 18 36 54 72 90 108 126 144 1

      62 180 198 216 234 252 270 288
</span></div></div>
</div>
<p>To find score totals we could add that up mod 10 and add the start position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="m">4</span><span class="o">+</span><span class="m">10</span><span class="o">|+</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">⍝ 4 is start position</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 14 20 26 30 40 44 50 56 60 70 74 80 86 90 100 104 110 116 120 130 134 140 14

      6 150 160 164 170 176 180 190 194 200 206 210 220 224 230 236 240 250 254

       260 266 270 280 284 290 296 300
</span></div></div>
</div>
<p>But note that positions are cyclical with period 5 for player 1 and
10 for player 2, hmm. This is gonna be a little overcomplicated for
part 1, but why not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="p">(</span><span class="o">⊢+⊣×</span><span class="m">0</span><span class="o">=⊢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="m">4</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">⍝ player 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10 4 6 6 4 10

       4 6 6 4 10 4 6 6 4 10 4 6 6 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span><span class="p">(</span><span class="o">⊢+⊣×</span><span class="m">0</span><span class="o">=⊢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="m">8</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="m">15</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">50</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>  <span class="c1">⍝ player 2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8 3 6 7 6 3 8 1 2 1 8

       3 6 7 6 3 8 1 2 1 8
</span></div></div>
</div>
<p>I bet all the positions repeat every 10 turns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span><span class="kd">←</span><span class="kt">{</span><span class="nv">start</span> <span class="nv">offset</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="m">10</span><span class="p">(</span><span class="o">⊢+⊣×</span><span class="m">0</span><span class="o">=⊢</span><span class="p">)</span><span class="m">10</span><span class="o">|</span><span class="nv">start</span><span class="o">++</span><span class="na">\</span><span class="p">(</span><span class="nv">offset</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">10</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span> <span class="m">4</span> <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">10 4 6 6 4 10 4 6 6 4
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ten_turns</span> <span class="m">6</span> <span class="m">15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 4 5 4 1 6 9 10 9 6
</span></div></div>
</div>
<p>This suggests a way to compute the score for turn number n.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">score</span><span class="kd">←</span><span class="kt">{</span><span class="nv">seq</span> <span class="nv">n</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">(</span><span class="o">+</span><span class="na">\</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="nv">seq</span><span class="p">))</span><span class="sr">[</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="m">10</span><span class="o">|</span><span class="nv">n</span><span class="p">)</span><span class="sr">]</span><span class="o">+</span><span class="p">((</span><span class="o">⌊</span><span class="p">(</span><span class="nv">n</span><span class="o">÷</span><span class="m">10</span><span class="p">))</span><span class="o">×</span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="nv">seq</span><span class="p">))</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="m">4</span> <span class="m">6</span><span class="p">)</span> <span class="m">166</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">↑+</span><span class="na">\</span><span class="m">4</span><span class="o">+</span><span class="m">10</span><span class="o">|+</span><span class="na">\</span><span class="p">(</span><span class="m">6</span><span class="o">+</span><span class="p">(</span><span class="m">100</span><span class="o">|</span><span class="p">(</span><span class="m">18</span><span class="o">×</span><span class="p">(</span><span class="o">⍳</span><span class="m">166</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1000
</span></div></div>
</div>
<div class="section" id="id39">
<h3>Part 1<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>Find the winning turn.  We can just binary search… but I really
don’t want to write binary search.</p>
<p>TIL that Dyalog has a
<a class="reference external" href="https://aplwiki.com/wiki/Dfns_workspace">standard library</a>!
You can copy stuff out of the baked in ‘dfns’ workspace… that’s
kinda nice. Note that binary search takes a function as an
argument by actually being an “operator”, which is allowed to
operate on functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;bsearch&#39;</span><span class="nf">⎕CY</span><span class="s1">&#39;dfns&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day21_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="nv">start1</span> <span class="nv">start2</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">score1</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="nv">start1</span> <span class="m">6</span><span class="p">)</span> <span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">score2</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">score</span> <span class="p">(</span><span class="nv">ten_turns</span> <span class="nv">start2</span> <span class="m">15</span><span class="p">)</span> <span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>
  <span class="nv">max_turns</span><span class="kd">←</span><span class="m">1e12</span>
  <span class="nv">win1</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">score1</span> <span class="bp">⍵</span><span class="p">)</span><span class="o">≥</span><span class="m">1000</span><span class="kt">}</span> <span class="nv">bsearch</span> <span class="m">1</span> <span class="nv">max_turns</span>
  <span class="nv">win2</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">score2</span> <span class="bp">⍵</span><span class="p">)</span><span class="o">≥</span><span class="m">1000</span><span class="kt">}</span> <span class="nv">bsearch</span> <span class="m">1</span> <span class="nv">max_turns</span>
  <span class="nv">win1</span><span class="o">&lt;</span><span class="nv">win2</span><span class="bp">:</span> <span class="p">((</span><span class="m">6</span><span class="o">×</span><span class="p">(</span><span class="nv">win1</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="o">+</span><span class="m">3</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="nv">score2</span> <span class="p">(</span><span class="nv">win1</span><span class="o">-</span><span class="m">1</span><span class="p">))</span>  <span class="c1">⍝ p1 wins</span>
  <span class="p">(</span><span class="m">6</span><span class="o">×</span><span class="nv">win2</span><span class="p">)</span><span class="o">×</span><span class="p">(</span><span class="nv">score1</span> <span class="nv">win2</span><span class="p">)</span> <span class="c1">⍝ p2 wins</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_1</span> <span class="m">4</span> <span class="m">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">739785
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_1</span> <span class="m">8</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">518418
</span></div></div>
</div>
</div>
<div class="section" id="id40">
<h3>Part 2<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>Ok, now we have a quantum die, and have to count winning games.
This seems like a dynamic programming thing. We will tabulate
outcomes (#p1wins #p2wins), filling in backwards to avoid crazy
recursion.</p>
<p>I am going to use for loops, because it is easier to understand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">dirac_table</span><span class="kd">←</span><span class="m">2</span> <span class="m">10</span> <span class="m">21</span> <span class="m">10</span> <span class="m">21</span><span class="o">⍴</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span>  <span class="c1">⍝ to_play p1 p1_score+1 p2 p2_score+1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="sr">]</span><span class="nv">dinput</span>
 <span class="nv">r</span><span class="kd">←</span><span class="nv">tabulate_dirac_wins</span><span class="sr">;</span><span class="nv">to_play</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="nv">p1_n</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="nv">p2_n</span><span class="sr">;</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2_score</span><span class="sr">;</span><span class="nv">r1</span><span class="sr">;</span><span class="nv">r2</span><span class="sr">;</span><span class="nv">r3</span><span class="sr">;</span><span class="nv">outcome</span>
 <span class="nv">mod10</span><span class="kd">←</span><span class="kt">{</span><span class="m">10</span><span class="p">(</span><span class="o">⊢+⊣×</span><span class="m">0</span><span class="o">=⊢</span><span class="p">)(</span><span class="m">10</span><span class="o">|</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>
 <span class="bp">:</span><span class="nv">For</span> <span class="nv">p1_score</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⌽</span><span class="p">(</span><span class="o">⍳</span><span class="m">21</span><span class="p">)</span><span class="o">-</span><span class="m">1</span>
     <span class="bp">:</span><span class="nv">For</span> <span class="nv">p2_score</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⌽</span><span class="p">(</span><span class="o">⍳</span><span class="m">21</span><span class="p">)</span><span class="o">-</span><span class="m">1</span>
         <span class="bp">:</span><span class="nv">For</span> <span class="nv">p1</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">10</span>
             <span class="bp">:</span><span class="nv">For</span> <span class="nv">p2</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">10</span>
                 <span class="bp">:</span><span class="nv">For</span> <span class="nv">to_play</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">2</span>
                     <span class="bp">:</span><span class="nv">For</span> <span class="nv">r1</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">3</span>
                         <span class="bp">:</span><span class="nv">For</span> <span class="nv">r2</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">3</span>
                             <span class="bp">:</span><span class="nv">For</span> <span class="nv">r3</span> <span class="bp">:</span><span class="nv">In</span> <span class="o">⍳</span><span class="m">3</span>
                                 <span class="bp">:</span><span class="nv">If</span> <span class="nv">to_play</span><span class="o">=</span><span class="m">1</span>
                                     <span class="nv">p1_n</span><span class="kd">←</span><span class="nv">mod10</span><span class="p">(</span><span class="nv">p1</span><span class="o">+</span><span class="nv">r1</span><span class="o">+</span><span class="nv">r2</span><span class="o">+</span><span class="nv">r3</span><span class="p">)</span>
                                     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">p1_score</span><span class="o">+</span><span class="nv">p1_n</span><span class="p">)</span><span class="o">≥</span><span class="m">21</span>
                                         <span class="nv">outcome</span><span class="kd">←</span><span class="o">⊂</span><span class="m">1</span> <span class="m">0</span>
                                     <span class="bp">:</span><span class="nv">Else</span>
                                         <span class="nv">outcome</span><span class="kd">←</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">2</span><span class="sr">;</span><span class="nv">p1_n</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="o">+</span><span class="nv">p1_n</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="sr">]</span>
                                     <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="bp">:</span><span class="nv">Else</span> <span class="c1">⍝ to_play=2</span>
                                     <span class="nv">p2_n</span><span class="kd">←</span><span class="nv">mod10</span><span class="p">(</span><span class="nv">p2</span><span class="o">+</span><span class="nv">r1</span><span class="o">+</span><span class="nv">r2</span><span class="o">+</span><span class="nv">r3</span><span class="p">)</span>
                                     <span class="bp">:</span><span class="nv">If</span> <span class="p">(</span><span class="nv">p2_score</span><span class="o">+</span><span class="nv">p2_n</span><span class="p">)</span><span class="o">≥</span><span class="m">21</span>
                                         <span class="nv">outcome</span><span class="kd">←</span><span class="o">⊂</span><span class="m">0</span> <span class="m">1</span>
                                     <span class="bp">:</span><span class="nv">Else</span>
                                         <span class="nv">outcome</span><span class="kd">←</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2_n</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="o">+</span><span class="nv">p2_n</span><span class="sr">]</span>
                                     <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="bp">:</span><span class="nv">EndIf</span>
                                 <span class="nv">dirac_table</span><span class="sr">[</span><span class="nv">to_play</span><span class="sr">;</span><span class="nv">p1</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p1_score</span><span class="sr">;</span><span class="nv">p2</span><span class="sr">;</span><span class="m">1</span><span class="o">+</span><span class="nv">p2_score</span><span class="sr">]</span><span class="o">+</span><span class="kd">←</span><span class="nv">outcome</span>
                             <span class="bp">:</span><span class="nv">EndFor</span>
                         <span class="bp">:</span><span class="nv">EndFor</span>
                     <span class="bp">:</span><span class="nv">EndFor</span>
                 <span class="bp">:</span><span class="nv">EndFor</span>
             <span class="bp">:</span><span class="nv">EndFor</span>
         <span class="bp">:</span><span class="nv">EndFor</span>
     <span class="bp">:</span><span class="nv">EndFor</span>
 <span class="bp">:</span><span class="nv">EndFor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tabulate_dirac_wins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span><span class="kd">←</span><span class="kt">{</span><span class="nv">start1</span> <span class="nv">start2</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="o">⌈</span><span class="na">/</span><span class="o">⊃</span><span class="nv">dirac_table</span><span class="sr">[</span><span class="m">1</span><span class="sr">;</span><span class="nv">start1</span><span class="sr">;</span><span class="m">1</span><span class="sr">;</span><span class="nv">start2</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕PP</span><span class="kd">←</span><span class="m">16</span>  <span class="c1">⍝ big numbers</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span> <span class="m">4</span> <span class="m">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">444356092776315
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day21_2</span> <span class="m">8</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">116741133558209
</span></div></div>
</div>
</div>
</div>
<div class="section" id="day-22">
<h2>Day 22<a class="headerlink" href="#day-22" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://adventofcode.com/2021/day/22">Puzzle link</a></p>
<p>3d bitmap wrangling today.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">parse_cuboid</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ extract on/off and numbers from &#39;on x=-20..26,y=-36..17,z=-47..7&#39;</span>
  <span class="c1">⍝ return 0|1 xmin xmax ymin ymax zmin zmax</span>
  <span class="nv">xs</span><span class="kd">←</span><span class="s1">&#39; &#39;</span><span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)(</span><span class="s1">&#39;(on|off) x=(-?\d+)..(-?\d+),y=(-?\d+)..(-?\d+),z=(-?\d+)..(-?\d+)&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;\1 \2 \3 \4 \5 \6 \7&#39;</span><span class="p">)</span><span class="o">⊢</span><span class="bp">⍵</span>
  <span class="p">((</span><span class="o">⊃</span><span class="p">(</span><span class="m">1</span><span class="o">↑</span><span class="nv">xs</span><span class="p">))</span><span class="o">≡</span><span class="s1">&#39;on&#39;</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="m">1</span><span class="o">↓</span><span class="nv">xs</span><span class="p">)</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">test22</span><span class="kd">←</span><span class="nv">parse_cuboid</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day22-test.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────────────┬──────────────────────┬──────────────────────┬──────────
│1 ¯20 26 ¯36 17 ¯47 7│1 ¯20 33 ¯21 23 ¯26 28│1 ¯22 28 ¯29 23 ¯38 16│1 ¯46 7 ¯6
└─────────────────────┴──────────────────────┴──────────────────────┴──────────

      ──────────┬────────────────────┬────────────────────┬────────────────────
       46 ¯50 ¯1│1 ¯49 1 ¯3 46 ¯24 28│1 2 47 ¯22 22 ¯23 27│1 ¯27 23 ¯28 26 ¯21 
      ──────────┴────────────────────┴────────────────────┴────────────────────

      ──┬───────────────────┬─────────────────────┬──────────────────────┬─────
      29│1 ¯39 5 ¯6 47 ¯3 44│1 ¯30 21 ¯8 43 ¯13 34│1 ¯22 26 ¯27 20 ¯29 19│0 ¯48
      ──┴───────────────────┴─────────────────────┴──────────────────────┴─────

      ──────────────────┬────────────────────┬────────────────────────┬────────
       ¯32 26 41 ¯47 ¯37│1 ¯12 35 6 50 ¯50 ¯2│0 ¯48 ¯32 ¯32 ¯16 ¯15 ¯5│1 ¯18 26
      ──────────────────┴────────────────────┴────────────────────────┴────────

      ─────────────┬───────────────────────┬─────────────────────┬─────────────
       ¯33 15 ¯7 46│0 ¯40 ¯22 ¯38 ¯28 23 41│1 ¯16 35 ¯41 10 ¯47 6│0 ¯32 ¯23 11 
      ─────────────┴───────────────────────┴─────────────────────┴─────────────

      ────────┬─────────────────────┬────────────────────┬────────────────────┬
      30 ¯14 3│1 ¯49 ¯5 ¯3 45 ¯29 18│0 18 30 ¯20 ¯8 ¯3 13│1 ¯41 9 ¯7 43 ¯33 15│
      ────────┴─────────────────────┴────────────────────┴────────────────────┴

      ─────────────────────────────────────────┬───────────────────────────────
      1 ¯54112 ¯39298 ¯85059 ¯49293 ¯27449 7877│1 967 23432 45373 81175 27513 5
      ─────────────────────────────────────────┴───────────────────────────────

      ────┐
      3682│
      ────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data22</span><span class="kd">←</span><span class="nv">parse_cuboid</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day22-input.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id41">
<h3>Part 1<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>Count the “on” cubes in the volume ¯50≤x≤50, ¯50≤y≤50, ¯50≤z≤50.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day22_1</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ we&#39;ll make a big 3d bitmap and just count</span>
  <span class="nv">cubes</span><span class="kd">←</span><span class="m">101</span> <span class="m">101</span> <span class="m">101</span><span class="o">⍴</span><span class="m">0</span>
  <span class="nv">_</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">bit</span> <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="p">(</span><span class="nv">x1</span><span class="o">&lt;</span><span class="m">¯50</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">x0</span><span class="o">&gt;</span><span class="m">50</span><span class="p">)</span><span class="bp">:</span><span class="m">0</span>
    <span class="p">(</span><span class="nv">y1</span><span class="o">&lt;</span><span class="m">¯50</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">y0</span><span class="o">&gt;</span><span class="m">50</span><span class="p">)</span><span class="bp">:</span><span class="m">0</span>
    <span class="p">(</span><span class="nv">z1</span><span class="o">&lt;</span><span class="m">¯50</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">z0</span><span class="o">&gt;</span><span class="m">50</span><span class="p">)</span><span class="bp">:</span><span class="m">0</span>
    <span class="nv">cuboid</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="p">(</span><span class="m">50</span><span class="o">+</span><span class="nv">x0</span><span class="p">)(</span><span class="m">50</span><span class="o">+</span><span class="nv">y0</span><span class="p">)(</span><span class="m">50</span><span class="o">+</span><span class="nv">z0</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="o">⍳</span><span class="p">((</span><span class="nv">x1</span><span class="o">-</span><span class="nv">x0</span><span class="p">)</span><span class="o">+</span><span class="m">1</span><span class="p">)((</span><span class="nv">y1</span><span class="o">-</span><span class="nv">y0</span><span class="p">)</span><span class="o">+</span><span class="m">1</span><span class="p">)((</span><span class="nv">z1</span><span class="o">-</span><span class="nv">z0</span><span class="p">)</span><span class="o">+</span><span class="m">1</span><span class="p">))</span>
    <span class="nv">cubes</span><span class="o">⊢</span><span class="kd">←</span><span class="nv">bit</span><span class="na">@</span><span class="nv">cuboid</span><span class="o">⊢</span><span class="nv">cubes</span>
    <span class="m">0</span>
  <span class="kt">}</span><span class="na">¨</span><span class="bp">⍵</span>
  <span class="o">+</span><span class="na">/</span><span class="o">,</span><span class="nv">cubes</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day22_1</span> <span class="nv">test22</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">590784
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">day22_1</span> <span class="nv">data22</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">602574
</span></div></div>
</div>
</div>
<div class="section" id="id42">
<h3>Part 2<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>Count all the “on” cubes.  We get a new test case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">test22_2</span><span class="kd">←</span><span class="nv">parse_cuboid</span><span class="na">¨</span><span class="o">⊃</span><span class="nf">⎕NGET</span> <span class="s1">&#39;day22-test2.txt&#39;</span> <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↑</span><span class="p">(</span><span class="o">⌊</span><span class="na">/</span><span class="nv">test22_2</span><span class="p">)</span><span class="o">,⌈</span><span class="na">/</span><span class="nv">test22_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 ¯120100 ¯40997 ¯124565 ¯50804 ¯121762 ¯30197
1   55694 120875   50097 118853   54442 119054
</span></div></div>
</div>
<p>The volume is about 250k^3 which is too big for a bitmap.
We could compute new cuboids for each cuboid-cuboid union or
intersection, and keep a running list. Or we could do the
same for rectangles on 250k slices. But I’d prefer to use a
subdivision algorithm instead if at all possible so I don’t
have to think about all the weird cases.</p>
<p>We’ll need to intersect cuboids with aribtrary volumes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">intersect_cuboids_with_volume</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ all ranges are closed [x0,x1] [y0,y1] [z0,z1]</span>
  <span class="nv">vx0</span> <span class="nv">vx1</span> <span class="nv">vy0</span> <span class="nv">vy1</span> <span class="nv">vz0</span> <span class="nv">vz1</span> <span class="nv">cuboids</span><span class="kd">←</span><span class="bp">⍵</span>
  <span class="nv">rs</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">bit</span> <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="p">(</span><span class="nv">x1</span><span class="o">&lt;</span><span class="nv">vx0</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">x0</span><span class="o">&gt;</span><span class="nv">vx1</span><span class="p">)</span><span class="bp">:</span> <span class="m">0</span>
    <span class="p">(</span><span class="nv">y1</span><span class="o">&lt;</span><span class="nv">vy0</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">y0</span><span class="o">&gt;</span><span class="nv">vy1</span><span class="p">)</span><span class="bp">:</span> <span class="m">0</span>
    <span class="p">(</span><span class="nv">z1</span><span class="o">&lt;</span><span class="nv">vz0</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">z0</span><span class="o">&gt;</span><span class="nv">vz1</span><span class="p">)</span><span class="bp">:</span> <span class="m">0</span>
    <span class="c1">⍝ max start, min end per axis</span>
    <span class="nv">xs</span><span class="kd">←</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="nv">x0</span> <span class="nv">vx0</span><span class="p">)</span> <span class="p">(</span><span class="o">⌊</span><span class="na">/</span><span class="nv">x1</span> <span class="nv">vx1</span><span class="p">)</span>
    <span class="nv">ys</span><span class="kd">←</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="nv">y0</span> <span class="nv">vy0</span><span class="p">)</span> <span class="p">(</span><span class="o">⌊</span><span class="na">/</span><span class="nv">y1</span> <span class="nv">vy1</span><span class="p">)</span>
    <span class="nv">zs</span><span class="kd">←</span><span class="p">(</span><span class="o">⌈</span><span class="na">/</span><span class="nv">z0</span> <span class="nv">vz0</span><span class="p">)</span> <span class="p">(</span><span class="o">⌊</span><span class="na">/</span><span class="nv">z1</span> <span class="nv">vz1</span><span class="p">)</span>
    <span class="nv">bit</span><span class="o">,</span><span class="nv">xs</span><span class="o">,</span><span class="nv">ys</span><span class="o">,</span><span class="nv">zs</span>
  <span class="kt">}</span><span class="na">¨</span><span class="nv">cuboids</span>
  <span class="c1">⍝ filter only overlapping cuboids</span>
  <span class="p">(</span><span class="m">0</span><span class="na">∘</span><span class="o">≢</span><span class="na">¨</span><span class="nv">rs</span><span class="p">)</span><span class="na">/</span><span class="nv">rs</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">intersect_cuboids_with_volume</span> <span class="m">¯10</span> <span class="m">10</span> <span class="m">¯10</span> <span class="m">10</span> <span class="m">¯10</span> <span class="m">10</span> <span class="p">(</span><span class="o">⊂</span><span class="m">0</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────┐
│0 0 5 0 5 0 5│
└─────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">intersect_cuboids_with_volume</span> <span class="m">¯10</span> <span class="m">10</span> <span class="m">¯10</span> <span class="m">10</span> <span class="m">¯10</span> <span class="m">10</span> <span class="p">((</span><span class="m">0</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span><span class="p">)(</span><span class="m">1</span> <span class="m">11</span> <span class="m">15</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span><span class="p">)(</span><span class="m">1</span> <span class="m">9</span> <span class="m">15</span> <span class="m">0</span> <span class="m">5</span> <span class="m">0</span> <span class="m">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────┬──────────────┐
│0 0 5 0 5 0 5│1 9 10 0 5 0 5│
└─────────────┴──────────────┘
</span></div></div>
</div>
<p>To count cubes in a volume, consider the cuboids inside. If there are
none, there are 0 cubes. If there’s one, there are however many cubes
that has. If there are two or more cuboids, take the last, and sum the
count of cubes outside (recursively) and inside. Since it is the last
cuboid from the list, it takes precedence, so we don’t need to recurse
to count inside - the count is just its bit times its volume.</p>
<p>The recursion is error-prone and it took me a while to find some bugs
subdividing volumes! Stepping through simple examples was a big help.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">day22_2</span><span class="kd">←</span><span class="kt">{</span>
  <span class="c1">⍝ number of on cubes in a cuboid</span>
  <span class="nv">on_cubes</span><span class="kd">←</span><span class="kt">{</span><span class="nv">bit</span> <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="nv">bit</span><span class="o">×</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="nv">x1</span><span class="o">-</span><span class="nv">x0</span><span class="p">))</span><span class="o">×</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="nv">y1</span><span class="o">-</span><span class="nv">y0</span><span class="p">))</span><span class="o">×</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="p">(</span><span class="nv">z1</span><span class="o">-</span><span class="nv">z0</span><span class="p">))</span><span class="kt">}</span>
  <span class="nv">count</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span> <span class="nv">cs</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="m">0</span><span class="o">=≢</span><span class="nv">cs</span><span class="bp">:</span><span class="m">0</span>
    <span class="m">1</span><span class="o">=≢</span><span class="nv">cs</span><span class="bp">:</span><span class="nv">on_cubes</span> <span class="o">⊃</span><span class="nv">cs</span>
    <span class="c1">⍝ if two or more cuboids, partition on the last</span>
    <span class="nv">bit</span> <span class="nv">cx0</span> <span class="nv">cx1</span> <span class="nv">cy0</span> <span class="nv">cy1</span> <span class="nv">cz0</span> <span class="nv">cz1</span><span class="kd">←</span><span class="o">⊃</span><span class="p">(</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">cs</span><span class="p">)</span>
    <span class="nv">cs</span><span class="kd">←</span><span class="m">¯1</span><span class="o">↓</span><span class="nv">cs</span>
    <span class="c1">⍝ non-overlapping nested volumes outside the last cuboid</span>
    <span class="nv">left</span><span class="kd">←</span><span class="nv">x0</span><span class="p">(</span><span class="nv">cx0</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span>        <span class="c1">⍝ &lt;cx0</span>
    <span class="nv">right</span><span class="kd">←</span><span class="p">(</span><span class="nv">cx1</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span>      <span class="c1">⍝ &gt;cx1</span>
    <span class="nv">below</span><span class="kd">←</span><span class="nv">cx0</span> <span class="nv">cx1</span> <span class="nv">y0</span><span class="p">(</span><span class="nv">cy0</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="nv">z0</span> <span class="nv">z1</span>     <span class="c1">⍝ in [cx0,cx1], &lt;cy0 </span>
    <span class="nv">above</span><span class="kd">←</span><span class="nv">cx0</span> <span class="nv">cx1</span><span class="p">(</span><span class="nv">cy1</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span>     <span class="c1">⍝ in [cx0,cx1], &gt;cy1 </span>
    <span class="nv">behind</span><span class="kd">←</span><span class="nv">cx0</span> <span class="nv">cx1</span> <span class="nv">cy0</span> <span class="nv">cy1</span> <span class="nv">z0</span><span class="p">(</span><span class="nv">cz0</span><span class="o">-</span><span class="m">1</span><span class="p">)</span> <span class="c1">⍝ in [cx0,cx1], in [cy0,cy1], &lt;cz0</span>
    <span class="nv">front</span><span class="kd">←</span><span class="nv">cx0</span> <span class="nv">cx1</span> <span class="nv">cy0</span> <span class="nv">cy1</span><span class="p">(</span><span class="nv">cz1</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="nv">z1</span>   <span class="c1">⍝ in [cx0,cx1], in [cy0,cy1], &gt;cz1</span>
    <span class="c1">⍝ count cubes outside</span>
    <span class="nv">num_outside</span><span class="kd">←</span><span class="o">+</span><span class="na">/</span><span class="kt">{</span>
      <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span><span class="kd">←</span><span class="bp">⍵</span>
      <span class="p">(</span><span class="nv">x0</span><span class="o">&gt;</span><span class="nv">x1</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">y0</span><span class="o">&gt;</span><span class="nv">y1</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">z0</span><span class="o">&gt;</span><span class="nv">z1</span><span class="p">)</span><span class="bp">:</span> <span class="m">0</span> <span class="c1">⍝ empty</span>
      <span class="nv">count</span> <span class="bp">⍵</span><span class="o">,⊂</span><span class="p">(</span><span class="nv">intersect_cuboids_with_volume</span> <span class="bp">⍵</span><span class="o">,⊂</span><span class="nv">cs</span><span class="p">)</span>
    <span class="kt">}</span><span class="na">¨</span><span class="p">(</span><span class="nv">left</span> <span class="nv">right</span> <span class="nv">below</span> <span class="nv">above</span> <span class="nv">behind</span> <span class="nv">front</span><span class="p">)</span>
    <span class="c1">⍝ as this is the last cuboid, it takes precedence over its volume</span>
    <span class="nv">num_outside</span><span class="o">+</span><span class="p">(</span><span class="nv">on_cubes</span> <span class="nv">bit</span> <span class="nv">cx0</span> <span class="nv">cx1</span> <span class="nv">cy0</span> <span class="nv">cy1</span> <span class="nv">cz0</span> <span class="nv">cz1</span><span class="p">)</span>
  <span class="kt">}</span>
  <span class="c1">⍝ bound all the cuboids</span>
  <span class="nv">_</span> <span class="nv">x0</span> <span class="nv">_</span> <span class="nv">y0</span> <span class="nv">_</span> <span class="nv">z0</span> <span class="nv">_</span><span class="kd">←</span><span class="o">⊃⌊</span><span class="na">/</span><span class="bp">⍵</span>
  <span class="nv">_</span> <span class="nv">_</span> <span class="nv">x1</span> <span class="nv">_</span> <span class="nv">y1</span> <span class="nv">_</span> <span class="nv">z1</span><span class="kd">←</span><span class="o">⊃⌈</span><span class="na">/</span><span class="bp">⍵</span>
  <span class="nv">count</span> <span class="nv">x0</span> <span class="nv">x1</span> <span class="nv">y0</span> <span class="nv">y1</span> <span class="nv">z0</span> <span class="nv">z1</span> <span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>